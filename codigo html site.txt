<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>SALOMUSIC</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1b1c1f 0%, #25262a 100%);
      color: #ffffff;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    .sidebar {
      background: linear-gradient(180deg, #1f1e1e 0%, #2b2b2b 100%);
      width: 220px;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      box-shadow: 2px 0 15px rgba(0, 0, 0, 0.3);
      border-right: 1px solid #444;
    }

    .sidebar h2 {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
      color: #ffffff;
      text-align: center;
      padding: 0.5rem;
      border-bottom: none;
      background: linear-gradient(135deg, #ff6b35, #f7931e, #ffd700, #00ff88, #00bfff, #7c3aed, #ff1a1a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 300% 300%;
      animation: gradientShift 3s ease-in-out infinite;
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
      font-weight: bold;
      letter-spacing: 1px;
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .sidebar .menu-label {
      font-size: 0.9rem;
      color: #888;
      text-align: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #444;
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: 500;
    }

    .sidebar a {
      color: #bbb;
      text-decoration: none;
      margin: 0.5rem 0;
      display: block;
      padding: 0.8rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .sidebar a:hover {
      background: linear-gradient(45deg, #2b2b2b, #3a3a3a);
      color: #7c3aed;
      transform: translateX(5px);
    }

    .sidebar a.active {
      background: linear-gradient(45deg, #960e0e, #ff1a1a);
      color: white;
      font-weight: bold;
    }

    .search-bar {
      margin: 1rem 0;
      padding: 0.8rem;
      width: 100%;
      background: linear-gradient(135deg, #2b2d31 0%, #3a3c41 100%);
      border: 2px solid #555;
      color: white;
      border-radius: 8px;
      font-size: 0.9rem;
      font-family: inherit;
    }

    .search-bar:focus {
      border-color: #ffffff;
      outline: none;
      box-shadow: 0 0 15px rgba(124, 58, 237, 0.3);
    }

    .user-info {
      margin-top: auto;
      padding: 1rem;
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 12px;
      border: 1px solid #555;
      text-align: center;
      display: none;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 0.5rem;
      font-size: 1.5rem;
      background-size: cover;
      background-position: center;
    }

    .logout-btn {
      background: linear-gradient(45deg, #666, #888);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 0.5rem;
      font-size: 0.8rem;
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .topbar {
      background: linear-gradient(90deg, #202225 0%, #36393f 100%);
      padding: 1rem 1.5rem;
      font-size: 1.6rem;
      color: #ffffff;
      font-weight: bold;
      border-bottom: 2px solid #444;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    .topbar-left {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      flex: 1;
    }

    .topbar-search {
      flex: 1;
      max-width: 500px;
      display: flex;
      justify-content: center;
    }

    .notification-bell {
      position: relative;
      cursor: pointer;
      font-size: 1.5rem;
      padding: 0.5rem;
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ff1a1a;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
    }

    .notification-dropdown {
      position: absolute;
      top: 100%;
      right: 20px;
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border: 1px solid #555;
      border-radius: 8px;
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      display: none;
    }

    .notification-dropdown.show {
      display: block;
    }

    .notification-item {
      padding: 1rem;
      border-bottom: 1px solid #555;
      cursor: pointer;
      transition: background 0.3s;
    }

    .notification-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .notification-item:last-child {
      border-bottom: none;
    }

    .notification-text {
      font-size: 0.9rem;
    }

    .notification-time {
      font-size: 0.8rem;
      color: #888;
      margin-top: 0.3rem;
    }

    .content {
      padding: 2rem;
      flex: 1;
      overflow-y: auto;
      background: linear-gradient(135deg, #25262a 0%, #2f3136 100%);
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .card {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      padding: 2rem;
      border-radius: 16px;
      margin-bottom: 2rem;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      border: 1px solid #555;
      position: relative;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #960e0e, #7c3aed, #960e0e);
    }

    .card h3 {
      margin-bottom: 1.5rem;
      color: #7c3aed;
      font-size: 1.4rem;
    }

    .auth-tabs {
      display: flex;
      margin-bottom: 2rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 0.5rem;
    }

    .auth-tab {
      flex: 1;
      padding: 1rem;
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .auth-tab.active {
      background: linear-gradient(45deg, #960e0e, #ff1a1a);
      color: white;
    }

    input[type="file"],
    input[type="text"],
    input[type="password"],
    textarea {
      margin: 1rem 0;
      padding: 0.8rem;
      width: 100%;
      background: linear-gradient(135deg, #2b2d31 0%, #3a3c41 100%);
      border: 2px solid #555;
      color: white;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
    }

    input:focus,
    textarea:focus {
      border-color: #7c3aed;
      outline: none;
      box-shadow: 0 0 15px rgba(124, 58, 237, 0.3);
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    button {
      background: linear-gradient(45deg, #960e0e, #ff1a1a);
      color: #ffffff;
      padding: 0.8rem 1.8rem;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      width: 100%;
      transition: all 0.3s ease;
    }

    button:hover {
      background: linear-gradient(45deg, #ff1a1a, #ff4d4d);
      transform: translateY(-2px);
    }

    .notice {
      margin-top: 1rem;
      padding: 0.5rem;
      border-radius: 4px;
      font-size: 0.95rem;
    }

    .notice.success {
      background: rgba(0, 255, 0, 0.1);
      color: #00ff88;
      border-left: 3px solid #00ff88;
    }

    .notice.error {
      background: rgba(255, 0, 0, 0.1);
      color: #ff6666;
      border-left: 3px solid #ff6666;
    }

    .feed-container {
      max-width: 600px;
      margin: 0 auto;
    }

    .post {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 16px;
      margin-bottom: 1.5rem;
      border: 1px solid #555;
      position: relative;
    }

    .post::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, #960e0e, #7c3aed, #960e0e);
    }

    .post-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid #555;
      display: flex;
      align-items: center;
      gap: 1rem;
      position: relative;
    }

    .post-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      cursor: pointer;
      background-size: cover;
      background-position: center;
    }

    .post-author {
      font-weight: bold;
      color: #7c3aed;
      cursor: pointer;
    }

    .post-time {
      color: #888;
      font-size: 0.9rem;
      margin-left: auto;
    }

    .post-menu {
      position: absolute;
      top: 1rem;
      right: 1rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: background 0.3s ease;
    }

    .post-menu:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .post-menu-dots {
      font-size: 1.4rem;
      color: #888;
      line-height: 1;
    }

    .post-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border: 1px solid #555;
      border-radius: 8px;
      min-width: 180px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      z-index: 100;
      display: none;
    }

    .post-dropdown.show {
      display: block;
    }

    .dropdown-item {
      padding: 0.8rem 1rem;
      cursor: pointer;
      transition: background 0.3s ease;
      border: none;
      background: none;
      color: white;
      width: 100%;
      text-align: left;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-transform: none;
      letter-spacing: normal;
      font-weight: normal;
    }

    .dropdown-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: none;
    }

    .dropdown-item.edit {
      color: #00ffcc;
    }

    .dropdown-item.delete {
      color: #ff6666;
    }

    .dropdown-item.download {
      color: #ffaa00;
    }

    .dropdown-item.share {
      color: #00ff88;
    }

    .post-content {
      padding: 1.5rem;
    }

    .post-text {
      margin-bottom: 1rem;
      line-height: 1.5;
    }

    .post-media {
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 1rem;
      cursor: pointer;
    }

    .post-image,
    .post-video {
      width: 100%;
      height: auto;
      max-height: 400px;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .post-image:hover {
      transform: scale(1.02);
    }

    .post-actions {
      padding: 1rem 1.5rem;
      border-top: 1px solid #555;
      display: flex;
      gap: 2rem;
    }

    .action-btn {
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      border-radius: 6px;
      transition: color 0.3s ease;
      width: auto;
      text-transform: none;
      letter-spacing: normal;
      font-weight: normal;
    }

    .action-btn:hover {
      color: #7c3aed;
      transform: none;
      background: rgba(124, 58, 237, 0.1);
    }

    .action-btn.liked {
      color: #34a853;
    }

    .action-btn.disliked {
      color: #ea4335;
    }

    .action-btn.favorited {
      color: #fbbf24;
    }

    .action-btn.liked:hover {
      color: #34a853 !important;
      background: rgba(52, 168, 83, 0.1) !important;
    }

    .action-btn.disliked:hover {
      color: #ea4335 !important;
      background: rgba(234, 67, 53, 0.1) !important;
    }

    .action-btn.favorited:hover {
      color: #fbbf24 !important;
      background: rgba(251, 191, 36, 0.1) !important;
    }

    .follow-btn {
      background: linear-gradient(45deg, #6366f1, #7c3aed) !important;
      padding: 0.3rem 0.8rem !important;
      font-size: 0.8rem !important;
      width: auto !important;
      margin-left: 1rem;
    }

    .unfollow-btn {
      background: linear-gradient(45deg, #960e0e, #ff1a1a) !important;
      padding: 0.3rem 0.8rem !important;
      font-size: 0.8rem !important;
      width: auto !important;
      margin-left: 1rem;
    }

    .chat-btn {
      background: linear-gradient(45deg, #6e48aa, #9d50bb) !important;
      padding: 0.3rem 0.8rem !important;
      font-size: 0.8rem !important;
      width: auto !important;
      margin-left: 1rem;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 90%;
      max-height: 90%;
    }

    .modal img,
    .modal video {
      max-width: 100%;
      max-height: 100%;
      border-radius: 12px;
    }

    .close-modal {
      position: absolute;
      top: 20px;
      right: 30px;
      color: white;
      font-size: 40px;
      cursor: pointer;
    }

    .preview-area img,
    .preview-area video {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 8px;
      margin-top: 1rem;
    }

    .edit-modal, .share-modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
    }

    .edit-modal-content, .share-modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      padding: 2rem;
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      border: 1px solid #555;
    }

    .share-modal-content {
      max-width: 400px;
      text-align: center;
    }

    .edit-modal h3, .share-modal h3 {
      color: #00ffcc;
      margin-bottom: 1rem;
    }

    .edit-modal textarea {
      width: 100%;
      min-height: 120px;
      margin-bottom: 1rem;
    }

    .modal-buttons {
      display: flex;
      gap: 1rem;
    }

    .modal-buttons button {
      width: 50%;
      padding: 0.8rem 1.5rem;
    }

    .cancel-btn {
      background: linear-gradient(45deg, #666, #888) !important;
    }

    .share-link {
      background: #2b2d31;
      border: 1px solid #555;
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      color: #00ffcc;
      word-break: break-all;
      font-family: monospace;
    }

    .copy-btn {
      background: linear-gradient(45deg, #6366f1, #7c3aed) !important;
      margin-bottom: 1rem;
    }

    .user-profile-header {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      background-size: cover;
      background-position: center;
    }

    .profile-info h2 {
      color: #00ffcc;
      margin-bottom: 0.5rem;
    }

    .profile-stats {
      display: flex;
      gap: 1.5rem;
      margin-top: 1rem;
    }

    .stat-item {
      text-align: center;
    }

    .stat-number {
      font-size: 1.2rem;
      font-weight: bold;
      color: #00ffcc;
    }

    .stat-label {
      font-size: 0.8rem;
      color: #888;
    }

    .user-posts {
      margin-top: 2rem;
    }

    .user-posts h3 {
      border-bottom: 1px solid #555;
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
    }

    .comments-section {
      margin-top: 1rem;
      border-top: 1px solid #555;
      padding-top: 1rem;
    }

    .comment-form {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .comment-input {
      flex: 1;
      padding: 0.5rem;
      border-radius: 4px;
      border: 1px solid #555;
      background: #2b2d31;
      color: white;
    }

    .comment-btn {
      padding: 0.5rem 1rem !important;
      font-size: 0.9rem !important;
      width: auto !important;
      text-transform: none !important;
      letter-spacing: normal !important;
    }

    .comments-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .comment {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.8rem;
      padding-bottom: 0.8rem;
      border-bottom: 1px solid #444;
    }

    .comment-avatar {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      background-size: cover;
      background-position: center;
    }

    .comment-content {
      flex: 1;
    }

    .comment-author {
      font-weight: bold;
      font-size: 0.9rem;
      color: #00ffcc;
    }

    .comment-text {
      font-size: 0.9rem;
      margin-top: 0.2rem;
    }

    .comment-time {
      font-size: 0.7rem;
      color: #888;
      margin-top: 0.2rem;
    }

    .highlight-post {
      animation: highlight 2s;
    }

    @keyframes highlight {
      0% { background-color: rgba(0, 255, 204, 0.1); }
      100% { background-color: transparent; }
    }

    .search-results {
      margin-bottom: 2rem;
    }

    .search-results h3 {
      color: #00ffcc;
      margin-bottom: 1rem;
    }

    .no-results {
      text-align: center;
      color: #888;
      padding: 2rem;
      font-style: italic;
    }

    .clear-search {
      background: linear-gradient(45deg, #666, #888) !important;
      padding: 0.5rem 1rem !important;
      font-size: 0.8rem !important;
      width: auto !important;
      margin-left: 0.5rem;
      text-transform: none !important;
      letter-spacing: normal !important;
    }

    .search-users-results {
      margin-top: 1rem;
    }

    .user-search-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      background: rgba(255, 255, 255, 0.05);
      cursor: pointer;
      transition: background 0.3s;
    }

    .user-search-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .user-search-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      background-size: cover;
      background-position: center;
    }

    .user-search-info {
      flex: 1;
    }

    .user-search-name {
      font-weight: bold;
      color: #00ffcc;
    }

    .user-search-username {
      font-size: 0.8rem;
      color: #888;
    }

    /* Adicione no final do seu CSS */
    #chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    #chat-messages::-webkit-scrollbar-track {
      background: #2b2d31;
    }

    #chat-messages::-webkit-scrollbar-thumb {
      background: #555;
      border-radius: 3px;
    }

    #conversations-list::-webkit-scrollbar {
      width: 6px;
    }

    #conversations-list::-webkit-scrollbar-track {
      background: #2b2d31;
    }

    #conversations-list::-webkit-scrollbar-thumb {
      background: #555;
      border-radius: 3px;
    }

    .user-search-item {
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 5px;
      background: rgba(255,255,255,0.05);
      cursor: pointer;
      transition: background 0.3s;
    }

    .user-search-item:hover {
      background: rgba(255,255,255,0.1);
    }

    .follow-request-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      margin-bottom: 10px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
    }

    .follow-request-buttons {
      display: flex;
      gap: 10px;
    }

    .settings-section {
      margin-bottom: 20px;
    }

    .settings-section h4 {
      margin-bottom: 10px;
      color: #00ffcc;
      border-bottom: 1px solid #555;
      padding-bottom: 5px;
    }

    .settings-option {
      margin-bottom: 15px;
    }

    .settings-option label {
      display: block;
      margin-bottom: 5px;
    }

    .settings-option input {
      width: 100%;
    }

    .settings-save-btn {
      margin-top: 20px;
    }

    .requests-section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #555;
    }

    .requests-section h3 {
      color: #00ffcc;
      margin-bottom: 15px;
    }

    .request-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      margin-bottom: 10px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
    }

    .request-user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .request-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      background-size: cover;
      background-position: center;
    }

    .request-buttons {
      display: flex;
      gap: 10px;
    }

    .request-btn {
      padding: 5px 10px !important;
      font-size: 0.8rem !important;
      width: auto !important;
    }

    .accept-btn {
      background: linear-gradient(45deg, #6366f1, #7c3aed) !important;
    }

    .reject-btn {
      background: linear-gradient(45deg, #960e0e, #ff1a1a) !important;
    }

    .search-user-profile {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .search-user-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      background-size: cover;
      background-position: center;
    }

    .search-user-info {
      flex: 1;
    }

    .search-user-name {
      font-size: 1.5rem;
      color: #00ffcc;
      margin-bottom: 5px;
    }

    .search-user-username {
      color: #888;
      margin-bottom: 10px;
    }

    .search-user-actions {
      display: flex;
      gap: 10px;
    }

    .send-message-btn {
      width: auto !important;
      padding: 0.6rem 1.2rem !important;
      font-size: 0.9rem !important;
      text-transform: none !important;
      letter-spacing: normal !important;
      font-weight: normal !important;
    }

    .private-post-option {
      margin: 1rem 0;
      padding: 0.8rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      border: 1px solid #555;
    }

    .private-post-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      color: #bbb;
      font-size: 0.9rem;
    }

    .private-post-label input[type="checkbox"] {
      width: auto;
      margin: 0;
    }

    .private-post-label:hover {
      color: #7c3aed;
    }

    .post-privacy-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      font-size: 0.8rem;
      color: #ffaa00;
      background: rgba(255, 170, 0, 0.1);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      margin-bottom: 0.5rem;
    }

    .request-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      margin-bottom: 1rem;
      border: 1px solid #555;
    }

    .request-user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .request-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      background-size: cover;
      background-position: center;
    }

    .request-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .request-btn {
      padding: 0.4rem 0.8rem !important;
      font-size: 0.8rem !important;
      width: auto !important;
      text-transform: none !important;
      letter-spacing: normal !important;
      font-weight: normal !important;
    }

    .no-results {
      text-align: center;
      padding: 2rem;
      color: #888;
      font-style: italic;
    }

    /* Chat Styles */
    #chat-container {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 16px;
      border: 1px solid #555;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    #chat-header {
      background: linear-gradient(90deg, #202225 0%, #36393f 100%);
      padding: 1rem 1.5rem;
      border-radius: 16px 16px 0 0;
      border-bottom: 2px solid #444;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #chat-header h4 {
      color: #7c3aed;
      font-size: 1.2rem;
      margin: 0;
    }

    .chat-close-btn {
      background: none !important;
      border: none !important;
      color: #888 !important;
      cursor: pointer;
      font-size: 1.2rem !important;
      padding: 0.3rem !important;
      width: auto !important;
      height: auto !important;
      border-radius: 4px !important;
      transition: all 0.3s ease;
      text-transform: none !important;
      letter-spacing: normal !important;
      font-weight: normal !important;
    }

    .chat-close-btn:hover {
      background: rgba(255, 255, 255, 0.1) !important;
      color: #ff6666 !important;
      transform: none !important;
    }

    #chat-messages {
      background: linear-gradient(135deg, #25262a 0%, #2f3136 100%);
      border: 1px solid #555;
      border-radius: 8px;
      margin: 1rem;
    }

    #conversations-list {
      background: linear-gradient(135deg, #25262a 0%, #2f3136 100%);
      border: 1px solid #555;
      border-radius: 8px;
      padding: 1rem;
      max-height: 300px !important;
    }

    .conversation-item {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border: 1px solid #555;
      border-radius: 8px;
      padding: 0.8rem;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .conversation-item:hover {
      background: linear-gradient(45deg, #2b2b2b, #3a3a3a);
      transform: translateX(5px);
    }

    /* Password Input with Eye Icon */
    .password-input-container {
      position: relative;
      display: flex;
      align-items: center;
    }

    .password-input-container input {
      padding-right: 3rem !important;
    }

    .password-toggle {
      position: absolute;
      right: 0.8rem;
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      font-size: 1.1rem;
      padding: 0.2rem;
      width: auto !important;
      height: auto !important;
      text-transform: none !important;
      letter-spacing: normal !important;
      font-weight: normal !important;
      transition: color 0.3s ease;
    }

    .password-toggle:hover {
      color: #7c3aed;
      background: none !important;
      transform: none !important;
    }

    /* Forgot Password Link */
    .forgot-password-link {
      display: block;
      text-align: center;
      color: #7c3aed;
      text-decoration: none;
      font-size: 0.9rem;
      margin-top: 1rem;
      transition: color 0.3s ease;
    }

    .forgot-password-link:hover {
      color: #ff1a1a;
      text-decoration: underline;
    }

    /* Reset Password Form */
    #reset-password-form {
      display: none;
    }

    .back-to-login {
      background: linear-gradient(45deg, #666, #888) !important;
      margin-top: 1rem;
    }

    .back-to-login:hover {
      background: linear-gradient(45deg, #888, #aaa) !important;
    }

    /* Profile Tabs */
    .profile-tabs {
      display: flex;
      margin: 2rem 0 1rem 0;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 0.5rem;
      gap: 0.5rem;
    }

    .profile-tab {
      flex: 1;
      padding: 0.8rem 1rem !important;
      background: none !important;
      border: none !important;
      color: #888 !important;
      cursor: pointer;
      border-radius: 8px !important;
      transition: all 0.3s ease;
      font-size: 0.9rem !important;
      text-transform: none !important;
      letter-spacing: normal !important;
      font-weight: normal !important;
      width: auto !important;
    }

    .profile-tab:hover {
      background: rgba(255, 255, 255, 0.1) !important;
      color: #7c3aed !important;
      transform: none !important;
    }

    .profile-tab.active {
      background: linear-gradient(45deg, #960e0e, #ff1a1a) !important;
      color: white !important;
    }

    .profile-content {
      margin-top: 1rem;
    }

    .profile-tab-content {
      display: none;
    }

    .profile-tab-content.active {
      display: block;
    }

    /* Download and Share buttons styling */
    .action-btn[title="Download do post"],
    .action-btn[title="Compartilhar post"] {
      color: #00ffcc;
    }

    .action-btn[title="Download do post"]:hover {
      color: #00ffcc !important;
      background: rgba(0, 255, 204, 0.1) !important;
    }

    .action-btn[title="Compartilhar post"]:hover {
      color: #ffaa00 !important;
      background: rgba(255, 170, 0, 0.1) !important;
    }

    /* Ban System Styles */
    .ban-btn {
      background: linear-gradient(45deg, #ff4444, #cc0000) !important;
      color: white !important;
      padding: 0.6rem 1.2rem !important;
      font-size: 0.9rem !important;
      text-transform: none !important;
      letter-spacing: normal !important;
      font-weight: normal !important;
      width: auto !important;
      margin-left: 0.5rem;
    }

    .ban-btn.unban {
      background: linear-gradient(45deg, #00aa00, #00ff00) !important;
    }

    .ban-btn:hover {
      background: linear-gradient(45deg, #ff6666, #ff0000) !important;
      transform: translateY(-2px) !important;
    }

    .ban-btn.unban:hover {
      background: linear-gradient(45deg, #00cc00, #00ff44) !important;
    }

    /* Ban Modal */
    .ban-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .ban-modal-content {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 16px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      border: 1px solid #555;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    .ban-modal-content h3 {
      color: #ff6666;
      margin-bottom: 1rem;
      text-align: center;
    }

    .ban-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .ban-option {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.8rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .ban-option:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: #7c3aed;
    }

    .ban-option input[type="radio"] {
      width: auto !important;
      margin: 0 !important;
    }

    .ban-option input[type="radio"]:checked + span {
      color: #ff6666;
      font-weight: bold;
    }

    #custom-ban-section {
      margin: 1rem 0;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
    }

    #custom-ban-section label {
      display: block;
      margin-bottom: 0.5rem;
      color: #bbb;
    }

    .ban-reason-section {
      margin: 1.5rem 0;
    }

    .ban-reason-section label {
      display: block;
      margin-bottom: 0.5rem;
      color: #bbb;
    }

    .ban-modal-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 2rem;
    }

    .ban-confirm-btn {
      background: linear-gradient(45deg, #ff4444, #cc0000) !important;
      color: white !important;
      padding: 0.8rem 1.5rem !important;
      width: auto !important;
    }

    .ban-confirm-btn:hover {
      background: linear-gradient(45deg, #ff6666, #ff0000) !important;
    }

    /* Banned User Indicator */
    .banned-indicator {
      background: rgba(255, 68, 68, 0.2);
      color: #ff6666;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      text-align: center;
      border: 1px solid #ff6666;
    }

    /* Hide banned user content */
    .banned-content {
      opacity: 0.3;
      pointer-events: none;
      filter: blur(2px);
    }

    /* Search user results */
    .search-user-profile {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    .search-user-profile:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .search-user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      cursor: pointer;
      background-size: cover;
      background-position: center;
      transition: transform 0.3s ease;
    }

    .search-user-avatar:hover {
      transform: scale(1.1);
    }

    .search-user-info {
      flex: 1;
    }

    .search-user-name {
      font-weight: bold;
      color: #7c3aed;
      cursor: pointer;
      transition: color 0.3s ease;
      font-size: 1.1rem;
    }

    .search-user-name:hover {
      color: #ff1a1a;
      text-decoration: underline;
    }

    .search-user-username {
      color: #888;
      font-size: 0.9rem;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .search-user-username:hover {
      color: #7c3aed;
    }

    .search-user-actions {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
    }

    .search-user-actions button {
      padding: 0.4rem 0.8rem !important;
      font-size: 0.8rem !important;
      width: auto !important;
    }

    /* Empty content message */
    .empty-content {
      text-align: center;
      padding: 3rem 2rem;
      color: #888;
      font-size: 1.2rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      border: 2px dashed #555;
      margin: 1rem 0;
    }

    /* Profile tabs */
    .profile-tabs {
      display: flex;
      margin: 2rem 0 1rem 0;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 0.5rem;
      gap: 0.5rem;
    }

    .profile-tab {
      flex: 1;
      padding: 1rem;
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      text-transform: none;
      letter-spacing: normal;
      font-weight: normal;
      width: auto;
    }

    .profile-tab.active {
      background: linear-gradient(45deg, #960e0e, #ff1a1a);
      color: white;
      font-weight: bold;
    }

    .profile-tab:hover:not(.active) {
      background: rgba(255, 255, 255, 0.1);
      color: #7c3aed;
      transform: none;
    }

    .profile-tab-content {
      min-height: 200px;
    }

    .profile-tab-content.active {
      display: block !important;
    }

    /* Music Player Styles */
    .music-player {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1rem 0;
      border: 1px solid #555;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    .music-player h4 {
      color: #7c3aed;
      margin-bottom: 1rem;
      text-align: center;
      font-size: 1.2rem;
    }

    .music-upload {
      margin-bottom: 1.5rem;
    }

    .music-upload input[type="file"] {
      display: none;
    }

    .music-upload-btn {
      background: linear-gradient(45deg, #00ff88, #00cc6a);
      color: #000;
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      width: 100%;
      margin: 0.5rem 0;
      transition: all 0.3s ease;
    }

    .music-upload-btn:hover {
      background: linear-gradient(45deg, #00cc6a, #00aa55);
      transform: translateY(-2px);
    }

    .player-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin: 1rem 0;
    }

    .play-btn {
      background: linear-gradient(45deg, #7c3aed, #9f7aea);
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .play-btn:hover {
      background: linear-gradient(45deg, #9f7aea, #b794f6);
      transform: scale(1.1);
    }

    .prev-btn, .next-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .prev-btn:hover, .next-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }

    .music-info {
      text-align: center;
      margin: 1rem 0;
    }

    .music-title {
      color: #fff;
      font-weight: bold;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .music-artist {
      color: #888;
      font-size: 0.9rem;
    }

    .progress-container {
      margin: 1rem 0;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
      cursor: pointer;
      position: relative;
      margin: 0.5rem 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(45deg, #7c3aed, #9f7aea);
      border-radius: 3px;
      width: 0%;
      transition: width 0.1s ease;
    }

    .time-display {
      display: flex;
      justify-content: space-between;
      color: #888;
      font-size: 0.8rem;
    }

    .volume-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 1rem 0;
    }

    .volume-icon {
      color: #888;
      font-size: 1.2rem;
    }

    .volume-slider {
      flex: 1;
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
      outline: none;
      cursor: pointer;
      -webkit-appearance: none;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: linear-gradient(45deg, #7c3aed, #9f7aea);
      border-radius: 50%;
      cursor: pointer;
    }

    .volume-slider::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: linear-gradient(45deg, #7c3aed, #9f7aea);
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }

    .playlist {
      margin-top: 1.5rem;
    }

    .playlist h5 {
      color: #7c3aed;
      margin-bottom: 1rem;
      font-size: 1rem;
    }

    .playlist-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.8rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      margin: 0.5rem 0;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .playlist-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(5px);
    }

    .playlist-item.active {
      background: linear-gradient(45deg, #7c3aed, #9f7aea);
    }

    .playlist-item-info {
      flex: 1;
    }

    .playlist-item-title {
      color: #fff;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .playlist-item-duration {
      color: #888;
      font-size: 0.8rem;
    }

    .playlist-item-remove {
      background: none;
      border: none;
      color: #ff6666;
      cursor: pointer;
      font-size: 1.2rem;
      padding: 0.3rem;
      border-radius: 50%;
      transition: all 0.3s ease;
      width: auto;
      margin: 0;
    }

    .playlist-item-remove:hover {
      background: rgba(255, 102, 102, 0.2);
      transform: scale(1.2);
    }

    /* Post Music Player */
    .post-music-player {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 1rem;
      margin: 1rem 0;
      border: 1px solid #555;
    }

    .post-music-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .post-play-btn {
      background: linear-gradient(45deg, #7c3aed, #9f7aea);
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .post-play-btn:hover {
      background: linear-gradient(45deg, #9f7aea, #b794f6);
      transform: scale(1.1);
    }

    .post-music-info {
      flex: 1;
    }

    .post-music-title {
      color: #fff;
      font-weight: bold;
      font-size: 0.9rem;
      margin-bottom: 0.3rem;
    }

    .post-progress-bar {
      width: 100%;
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
      cursor: pointer;
      position: relative;
    }

    .post-progress-fill {
      height: 100%;
      background: linear-gradient(45deg, #7c3aed, #9f7aea);
      border-radius: 2px;
      width: 0%;
      transition: width 0.1s ease;
    }

    .post-time-display {
      display: flex;
      justify-content: space-between;
      color: #888;
      font-size: 0.7rem;
      margin-top: 0.3rem;
    }

    /* Communities Styles */
    .communities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin: 1rem 0;
    }

    .community-card {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 16px;
      padding: 1.5rem;
      border: 1px solid #555;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .community-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.6);
    }

    .community-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .community-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(45deg, #7c3aed, #9f7aea);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
      font-weight: bold;
    }

    .community-info h3 {
      color: #7c3aed;
      margin: 0 0 0.5rem 0;
      font-size: 1.2rem;
    }

    .community-stats {
      color: #888;
      font-size: 0.9rem;
    }

    .community-description {
      color: #ccc;
      margin: 1rem 0;
      line-height: 1.4;
    }

    .community-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .join-community-btn, .leave-community-btn {
      background: linear-gradient(45deg, #00ff88, #00cc6a);
      color: #000;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      width: auto;
      margin: 0;
    }

    .leave-community-btn {
      background: linear-gradient(45deg, #ff6666, #ff4444);
      color: white;
    }

    .join-community-btn:hover {
      background: linear-gradient(45deg, #00cc6a, #00aa55);
      transform: translateY(-2px);
    }

    .leave-community-btn:hover {
      background: linear-gradient(45deg, #ff4444, #ff2222);
      transform: translateY(-2px);
    }

    .create-community-form {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid #555;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    .create-community-form h3 {
      color: #7c3aed;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      color: #ccc;
      margin-bottom: 0.5rem;
      font-weight: bold;
    }

    .community-type-selector {
      display: flex;
      gap: 1rem;
      margin: 1rem 0;
    }

    .type-option {
      flex: 1;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid #555;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .type-option.selected {
      border-color: #7c3aed;
      background: rgba(124, 58, 237, 0.1);
    }

    .type-option:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .type-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .type-name {
      font-weight: bold;
      color: #fff;
      margin-bottom: 0.3rem;
    }

    .type-description {
      font-size: 0.8rem;
      color: #888;
    }

    .community-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .community-modal-content {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 16px;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      border: 1px solid #555;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    .community-posts {
      margin-top: 2rem;
    }

    .community-post-composer {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid #555;
    }

    .community-search {
      margin-bottom: 2rem;
    }

    .community-search input {
      width: 100%;
      padding: 0.8rem;
      background: linear-gradient(135deg, #2b2d31 0%, #3a3c41 100%);
      border: 2px solid #555;
      color: white;
      border-radius: 25px;
      font-size: 1rem;
      font-family: inherit;
    }

    .community-search input:focus {
      border-color: #7c3aed;
      outline: none;
      box-shadow: 0 0 15px rgba(124, 58, 237, 0.3);
    }

    .community-categories {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .category-filter {
      background: rgba(255, 255, 255, 0.1);
      color: #ccc;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .category-filter.active {
      background: linear-gradient(45deg, #7c3aed, #9f7aea);
      color: white;
    }

    .category-filter:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Additional Post Styles */
    .no-posts {
      text-align: center;
      color: #888;
      padding: 2rem;
      font-style: italic;
    }

    .post-community-tag {
      background: linear-gradient(45deg, #7c3aed, #9f7aea);
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 15px;
      font-size: 0.8rem;
      display: inline-block;
      margin-bottom: 0.5rem;
    }

    .private-indicator {
      color: #ffaa00;
      font-size: 1.2rem;
      margin-left: 0.5rem;
    }

    .post-comments {
      border-top: 1px solid #555;
      padding: 1rem 1.5rem;
      background: rgba(0, 0, 0, 0.2);
    }

    .comment-input {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .comment-input input {
      flex: 1;
      padding: 0.5rem;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid #555;
      color: white;
      border-radius: 20px;
      font-size: 0.9rem;
      margin: 0;
    }

    .comment-input button {
      background: linear-gradient(45deg, #7c3aed, #9f7aea);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      width: auto;
      margin: 0;
    }

    .comment {
      display: flex;
      gap: 0.8rem;
      margin: 0.8rem 0;
      padding: 0.8rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
    }

    .comment-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      background-size: cover;
      background-position: center;
      flex-shrink: 0;
    }

    .comment-content {
      flex: 1;
    }

    .comment-author {
      font-weight: bold;
      color: #7c3aed;
      font-size: 0.9rem;
      margin-bottom: 0.3rem;
    }

    .comment-text {
      color: #ccc;
      line-height: 1.4;
      margin-bottom: 0.3rem;
    }

    .comment-time {
      color: #888;
      font-size: 0.8rem;
    }

    .no-comments {
      text-align: center;
      color: #888;
      padding: 1rem;
      font-style: italic;
    }

    .action-btn.favorited {
      color: #ffaa00;
    }

    /* Modal Styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .modal-content {
      max-width: 90%;
      max-height: 90%;
      position: relative;
    }

    .close-modal {
      position: absolute;
      top: -40px;
      right: 0;
      background: none;
      border: none;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      width: auto;
      margin: 0;
      padding: 0;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #555;
    }

    .modal-header h3 {
      margin: 0;
      color: #7c3aed;
    }

    .modal-header .close-modal {
      position: static;
      color: #888;
      font-size: 1.5rem;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .modal-header .close-modal:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    /* YouTube Music Player Styles */
    .youtube-music-section {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1rem 0;
      border: 1px solid #555;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    .youtube-music-section h4 {
      color: #ff0000;
      margin-bottom: 1rem;
      text-align: center;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .youtube-input-container {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .youtube-url-input {
      flex: 1;
      padding: 0.8rem;
      background: linear-gradient(135deg, #2b2d31 0%, #3a3c41 100%);
      border: 2px solid #555;
      color: white;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
    }

    .youtube-url-input:focus {
      border-color: #ff0000;
      outline: none;
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
    }

    .youtube-add-btn {
      background: linear-gradient(45deg, #ff0000, #cc0000);
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      width: auto;
      margin: 0;
    }

    .youtube-add-btn:hover {
      background: linear-gradient(45deg, #cc0000, #990000);
      transform: translateY(-2px);
    }

    .youtube-player-container {
      margin: 1rem 0;
      text-align: center;
    }

    .youtube-iframe {
      width: 100%;
      height: 315px;
      border-radius: 12px;
      border: none;
    }

    .youtube-playlist {
      margin-top: 1rem;
    }

    .youtube-playlist h5 {
      color: #ff0000;
      margin-bottom: 1rem;
      font-size: 1rem;
    }

    .youtube-playlist-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.8rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      margin: 0.5rem 0;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .youtube-playlist-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(5px);
    }

    .youtube-playlist-item.active {
      background: linear-gradient(45deg, #ff0000, #cc0000);
    }

    .youtube-thumbnail {
      width: 60px;
      height: 45px;
      border-radius: 4px;
      object-fit: cover;
    }

    .youtube-item-info {
      flex: 1;
    }

    .youtube-item-title {
      color: #fff;
      font-weight: bold;
      font-size: 0.9rem;
      margin-bottom: 0.3rem;
    }

    .youtube-item-channel {
      color: #888;
      font-size: 0.8rem;
    }

    .youtube-item-remove {
      background: none;
      border: none;
      color: #ff6666;
      cursor: pointer;
      font-size: 1.2rem;
      padding: 0.3rem;
      border-radius: 50%;
      transition: all 0.3s ease;
      width: auto;
      margin: 0;
    }

    .youtube-item-remove:hover {
      background: rgba(255, 102, 102, 0.2);
      transform: scale(1.2);
    }

    .youtube-controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin: 1rem 0;
    }

    .youtube-control-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0;
    }

    .youtube-control-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }

    .youtube-play-btn {
      background: linear-gradient(45deg, #ff0000, #cc0000);
      width: 60px;
      height: 60px;
      font-size: 1.5rem;
    }

    .youtube-play-btn:hover {
      background: linear-gradient(45deg, #cc0000, #990000);
    }

    /* Search Enhancement Styles */
    .search-type-indicator {
      position: absolute;
      left: 0.8rem;
      top: 50%;
      transform: translateY(-50%);
      color: #7c3aed;
      font-weight: bold;
      font-size: 0.9rem;
      pointer-events: none;
    }

    .search-bar-enhanced {
      padding-left: 2.5rem !important;
    }

    .search-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border: 1px solid #555;
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }

    .search-suggestion {
      padding: 0.8rem;
      cursor: pointer;
      transition: background 0.3s;
      border-bottom: 1px solid #555;
    }

    .search-suggestion:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .search-suggestion:last-child {
      border-bottom: none;
    }

    .suggestion-type {
      color: #7c3aed;
      font-size: 0.8rem;
      font-weight: bold;
    }

    .suggestion-name {
      color: #fff;
      margin-top: 0.2rem;
    }

    /* Community Card Enhancements */
    .community-card {
      position: relative;
    }

    .community-menu {
      position: absolute;
      top: 1rem;
      right: 1rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: background 0.3s ease;
      z-index: 10;
    }

    .community-menu:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .community-menu-dots {
      font-size: 1.4rem;
      color: #888;
      line-height: 1;
    }

    .community-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border: 1px solid #555;
      border-radius: 8px;
      min-width: 180px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      z-index: 100;
      display: none;
    }

    .community-dropdown.show {
      display: block;
    }

    .community-dropdown-item {
      padding: 0.8rem 1rem;
      cursor: pointer;
      transition: background 0.3s ease;
      border: none;
      background: none;
      color: white;
      width: 100%;
      text-align: left;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-transform: none;
      letter-spacing: normal;
      font-weight: normal;
    }

    .community-dropdown-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: none;
    }

    .community-dropdown-item.edit {
      color: #00ffcc;
    }

    .community-dropdown-item.rules {
      color: #ffaa00;
    }

    .community-dropdown-item.share {
      color: #00ff88;
    }

    .community-dropdown-item.delete {
      color: #ff6666;
    }

    .community-icon-upload {
      position: relative;
      cursor: pointer;
    }

    .community-icon-upload input[type="file"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
      margin: 0;
    }

    .community-icon-upload:hover {
      transform: scale(1.05);
    }

    .community-rules {
      background: rgba(255, 170, 0, 0.1);
      border: 1px solid #ffaa00;
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
    }

    .community-rules h4 {
      color: #ffaa00;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .community-rules-list {
      color: #ccc;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .community-rules-list li {
      margin-bottom: 0.3rem;
    }

    /* Rules Modal */
    .rules-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .rules-modal-content {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 16px;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      border: 1px solid #555;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    .rules-modal-content h3 {
      color: #ffaa00;
      margin-bottom: 1rem;
      text-align: center;
    }

    .rules-input {
      width: 100%;
      min-height: 200px;
      padding: 1rem;
      background: linear-gradient(135deg, #2b2d31 0%, #3a3c41 100%);
      border: 2px solid #555;
      color: white;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      resize: vertical;
      margin-bottom: 1rem;
    }

    .rules-input:focus {
      border-color: #ffaa00;
      outline: none;
      box-shadow: 0 0 15px rgba(255, 170, 0, 0.3);
    }

    .rules-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .rules-save-btn {
      background: linear-gradient(45deg, #ffaa00, #ff8800);
      color: #000;
      font-weight: bold;
    }

    .rules-save-btn:hover {
      background: linear-gradient(45deg, #ff8800, #ff6600);
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>SALOMUSIC SERVER!</h2>
    <div class="menu-label">Menu</div>
    <a id="feed-link" class="nav-link active"> Feed</a>
    <a id="perfil-link" class="nav-link" style="display: none;"> Perfil</a>
    <a id="communities-link" class="nav-link" style="display: none;"> Comunidades</a>
    <a id="chat-link" class="nav-link" style="display: none;"> Conversas</a>
    <a id="requests-link" class="nav-link" style="display: none;"> Solicitaes</a>
    <a id="config-link" class="nav-link" style="display: none;"> Configuraes</a>
    <a id="sobre-link" class="nav-link"> Sobre</a>
    
    <div class="user-info" id="user-info">
      <div class="user-avatar" id="user-avatar"></div>
      <div id="user-display-name">Usurio</div>
      <button class="logout-btn" id="logout-btn">Sair</button>
    </div>
  </div>

  <div class="main">
    <div class="topbar">
      <div class="topbar-left">
        <div class="topbar-search" style="position: relative;">
          <div class="search-type-indicator" id="search-type-indicator" style="display: none;"></div>
          <input type="text" class="search-bar search-bar-enhanced" id="search-input" placeholder=" Pesquisar posts, u/usurios ou c/comunidades..." style="display: none;">
          <div class="search-suggestions" id="search-suggestions"></div>
        </div>
      </div>
      <div class="notification-bell" id="notification-bell">
        
        <div class="notification-badge" id="notification-badge" style="display: none;">0</div>
        <div class="notification-dropdown" id="notification-dropdown"></div>
      </div>
    </div>
    
    <div class="content">
      <!-- Feed Page -->
      <div id="feed" class="page active">
        <!-- Auth Section -->
        <div id="auth-section" style="max-width: 400px; margin: 0 auto;">
          <div class="card">
            <div class="auth-tabs">
              <button class="auth-tab active" id="login-tab">Login</button>
              <button class="auth-tab" id="register-tab">Cadastrar</button>
            </div>

            <!-- Login Form -->
            <div id="login-form">
              <h3> Entrar na Conta</h3>
              <input type="text" id="login-username" placeholder=" Nome de Usurio">
              <div class="password-input-container">
                <input type="password" id="login-password" placeholder=" Senha">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('login-password', this)"></button>
              </div>
              <button id="login-btn">Entrar</button>
              <a href="#" class="forgot-password-link" onclick="showResetPasswordForm()">Esqueci minha senha</a>
              <p id="login-status" class="notice"></p>
            </div>

            <!-- Reset Password Form -->
            <div id="reset-password-form">
              <h3> Redefinir Senha</h3>
              <input type="text" id="reset-username" placeholder=" Nome de Usurio">
              <div class="password-input-container">
                <input type="password" id="reset-new-password" placeholder=" Nova Senha (5-15 caracteres)" minlength="5" maxlength="15">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('reset-new-password', this)"></button>
              </div>
              <div class="password-input-container">
                <input type="password" id="reset-confirm-password" placeholder=" Confirmar Nova Senha" minlength="5" maxlength="15">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('reset-confirm-password', this)"></button>
              </div>
              <button id="reset-password-btn">Redefinir Senha</button>
              <button type="button" class="back-to-login" onclick="showLoginForm()">Voltar ao Login</button>
              <p id="reset-status" class="notice"></p>
            </div>

            <!-- Register Form -->
            <div id="register-form" style="display: none;">
              <h3> Criar Conta Nova</h3>
              <input type="text" id="reg-username" placeholder=" Nome de Usurio">
              <input type="text" id="reg-displayname" placeholder=" Nome para Exibio">
              <div class="password-input-container">
                <input type="password" id="reg-password" placeholder=" Senha (5-15 caracteres)" minlength="5" maxlength="15">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('reg-password', this)"></button>
              </div>
              <div class="password-input-container">
                <input type="password" id="reg-confirm-password" placeholder=" Confirmar Senha" minlength="5" maxlength="15">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('reg-confirm-password', this)"></button>
              </div>
              <input type="file" id="reg-avatar" accept="image/*" style="display: none;">
              <button type="button" onclick="document.getElementById('reg-avatar').click()">Escolher Avatar</button>
              <div id="avatar-preview" style="width: 100px; height: 100px; border-radius: 50%; background: #333; margin: 10px auto;"></div>
              <button id="register-btn">Criar Conta</button>
              <p id="register-status" class="notice"></p>
            </div>
          </div>
        </div>

        <!-- Feed Section -->
        <div id="feed-section" class="feed-container" style="display: none;">
          <!-- Post Composer -->
          <div class="card" id="post-composer">
            <h3> Compartilhar Contedo</h3>
            <textarea id="post-text" placeholder="No que voc est pensando? Compartilhe com a tropa! "></textarea>
            <input type="file" id="post-media" accept=".jpeg,.jpg,.png,.mp4,.mov,.mp3,.wav,.ogg,.m4a">
            <div class="file-size-info" style="font-size: 0.8rem; color: #888; margin: 0.5rem 0; text-align: center;">
               Limite mximo: 100 MB por arquivo
            </div>
            <div id="media-preview" class="preview-area"></div>
            <div class="private-post-option">
              <label class="private-post-label">
                <input type="checkbox" id="private-post-checkbox">
                 Post privado (apenas seguidores)
              </label>
            </div>
            <button id="create-post-btn">Postar</button>
            <p id="post-status" class="notice"></p>
          </div>

          <!-- YouTube Music Player -->
          <div class="youtube-music-section" id="youtube-music-section" style="display: none;">
            <h4> YouTube Music Player</h4>
            
            <div class="youtube-input-container">
              <input type="text" class="youtube-url-input" id="youtube-url-input" placeholder="Cole aqui o link do YouTube (msica ou playlist)...">
              <button class="youtube-add-btn" onclick="addYouTubeVideo()">Adicionar</button>
            </div>
            
            <div class="youtube-player-container" id="youtube-player-container" style="display: none;">
              <iframe class="youtube-iframe" id="youtube-iframe" src="" allowfullscreen></iframe>
            </div>
            
            <div class="youtube-controls" id="youtube-controls" style="display: none;">
              <button class="youtube-control-btn" onclick="previousYouTubeVideo()"></button>
              <button class="youtube-play-btn" id="youtube-play-btn" onclick="toggleYouTubePlayback()"></button>
              <button class="youtube-control-btn" onclick="nextYouTubeVideo()"></button>
            </div>
            
            <div class="youtube-playlist" id="youtube-playlist" style="display: none;">
              <h5> Playlist</h5>
              <div id="youtube-playlist-items"></div>
            </div>
          </div>

          <!-- Search Results -->
          <div id="search-results" class="search-results" style="display: none;">
            <div class="card">
              <h3 id="search-title"> Resultados da Pesquisa</h3>
              <div id="search-posts-container"></div>
              <div id="search-users-container" class="search-users-results"></div>
            </div>
          </div>

          <!-- Posts Feed -->
          <div id="posts-container"></div>
        </div>
      </div>

      <!-- Profile Page -->
      <div id="perfil" class="page">
        <div class="card">
          <h3> Meu Perfil</h3>
          <div id="profile-content">
            <p>Suas informaes de perfil aparecero aqui aps o login.</p>
          </div>
        </div>
      </div>

      <!-- User Profile Page -->
      <div id="user-profile" class="page">
        <div class="card">
          <div id="user-profile-content"></div>
        </div>
      </div>

      <!-- Chat Page -->
      <div id="chat" class="page">
        <div class="card">
          <h3> Conversas</h3>
          <div id="conversations-list">
            <!-- Lista de conversas ser gerada aqui -->
          </div>
          <div id="chat-container" style="display: none; margin-top: 20px;">
            <div id="chat-header">
              <h4 id="chat-with-user"></h4>
              <button class="chat-close-btn" onclick="closeChat()"></button>
            </div>
            <div id="chat-messages" style="height: 300px; overflow-y: auto; padding: 10px;"></div>
            <div style="display: flex; gap: 10px; padding: 1rem;">
              <input type="text" id="chat-message" placeholder="Digite sua mensagem..." style="flex: 1;">
              <button onclick="sendMessage()" class="send-message-btn">Enviar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Requests Page -->
      <div id="requests" class="page">
        <div class="card">
          <h3> Solicitaes de Seguidores</h3>
          <div id="follow-requests-list">
            <p>Nenhuma solicitao pendente.</p>
          </div>
        </div>
      </div>

      <!-- Config Page -->
      <div id="config" class="page">
        <div class="card">
          <h3> Configuraes</h3>
          <div id="config-content">
            <div class="settings-section">
              <h4>Perfil</h4>
              <div class="settings-option">
                <label for="config-displayname">Nome de Exibio</label>
                <input type="text" id="config-displayname">
              </div>
              <div class="settings-option">
                <label for="config-avatar">Avatar</label>
                <input type="file" id="config-avatar" accept="image/*">
                <div id="config-avatar-preview" style="width: 80px; height: 80px; border-radius: 50%; background: #333; margin: 10px 0; background-size: cover; background-position: center;"></div>
              </div>
              <button id="save-profile-btn" class="settings-save-btn">Salvar Alteraes</button>
            </div>

            <div class="settings-section">
              <h4>Segurana</h4>
              <div class="settings-option">
                <label for="config-current-password">Senha Atual</label>
                <div class="password-input-container">
                  <input type="password" id="config-current-password" placeholder="Para alterar sua senha">
                  <button type="button" class="password-toggle" onclick="togglePasswordVisibility('config-current-password', this)"></button>
                </div>
              </div>
              <div class="settings-option">
                <label for="config-new-password">Nova Senha (5-15 caracteres)</label>
                <div class="password-input-container">
                  <input type="password" id="config-new-password" minlength="5" maxlength="15">
                  <button type="button" class="password-toggle" onclick="togglePasswordVisibility('config-new-password', this)"></button>
                </div>
              </div>
              <div class="settings-option">
                <label for="config-confirm-password">Confirmar Nova Senha</label>
                <div class="password-input-container">
                  <input type="password" id="config-confirm-password" minlength="5" maxlength="15">
                  <button type="button" class="password-toggle" onclick="togglePasswordVisibility('config-confirm-password', this)"></button>
                </div>
              </div>
              <button id="save-password-btn" class="settings-save-btn">Alterar Senha</button>
            </div>

            <!-- Music Player Section -->
            <div class="music-player">
              <h4> Player de Msica</h4>
              
              <div class="music-upload">
                <input type="file" id="music-file" accept="audio/*" multiple>
                <button type="button" class="music-upload-btn" id="upload-music-btn">
                   Adicionar Msicas
                </button>
              </div>

              <div class="music-info" id="music-info">
                <div class="music-title" id="music-title">Nenhuma msica selecionada</div>
                <div class="music-artist" id="music-artist">Selecione uma msica para comear</div>
              </div>

              <div class="player-controls">
                <button class="prev-btn" id="prev-btn"></button>
                <button class="play-btn" id="play-btn"></button>
                <button class="next-btn" id="next-btn"></button>
              </div>

              <div class="progress-container">
                <div class="progress-bar" id="progress-bar">
                  <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="time-display">
                  <span id="current-time">0:00</span>
                  <span id="total-time">0:00</span>
                </div>
              </div>

              <div class="volume-container">
                <span class="volume-icon"></span>
                <input type="range" class="volume-slider" id="volume-slider" min="0" max="100" value="50">
                <span id="volume-display">50%</span>
              </div>

              <div class="playlist" id="playlist">
                <h5> Playlist</h5>
                <div id="playlist-items">
                  <p style="color: #888; text-align: center; padding: 1rem;">
                    Nenhuma msica na playlist. Adicione algumas msicas!
                  </p>
                </div>
              </div>

              <audio id="audio-player" preload="metadata"></audio>
            </div>
          </div>
        </div>
      </div>

      <!-- Communities Page -->
      <div id="communities" class="page">
        <div class="card">
          <h3> Comunidades</h3>
          
          <!-- Community Search -->
          <div class="community-search">
            <input type="text" id="community-search" placeholder=" Buscar comunidades...">
          </div>

          <!-- Category Filters -->
          <div class="community-categories">
            <button class="category-filter active" data-category="all">Todas</button>
            <button class="category-filter" data-category="music"> Msica</button>
            <button class="category-filter" data-category="gaming"> Games</button>
            <button class="category-filter" data-category="tech"> Tecnologia</button>
            <button class="category-filter" data-category="art"> Arte</button>
            <button class="category-filter" data-category="sports"> Esportes</button>
            <button class="category-filter" data-category="general"> Geral</button>
          </div>

          <!-- Create Community Form -->
          <div class="create-community-form">
            <h3> Criar Nova Comunidade</h3>
            
            <div class="form-group">
              <label for="community-name">Nome da Comunidade</label>
              <input type="text" id="community-name" placeholder="Ex: Amantes da Msica">
            </div>

            <div class="form-group">
              <label for="community-description">Descrio</label>
              <textarea id="community-description" placeholder="Descreva sua comunidade..."></textarea>
            </div>

            <div class="form-group">
              <label for="community-icon">Imagem da Comunidade</label>
              <input type="file" id="community-icon" accept="image/*">
              <div id="community-icon-preview" style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(45deg, #7c3aed, #9f7aea); margin: 10px 0; background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;"></div>
            </div>

            <div class="form-group">
              <label for="community-rules">Regras da Comunidade</label>
              <textarea id="community-rules" placeholder="Digite as regras da comunidade (uma por linha)..."></textarea>
            </div>

            <div class="form-group">
              <label>Categoria</label>
              <div class="community-type-selector">
                <div class="type-option" data-type="music">
                  <div class="type-icon"></div>
                  <div class="type-name">Msica</div>
                  <div class="type-description">Para amantes da msica</div>
                </div>
                <div class="type-option" data-type="gaming">
                  <div class="type-icon"></div>
                  <div class="type-name">Games</div>
                  <div class="type-description">Discusses sobre jogos</div>
                </div>
                <div class="type-option" data-type="tech">
                  <div class="type-icon"></div>
                  <div class="type-name">Tech</div>
                  <div class="type-description">Tecnologia e programao</div>
                </div>
              </div>
              <div class="community-type-selector">
                <div class="type-option" data-type="art">
                  <div class="type-icon"></div>
                  <div class="type-name">Arte</div>
                  <div class="type-description">Criaes artsticas</div>
                </div>
                <div class="type-option" data-type="sports">
                  <div class="type-icon"></div>
                  <div class="type-name">Esportes</div>
                  <div class="type-description">Discusses esportivas</div>
                </div>
                <div class="type-option" data-type="general">
                  <div class="type-icon"></div>
                  <div class="type-name">Geral</div>
                  <div class="type-description">Tpicos diversos</div>
                </div>
              </div>
            </div>

            <button id="create-community-btn" class="settings-save-btn">Criar Comunidade</button>
          </div>

          <!-- Communities Grid -->
          <div class="communities-grid" id="communities-grid">
            <!-- Communities will be loaded here -->
          </div>
        </div>
      </div>

      <!-- About Page -->
      <div id="sobre" class="page">
        <div class="card">
          <h3> Sobre o Servidor</h3>
          <p><strong> O que  este servidor?</strong></p>
          <p>O SALOMUSIC  uma rede social exclusiva, criada para oferecer uma experincia nica de compartilhamento de contedo e interao entre membros. e foi criada pelo SaloLay!</p>
          <br>
          <p><strong> Nossa Misso</strong></p>
          <p>Criar uma comunidade vibrante onde os membros podem compartilhar momentos, ideias e contedo visual de forma segura e divertida.</p>
          <br>
          <p><strong> Recursos Principais</strong></p>
          <p> Feed em tempo real estilo Twitter/Reddit<br>
           Upload e visualizao de imagens, vdeos e msicas<br>
           Player de msica integrado<br>
           Sistema de comunidades<br>
           Sistema completo de usurios e perfis<br>
           Autenticao segura e proteo de dados<br>
           Interface responsiva e moderna<br>
           Sistema de busca por posts<br>
           Sistema de likes e dislikes</p>
          <p>Um beijo para Laysla, a ajudante emocional</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Media Modal -->
  <div id="media-modal" class="modal">
    <span class="close-modal">&times;</span>
    <div class="modal-content" id="modal-content"></div>
  </div>

  <!-- Edit Modal -->
  <div id="edit-modal" class="edit-modal">
    <div class="edit-modal-content">
      <h3> Editar Post</h3>
      <textarea id="edit-text" placeholder="Edite seu post..."></textarea>
      <div class="modal-buttons">
        <button id="save-edit-btn">Salvar</button>
        <button id="cancel-edit-btn" class="cancel-btn">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  <div id="share-modal" class="share-modal">
    <div class="share-modal-content">
      <h3> Compartilhar Post</h3>
      <p>Copie o link abaixo para compartilhar este post:</p>
      <div class="share-link" id="share-link"></div>
      <button id="copy-link-btn" class="copy-btn">Copiar Link</button>
      <button id="close-share-btn" class="cancel-btn">Fechar</button>
    </div>
  </div>

  <!-- Community Modal -->
  <div id="community-modal" class="community-modal" style="display: none;">
    <div class="community-modal-content">
      <div class="modal-header">
        <h3 id="community-modal-title"> Nome da Comunidade</h3>
        <button class="close-modal" onclick="closeCommunityModal()">&times;</button>
      </div>
      
      <div id="community-modal-content">
        <!-- Community content will be loaded here -->
      </div>
    </div>
  </div>

  <!-- Ban Modal -->
  <div id="ban-modal" class="ban-modal" style="display: none;">
    <div class="ban-modal-content">
      <h3> Banir Usurio</h3>
      <p>Selecione o tempo de banimento para <span id="ban-username"></span>:</p>
      
      <div class="ban-options">
        <label class="ban-option">
          <input type="radio" name="ban-duration" value="1day">
          <span>1 Dia</span>
        </label>
        <label class="ban-option">
          <input type="radio" name="ban-duration" value="1week">
          <span>1 Semana</span>
        </label>
        <label class="ban-option">
          <input type="radio" name="ban-duration" value="forever">
          <span>Para Sempre</span>
        </label>
        <label class="ban-option">
          <input type="radio" name="ban-duration" value="custom">
          <span>Personalizado</span>
        </label>
      </div>
      
      <div id="custom-ban-section" style="display: none;">
        <label for="custom-ban-days">Nmero de dias:</label>
        <input type="number" id="custom-ban-days" min="1" max="365" placeholder="Ex: 30">
      </div>
      
      <div class="ban-reason-section">
        <label for="ban-reason">Motivo do banimento (opcional):</label>
        <textarea id="ban-reason" placeholder="Descreva o motivo do banimento..."></textarea>
      </div>
      
      <div class="ban-modal-buttons">
        <button id="confirm-ban-btn" class="ban-confirm-btn">Confirmar Banimento</button>
        <button id="cancel-ban-btn" class="cancel-btn">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Rules Modal -->
  <div id="rules-modal" class="rules-modal" style="display: none;">
    <div class="rules-modal-content">
      <div class="modal-header">
        <h3> Regras da Comunidade</h3>
        <button class="close-modal" onclick="closeRulesModal()">&times;</button>
      </div>
      
      <textarea class="rules-input" id="rules-input" placeholder="Digite as regras da comunidade (uma por linha)..."></textarea>
      
      <div class="rules-buttons">
        <button class="rules-save-btn" onclick="saveRules()">Salvar Regras</button>
        <button class="cancel-btn" onclick="closeRulesModal()">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Edit Community Modal -->
  <div id="edit-community-modal" class="rules-modal" style="display: none;">
    <div class="rules-modal-content">
      <div class="modal-header">
        <h3> Editar Comunidade</h3>
        <button class="close-modal" onclick="closeEditCommunityModal()">&times;</button>
      </div>
      
      <div class="form-group">
        <label for="edit-community-name">Nome da Comunidade</label>
        <input type="text" id="edit-community-name">
      </div>
      
      <div class="form-group">
        <label for="edit-community-description">Descrio</label>
        <textarea id="edit-community-description"></textarea>
      </div>
      
      <div class="form-group">
        <label for="edit-community-icon">Imagem da Comunidade</label>
        <input type="file" id="edit-community-icon" accept="image/*">
        <div id="edit-community-icon-preview" style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(45deg, #7c3aed, #9f7aea); margin: 10px 0; background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;"></div>
      </div>
      
      <div class="rules-buttons">
        <button class="rules-save-btn" onclick="saveEditCommunity()">Salvar Alteraes</button>
        <button class="cancel-btn" onclick="closeEditCommunityModal()">Cancelar</button>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentUser = null;
    let posts = [];
    let users = [
      { 
        username: 'admin',
        password: '1234', 
        displayName: 'Administrador',
        avatar: '',
        followers: [],
        following: [],
        followRequests: [],
        isAdmin: true,
        banned: false,
        banExpiry: null
      }
    ];
    let conversations = [];
    let currentChat = null;
    let comments = [];
    let notifications = [];
    let viewingUserProfile = null;
    let editingPostId = null;
    let searchActive = false;
    let searchQuery = '';
    
    // Music Player Variables
    let currentPlaylist = [];
    let currentTrackIndex = 0;
    let isPlaying = false;
    let audioPlayer = null;
    
    // Communities Variables
    let communities = [];
    let currentCommunity = null;
    let selectedCommunityType = null;

    // Sample posts
    const samplePosts = [
      {
        id: 1,
        author: 'PhotoPro',
        displayName: 'Pro das Fotos',
        text: 'Nova funcionalidade de imagens est incrvel! ',
        time: '48h',
        likes: 0,
        dislikes: 0,
        liked: false,
        disliked: false,
        favorites: 0,
        favorited: false,
        comments: 0,
        media: {
          type: 'image',
          url: 'https://picsum.photos/600/400?random=1'
        }
      }
    ];

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      loadDataFromServer();
      setupEventListeners();
      checkLoginStatus();
    });

    function setupEventListeners() {
      // Navigation
      document.getElementById('feed-link').addEventListener('click', () => {
        viewingUserProfile = null;
        showPage('feed');
      });
      document.getElementById('perfil-link').addEventListener('click', () => {
        viewingUserProfile = null;
        showPage('perfil');
      });
      document.getElementById('chat-link').addEventListener('click', showChat);
      document.getElementById('requests-link').addEventListener('click', () => {
        viewingUserProfile = null;
        showPage('requests');
        loadFollowRequests();
      });
      document.getElementById('config-link').addEventListener('click', () => {
        viewingUserProfile = null;
        showPage('config');
      });
      document.getElementById('communities-link').addEventListener('click', () => {
        viewingUserProfile = null;
        showPage('communities');
      });
      document.getElementById('sobre-link').addEventListener('click', () => {
        viewingUserProfile = null;
        showPage('sobre');
      });

      // Search
      document.getElementById('search-input').addEventListener('input', handleSearch);
      document.getElementById('search-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          handleSearch();
        }
      });

      // Auth
      document.getElementById('login-tab').addEventListener('click', () => switchAuthTab('login'));
      document.getElementById('register-tab').addEventListener('click', () => switchAuthTab('register'));
      document.getElementById('login-btn').addEventListener('click', login);
      document.getElementById('register-btn').addEventListener('click', register);
      document.getElementById('logout-btn').addEventListener('click', logout);
      document.getElementById('reset-password-btn').addEventListener('click', resetPassword);

      // Enter key support for login
      document.getElementById('login-username').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') login();
      });
      document.getElementById('login-password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') login();
      });

      // Enter key support for register
      document.getElementById('reg-username').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') register();
      });
      document.getElementById('reg-displayname').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') register();
      });
      document.getElementById('reg-password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') register();
      });
      document.getElementById('reg-confirm-password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') register();
      });

      // Posts
      document.getElementById('post-media').addEventListener('change', previewMedia);
      document.getElementById('create-post-btn').addEventListener('click', createPost);

      // Modals
      document.getElementById('media-modal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('media-modal')) closeModal();
      });
      document.querySelector('.close-modal').addEventListener('click', closeModal);
      document.getElementById('save-edit-btn').addEventListener('click', saveEdit);
      document.getElementById('cancel-edit-btn').addEventListener('click', closeEditModal);
      document.getElementById('copy-link-btn').addEventListener('click', copyShareLink);
      document.getElementById('close-share-btn').addEventListener('click', closeShareModal);

      // Ban modal
      document.getElementById('confirm-ban-btn').addEventListener('click', confirmBan);
      document.getElementById('cancel-ban-btn').addEventListener('click', closeBanModal);
      
      // Custom ban duration toggle
      document.querySelectorAll('input[name="ban-duration"]').forEach(radio => {
        radio.addEventListener('change', function() {
          const customSection = document.getElementById('custom-ban-section');
          if (this.value === 'custom') {
            customSection.style.display = 'block';
          } else {
            customSection.style.display = 'none';
          }
        });
      });

      // Notifications
      document.getElementById('notification-bell').addEventListener('click', toggleNotifications);

      // Settings
      document.getElementById('config-avatar').addEventListener('change', previewConfigAvatar);
      document.getElementById('save-profile-btn').addEventListener('click', saveProfileSettings);
      document.getElementById('save-password-btn').addEventListener('click', changePassword);

      // Music Player
      document.getElementById('upload-music-btn').addEventListener('click', () => {
        document.getElementById('music-file').click();
      });
      document.getElementById('music-file').addEventListener('change', handleMusicUpload);
      document.getElementById('play-btn').addEventListener('click', togglePlay);
      document.getElementById('prev-btn').addEventListener('click', previousTrack);
      document.getElementById('next-btn').addEventListener('click', nextTrack);
      document.getElementById('progress-bar').addEventListener('click', seekTo);
      document.getElementById('volume-slider').addEventListener('input', changeVolume);

      // Communities
      document.getElementById('create-community-btn').addEventListener('click', createCommunity);
      document.getElementById('community-search').addEventListener('input', searchCommunities);
      
      // Community type selector
      document.querySelectorAll('.type-option').forEach(option => {
        option.addEventListener('click', function() {
          document.querySelectorAll('.type-option').forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          selectedCommunityType = this.dataset.type;
        });
      });

      // Category filters
      document.querySelectorAll('.category-filter').forEach(filter => {
        filter.addEventListener('click', function() {
          document.querySelectorAll('.category-filter').forEach(f => f.classList.remove('active'));
          this.classList.add('active');
          filterCommunities(this.dataset.category);
        });
      });

      // Close dropdowns when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.post-menu') && !e.target.closest('.notification-bell')) {
          document.querySelectorAll('.post-dropdown.show').forEach(dropdown => {
            dropdown.classList.remove('show');
          });
          document.getElementById('notification-dropdown').classList.remove('show');
        }
      });
    }

    function handleSearch() {
      const query = document.getElementById('search-input').value.trim().toLowerCase();
      
      if (query === '') {
        clearSearch();
        return;
      }
      
      searchQuery = query;
      searchActive = true;
      
      // Search posts
      const allPosts = [...posts, ...samplePosts];
      const filteredPosts = allPosts.filter(post => 
        post.text && post.text.toLowerCase().includes(query) ||
        post.displayName.toLowerCase().includes(query) ||
        post.author.toLowerCase().includes(query)
      );
      
      // Search users
      const filteredUsers = users.filter(user => 
        user.username.toLowerCase().includes(query) ||
        user.displayName.toLowerCase().includes(query)
      );
      
      displaySearchResults(filteredPosts, filteredUsers, query);
    }

    function displaySearchResults(filteredPosts, filteredUsers, query) {
      const searchResults = document.getElementById('search-results');
      const searchTitle = document.getElementById('search-title');
      const searchPostsContainer = document.getElementById('search-posts-container');
      const searchUsersContainer = document.getElementById('search-users-container');
      const regularPosts = document.getElementById('posts-container');
      const postComposer = document.getElementById('post-composer');
      
      searchResults.style.display = 'block';
      regularPosts.style.display = 'none';
      postComposer.style.display = 'none';
      
      searchTitle.innerHTML = ` Resultados para "${query}" <button class="clear-search" onclick="clearSearch()">Limpar</button>`;
      
      // Display posts results
      if (filteredPosts.length === 0) {
        searchPostsContainer.innerHTML = '<div class="no-results">Nenhum post encontrado para esta pesquisa.</div>';
      } else {
        searchPostsContainer.innerHTML = filteredPosts.map(post => generatePostHTML(post)).join('');
      }
      
      // Display users results
      if (filteredUsers.length > 0) {
        searchUsersContainer.innerHTML = `
          <h3>Usurios encontrados</h3>
          ${filteredUsers.map(user => {
            const isFollowing = currentUser && currentUser.following.includes(user.username);
            const isCurrentUser = currentUser && currentUser.username === user.username;
            const avatarStyle = user.avatar ? `background-image: url('${user.avatar}')` : '';
            
            return `
              <div class="search-user-profile">
                <div class="search-user-avatar" onclick="viewUserProfile('${user.username}')" style="${avatarStyle}">${user.avatar ? '' : user.displayName.charAt(0).toUpperCase()}</div>
                <div class="search-user-info">
                  <div class="search-user-name" onclick="viewUserProfile('${user.username}')">${user.displayName}</div>
                  <div class="search-user-username" onclick="viewUserProfile('${user.username}')">@${user.username}</div>
                  <div class="search-user-actions">
                    ${!isCurrentUser ? `
                      ${isFollowing ? `
                        <button class="unfollow-btn" onclick="unfollowUser('${user.username}')">Deixar de seguir</button>
                        <button class="chat-btn" onclick="startChat('${user.username}')">Conversar</button>
                      ` : `
                        <button class="follow-btn" onclick="followUser('${user.username}')">Seguir</button>
                      `}
                    ` : ''}
                  </div>
                </div>
              </div>
            `;
          }).join('')}
        `;
      } else {
        searchUsersContainer.innerHTML = '';
      }
    }

    function clearSearch() {
      document.getElementById('search-input').value = '';
      document.getElementById('search-results').style.display = 'none';
      document.getElementById('posts-container').style.display = 'block';
      document.getElementById('post-composer').style.display = 'block';
      searchActive = false;
      searchQuery = '';
    }

    function startChat(username) {
      showPage('chat');
      openChat(username);
    }

    // Data functions
    function saveDataToServer() {
      try {
        const data = { users, posts, comments, notifications, timestamp: Date.now() };
        console.log(' Dados salvos no servidor!');
      } catch (error) {
        console.error(' Erro ao salvar:', error);
      }
    }

    function loadDataFromServer() {
      try {
        console.log(' Conectando ao servidor...');
      } catch (error) {
        console.error(' Erro ao carregar:', error);
      }
    }

    function checkLoginStatus() {
      // Simulate checking login status
      showLoggedOutState();
    }

    function showLoggedInState() {
      document.getElementById('auth-section').style.display = 'none';
      document.getElementById('feed-section').style.display = 'block';
      document.getElementById('user-info').style.display = 'block';
      document.getElementById('perfil-link').style.display = 'block';
      document.getElementById('communities-link').style.display = 'block';
      document.getElementById('requests-link').style.display = 'block';
      document.getElementById('config-link').style.display = 'block';
      document.getElementById('search-input').style.display = 'block';
      document.getElementById('chat-link').style.display = 'block';
      
      document.getElementById('user-display-name').textContent = currentUser.displayName;
      const avatarElement = document.getElementById('user-avatar');
      if (currentUser.avatar) {
        avatarElement.style.backgroundImage = `url('${currentUser.avatar}')`;
        avatarElement.textContent = '';
      } else {
        avatarElement.style.backgroundImage = '';
        avatarElement.textContent = currentUser.displayName.charAt(0).toUpperCase();
      }
      
      updateNotificationsBadge();
      generatePosts();
      updateProfile();
    }

    function showLoggedOutState() {
      document.getElementById('auth-section').style.display = 'block';
      document.getElementById('feed-section').style.display = 'none';
      document.getElementById('user-info').style.display = 'none';
      document.getElementById('perfil-link').style.display = 'none';
      document.getElementById('communities-link').style.display = 'none';
      document.getElementById('requests-link').style.display = 'none';
      document.getElementById('config-link').style.display = 'none';
      document.getElementById('search-input').style.display = 'none';
      document.getElementById('notification-badge').style.display = 'none';
      document.getElementById('chat-link').style.display = 'none';
    }

    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      
      document.getElementById(pageId).classList.add('active');
      document.getElementById(pageId + '-link').classList.add('active');
      
      // Show search bar only on feed page
      const searchInput = document.getElementById('search-input');
      if (pageId === 'feed' && currentUser) {
        searchInput.style.display = 'block';
        generatePosts();
      } else {
        searchInput.style.display = 'none';
        clearSearch(); // Clear any active search when leaving feed
      }
      
      if (pageId === 'perfil') {
        updateProfile();
      } else if (pageId === 'communities') {
        loadCommunities();
      } else if (pageId === 'chat') {
        loadConversations();
      } else if (pageId === 'requests') {
        loadFollowRequests();
      } else if (pageId === 'config') {
        loadProfileSettings();
      }
    }

    function switchAuthTab(tab) {
      document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
      
      if (tab === 'login') {
        document.getElementById('login-tab').classList.add('active');
        document.getElementById('login-form').style.display = 'block';
        document.getElementById('register-form').style.display = 'none';
      } else {
        document.getElementById('register-tab').classList.add('active');
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('register-form').style.display = 'block';
      }
    }

    function login() {
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;
      const status = document.getElementById('login-status');

      if (!username || !password) {
        status.textContent = ' Preencha todos os campos.';
        status.className = 'notice error';
        return;
      }

      const user = users.find(u => 
        u.username === username && u.password === password
      );

      if (user) {
        currentUser = user;
        status.textContent = ' Login realizado!';
        status.className = 'notice success';
        setTimeout(() => {
          showLoggedInState();
          // Check if user is banned after login
          setTimeout(() => {
            checkUserBanStatus();
          }, 500);
        }, 1000);
      } else {
        status.textContent = ' Dados invlidos.';
        status.className = 'notice error';
      }
    }

    function register() {
      const username = document.getElementById('reg-username').value;
      const displayName = document.getElementById('reg-displayname').value;
      const password = document.getElementById('reg-password').value;
      const confirm = document.getElementById('reg-confirm-password').value;
      const status = document.getElementById('register-status');

      if (!username || !displayName || !password || !confirm) {
        status.textContent = ' Preencha todos os campos.';
        status.className = 'notice error';
        return;
      }

      if (password.length < 5 || password.length > 15) {
        status.textContent = ' A senha deve ter entre 5 e 15 caracteres.';
        status.className = 'notice error';
        return;
      }

      if (password !== confirm) {
        status.textContent = ' Senhas no coincidem.';
        status.className = 'notice error';
        return;
      }

      if (users.find(u => u.username === username)) {
        status.textContent = ' Usurio j existe.';
        status.className = 'notice error';
        return;
      }

      const avatarFile = document.getElementById('reg-avatar').files[0];
      let avatarUrl = '';
      
      if (avatarFile) {
        avatarUrl = URL.createObjectURL(avatarFile);
      }

      const newUser = { 
        username, 
        displayName, 
        password,
        avatar: avatarUrl,
        followers: [],
        following: [],
        followRequests: [],
        isAdmin: false,
        banned: false,
        banExpiry: null,
        banReason: null
      };
      users.push(newUser);
      saveDataToServer();
      
      status.textContent = ' Conta criada! Faa login.';
      status.className = 'notice success';
      
      setTimeout(() => {
        switchAuthTab('login');
        document.getElementById('login-username').value = username;
      }, 1500);
    }

    function logout() {
      currentUser = null;
      showLoggedOutState();
      showPage('feed');
    }

    function previewMedia() {
      const file = document.getElementById('post-media').files[0];
      const preview = document.getElementById('media-preview');
      const status = document.getElementById('post-status');
      
      if (file) {
        // Check file size (100 MB = 100 * 1024 * 1024 bytes)
        const maxSize = 100 * 1024 * 1024;
        if (file.size > maxSize) {
          status.textContent = ' Arquivo muito grande! Limite mximo: 100 MB';
          status.className = 'notice error';
          document.getElementById('post-media').value = '';
          preview.innerHTML = '';
          return;
        }
        
        const url = URL.createObjectURL(file);
        const isImage = file.type.startsWith('image/');
        const isVideo = file.type.startsWith('video/');
        const isAudio = file.type.startsWith('audio/');
        const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
        
        if (isImage) {
          preview.innerHTML = `
            <img src="${url}" alt="Preview">
            <div style="text-align: center; margin-top: 0.5rem; font-size: 0.8rem; color: #888;">
               ${file.name} (${fileSizeMB} MB)
            </div>
          `;
        } else if (isVideo) {
          preview.innerHTML = `
            <video src="${url}" controls></video>
            <div style="text-align: center; margin-top: 0.5rem; font-size: 0.8rem; color: #888;">
               ${file.name} (${fileSizeMB} MB)
            </div>
          `;
        } else if (isAudio) {
          preview.innerHTML = `
            ${createPostMusicPlayer(url, file.name.replace(/\.[^/.]+$/, ""))}
            <div style="text-align: center; margin-top: 0.5rem; font-size: 0.8rem; color: #888;">
               ${file.name} (${fileSizeMB} MB)
            </div>
          `;
        }
        
        // Clear any previous error messages
        if (status.className === 'notice error') {
          status.textContent = '';
          status.className = 'notice';
        }
      } else {
        preview.innerHTML = '';
      }
    }

    function previewConfigAvatar() {
      const file = document.getElementById('config-avatar').files[0];
      const preview = document.getElementById('config-avatar-preview');
      
      if (file) {
        const url = URL.createObjectURL(file);
        preview.style.backgroundImage = `url('${url}')`;
        preview.textContent = '';
      } else {
        preview.style.backgroundImage = '';
        preview.textContent = currentUser.displayName.charAt(0).toUpperCase();
      }
    }

    function createPost() {
      const text = document.getElementById('post-text').value;
      const mediaFile = document.getElementById('post-media').files[0];
      const isPrivate = document.getElementById('private-post-checkbox').checked;
      const status = document.getElementById('post-status');

      if (!text && !mediaFile) {
        status.textContent = ' Escreva algo ou adicione mdia.';
        status.className = 'notice error';
        return;
      }

      // Double-check file size limit
      if (mediaFile) {
        const maxSize = 100 * 1024 * 1024; // 100 MB
        if (mediaFile.size > maxSize) {
          status.textContent = ' Arquivo muito grande! Limite mximo: 100 MB';
          status.className = 'notice error';
          return;
        }
      }

      const newPost = {
        id: Date.now(),
        author: currentUser.username,
        displayName: currentUser.displayName,
        text: text,
        time: 'agora',
        likes: 0,
        dislikes: 0,
        liked: false,
        disliked: false,
        favorites: 0,
        favorited: false,
        commentsCount: 0,
        private: isPrivate
      };

      if (mediaFile) {
        let mediaType = 'video';
        if (mediaFile.type.startsWith('image/')) {
          mediaType = 'image';
        } else if (mediaFile.type.startsWith('audio/')) {
          mediaType = 'audio';
        }
        
        newPost.media = {
          type: mediaType,
          url: URL.createObjectURL(mediaFile),
          name: mediaFile.name
        };
      }

      posts.unshift(newPost);
      saveDataToServer();
      
      // Notify followers
      notifyFollowers(newPost);
      
      document.getElementById('post-text').value = '';
      document.getElementById('post-media').value = '';
      document.getElementById('media-preview').innerHTML = '';
      document.getElementById('private-post-checkbox').checked = false;
      
      status.textContent = ' Post criado!';
      status.className = 'notice success';
      
      setTimeout(() => {
        status.textContent = '';
        status.className = 'notice';
      }, 3000);

      generatePosts();
    }

    function toggleFavorite(postId) {
      if (!currentUser) return;
      if (isUserBanned(currentUser)) {
        showBannedMessage();
        return;
      }
      
      const allPosts = [...posts, ...samplePosts];
      const post = allPosts.find(p => p.id === postId);
      
      if (post) {
        if (post.favorited) {
          post.favorites = (post.favorites || 0) - 1;
          post.favorited = false;
        } else {
          post.favorites = (post.favorites || 0) + 1;
          post.favorited = true;
        }
        saveDataToServer();
        
        if (searchActive) {
          handleSearch();
        } else {
          generatePosts();
        }
      }
    }

    function generatePostHTML(post) {
      const user = users.find(u => u.username === post.author);
      const avatarStyle = user && user.avatar ? `background-image: url('${user.avatar}')` : '';
      
      // Check if post author is banned
      const isAuthorBanned = user && isUserBanned(user);
      
      if (isAuthorBanned) {
        return `
          <div class="post banned-content" data-post-id="${post.id}">
            <div class="banned-indicator">
               Contedo temporariamente indisponvel - Usurio banido
            </div>
          </div>
        `;
      }
      
      return `
        <div class="post" data-post-id="${post.id}">
          <div class="post-header">
            <div class="post-avatar" onclick="viewUserProfile('${post.author}')" style="${avatarStyle}">${user && user.avatar ? '' : post.displayName.charAt(0).toUpperCase()}</div>
            <div>
              <div class="post-author" onclick="viewUserProfile('${post.author}')">${post.displayName}</div>
              <div class="post-time">${post.time}</div>
            </div>
            ${currentUser && post.author === currentUser.username ? `
              <div class="post-menu" onclick="togglePostMenu(${post.id})">
                <div class="post-menu-dots"></div>
                <div class="post-dropdown" id="dropdown-${post.id}">
                  <button class="dropdown-item edit" onclick="editPost(${post.id})"> Editar</button>
                  <button class="dropdown-item delete" onclick="deletePost(${post.id})"> Excluir</button>
                </div>
              </div>
            ` : ''}
          </div>
          <div class="post-content">
            ${post.private ? `<div class="post-privacy-indicator"> Post privado</div>` : ''}
            ${post.text ? `<div class="post-text">${post.text}</div>` : ''}
            ${post.media ? `
              <div class="post-media" onclick="openModal('${post.media.url}', '${post.media.type}')">
                ${post.media.type === 'image' ? 
                  `<img src="${post.media.url}" class="post-image" alt="Post image">` :
                  `<video src="${post.media.url}" class="post-video" controls></video>`}
              </div>
            ` : ''}
          </div>
          <div class="post-actions">
            <button class="action-btn ${post.liked ? 'liked' : ''}" onclick="toggleLike(${post.id})">
               ${post.likes || 0}
            </button>
            <button class="action-btn ${post.disliked ? 'disliked' : ''}" onclick="toggleDislike(${post.id})">
               ${post.dislikes || 0}
            </button>
            <button class="action-btn ${post.favorited ? 'favorited' : ''}" onclick="toggleFavorite(${post.id})">
               ${post.favorites || 0}
            </button>
            <button class="action-btn" onclick="downloadPost(${post.id})" title="Download do post">
               Download
            </button>
            <button class="action-btn" onclick="sharePost(${post.id})" title="Compartilhar post">
               Compartilhar
            </button>
            <button class="action-btn" onclick="toggleComments(${post.id})">
               ${comments.filter(c => c.postId === post.id).length}
            </button>
          </div>
          <div class="comments-section" id="comments-${post.id}" style="display: none;">
            <div class="comment-form">
              <input type="text" class="comment-input" id="comment-input-${post.id}" placeholder="Escreva um comentrio...">
              <button class="comment-btn" onclick="addComment(${post.id})">Comentar</button>
            </div>
            <div class="comments-list" id="comments-list-${post.id}">
              ${renderComments(post.id)}
            </div>
          </div>
        </div>
      `;
    }

    function generatePosts() {
      const container = document.getElementById('posts-container');
      const allPosts = [...posts, ...samplePosts];
      
      container.innerHTML = allPosts.map(post => generatePostHTML(post)).join('');
    }

    // Check if user is banned
    function isUserBanned(user) {
      if (!user || !user.banned) return false;
      
      if (user.banExpiry === null) return true; // Permanent ban
      
      const now = new Date();
      const banExpiry = new Date(user.banExpiry);
      
      if (now > banExpiry) {
        // Ban expired, unban user
        user.banned = false;
        user.banExpiry = null;
        user.banReason = null;
        saveDataToServer();
        return false;
      }
      
      return true;
    }

    function showBannedMessage() {
      alert(' Voc est banido e no pode realizar esta ao.');
    }

    function toggleLike(postId) {
      if (!currentUser) return;
      if (isUserBanned(currentUser)) {
        showBannedMessage();
        return;
      }
      
      const allPosts = [...posts, ...samplePosts];
      const post = allPosts.find(p => p.id === postId);
      
      if (post) {
        if (post.liked) {
          post.likes = (post.likes || 0) - 1;
          post.liked = false;
        } else {
          if (post.disliked) {
            post.dislikes = (post.dislikes || 0) - 1;
            post.disliked = false;
          }
          post.likes = (post.likes || 0) + 1;
          post.liked = true;
        }
        saveDataToServer();
        
        if (searchActive) {
          handleSearch();
        } else {
          generatePosts();
        }
      }
    }

    function toggleDislike(postId) {
      if (!currentUser) return;
      if (isUserBanned(currentUser)) {
        showBannedMessage();
        return;
      }
      
      const allPosts = [...posts, ...samplePosts];
      const post = allPosts.find(p => p.id === postId);
      
      if (post) {
        if (post.disliked) {
          post.dislikes = (post.dislikes || 0) - 1;
          post.disliked = false;
        } else {
          if (post.liked) {
            post.likes = (post.likes || 0) - 1;
            post.liked = false;
          }
          post.dislikes = (post.dislikes || 0) + 1;
          post.disliked = true;
        }
        saveDataToServer();
        
        if (searchActive) {
          handleSearch();
        } else {
          generatePosts();
        }
      }
    }

    function sharePost(postId) {
      const shareUrl = `${window.location.origin}${window.location.pathname}?post=${postId}`;
      document.getElementById('share-link').textContent = shareUrl;
      document.getElementById('share-modal').style.display = 'block';
      
      // Close dropdown
      document.getElementById(`dropdown-${postId}`).classList.remove('show');
    }

    function copyShareLink() {
      const shareLink = document.getElementById('share-link').textContent;
      navigator.clipboard.writeText(shareLink).then(() => {
        const btn = document.getElementById('copy-link-btn');
        const originalText = btn.textContent;
        btn.textContent = ' Copiado!';
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      });
    }

    function closeShareModal() {
      document.getElementById('share-modal').style.display = 'none';
    }

    function notifyFollowers(post) {
      const user = users.find(u => u.username === post.author);
      if (!user) return;
      
      user.followers.forEach(follower => {
        const notification = {
          id: Date.now(),
          userId: follower,
          postId: post.id,
          author: post.author,
          displayName: post.displayName,
          text: post.text,
          time: 'agora',
          read: false
        };
        
        notifications.push(notification);
      });
      
      saveDataToServer();
      updateNotificationsBadge();
    }

    function toggleNotifications() {
      const dropdown = document.getElementById('notification-dropdown');
      dropdown.classList.toggle('show');
      
      if (dropdown.classList.contains('show')) {
        loadNotifications();
      }
    }

    function loadNotifications() {
      if (!currentUser) return;
      
      const userNotifications = notifications
        .filter(n => n.userId === currentUser.username && !n.read)
        .sort((a, b) => b.id - a.id);
      
      const dropdown = document.getElementById('notification-dropdown');
      
      if (userNotifications.length === 0) {
        dropdown.innerHTML = `<div class="notification-item">Nenhuma notificao nova</div>`;
        return;
      }
      
      dropdown.innerHTML = userNotifications.map(notification => `
        <div class="notification-item" onclick="viewNotification('${notification.id}', '${notification.postId}')">
          <div class="notification-text">
            <strong>${notification.displayName}</strong> postou algo novo: 
            ${notification.text ? notification.text.substring(0, 50) + (notification.text.length > 50 ? '...' : '') : ''}
          </div>
          <div class="notification-time">${notification.time}</div>
        </div>
      `).join('');
    }

    function viewNotification(notificationId, postId) {
      // Mark as read
      const notification = notifications.find(n => n.id == notificationId);
      if (notification) {
        notification.read = true;
        saveDataToServer();
      }
      
      // Find the post
      const post = posts.find(p => p.id == postId);
      if (post) {
        // Show the post in feed
        clearSearch();
        showPage('feed');
        // Scroll to the post
        setTimeout(() => {
          const postElement = document.querySelector(`[data-post-id="${postId}"]`);
          if (postElement) {
            postElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            postElement.classList.add('highlight-post');
            setTimeout(() => postElement.classList.remove('highlight-post'), 2000);
          }
        }, 100);
      }
      
      // Close dropdown
      document.getElementById('notification-dropdown').classList.remove('show');
      updateNotificationsBadge();
    }

    function updateNotificationsBadge() {
      if (!currentUser) return;
      
      const unreadCount = notifications.filter(n => 
        n.userId === currentUser.username && !n.read
      ).length;
      
      const badge = document.getElementById('notification-badge');
      
      if (unreadCount > 0) {
        badge.textContent = unreadCount;
        badge.style.display = 'flex';
      } else {
        badge.style.display = 'none';
      }
    }

    function renderComments(postId) {
      const postComments = comments.filter(c => c.postId == postId).sort((a, b) => b.id - a.id);
      
      if (postComments.length === 0) {
        return '<p>Nenhum comentrio ainda.</p>';
      }
      
      return postComments.map(comment => {
        const user = users.find(u => u.username === comment.author);
        const displayName = user ? user.displayName : comment.author;
        const avatarStyle = user && user.avatar ? `background-image: url('${user.avatar}')` : '';
        
        // Check if comment author is banned
        const isAuthorBanned = user && isUserBanned(user);
        
        if (isAuthorBanned) {
          return `
            <div class="comment banned-content">
              <div class="banned-indicator">
                 Comentrio indisponvel - Usurio banido
              </div>
            </div>
          `;
        }
        
        return `
          <div class="comment">
            <div class="comment-avatar" style="${avatarStyle}">${user && user.avatar ? '' : displayName.charAt(0).toUpperCase()}</div>
            <div class="comment-content">
              <div class="comment-author">${displayName}</div>
              <div class="comment-text">${comment.text}</div>
              <div class="comment-time">${comment.time}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function toggleComments(postId) {
      const commentsSection = document.getElementById(`comments-${postId}`);
      commentsSection.style.display = commentsSection.style.display === 'none' ? 'block' : 'none';
    }

    function addComment(postId) {
      if (!currentUser) return;
      if (isUserBanned(currentUser)) {
        showBannedMessage();
        return;
      }
      
      const commentInput = document.getElementById(`comment-input-${postId}`);
      const commentText = commentInput.value.trim();
      
      if (!commentText) return;
      
      const newComment = {
        id: Date.now(),
        postId: postId,
        author: currentUser.username,
        text: commentText,
        time: 'agora'
      };
      
      comments.unshift(newComment);
      saveDataToServer();
      
      // Update comments count in post
      const post = posts.find(p => p.id == postId);
      if (post) {
        post.commentsCount = comments.filter(c => c.postId == postId).length;
        saveDataToServer();
      }
      
      // Update comments display
      document.getElementById(`comments-list-${postId}`).innerHTML = renderComments(postId);
      commentInput.value = '';
      
      // Notify post author
      if (post && post.author !== currentUser.username) {
        const notification = {
          id: Date.now(),
          userId: post.author,
          postId: post.id,
          author: currentUser.username,
          displayName: currentUser.displayName,
          text: `comentou no seu post: ${commentText.substring(0, 50)}${commentText.length > 50 ? '...' : ''}`,
          time: 'agora',
          read: false
        };
        
        notifications.push(notification);
        saveDataToServer();
        
        if (notification.userId === currentUser.username) {
          updateNotificationsBadge();
        }
      }
    }

    function downloadMedia(url, type) {
      const a = document.createElement('a');
      a.href = url;
      a.download = `tropa-media-${Date.now()}.${type === 'image' ? 'jpg' : 'mp4'}`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    function viewUserProfile(username) {
      if (!currentUser) return;
      
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      viewingUserProfile = user;
      
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      
      document.getElementById('user-profile').classList.add('active');
      
      const profileContent = document.getElementById('user-profile-content');
      
      const isFollowing = currentUser.following.includes(username);
      const isCurrentUser = currentUser.username === username;
      const hasRequested = user.followRequests.includes(currentUser.username);
      
      const avatarStyle = user.avatar ? `background-image: url('${user.avatar}')` : '';
      
      profileContent.innerHTML = `
        <div class="user-profile-header">
          <div class="profile-avatar" style="${avatarStyle}">${user.avatar ? '' : user.displayName.charAt(0).toUpperCase()}</div>
          <div class="profile-info">
            <h2>${user.displayName}</h2>
            <p>@${user.username}</p>
            ${user.banned ? `
              <div class="banned-indicator">
                 Usurio Banido ${user.banExpiry ? `at ${new Date(user.banExpiry).toLocaleDateString('pt-BR')}` : 'Permanentemente'}
                ${user.banReason ? `<br><small>Motivo: ${user.banReason}</small>` : ''}
              </div>
            ` : ''}
            <div class="profile-stats">
              <div class="stat-item" onclick="showFollowers('${user.username}')">
                <div class="stat-number">${user.followers.length}</div>
                <div class="stat-label">Seguidores</div>
              </div>
              <div class="stat-item" onclick="showFollowing('${user.username}')">
                <div class="stat-number">${user.following.length}</div>
                <div class="stat-label">Seguindo</div>
              </div>
              <div class="stat-item">
                                <div class="stat-number">${posts.filter(p => p.author === user.username).length}</div>
                <div class="stat-label">Posts</div>
              </div>
            </div>
          </div>
        </div>
        <div class="user-actions">
          ${!isCurrentUser ? `
            ${isFollowing ? `
              <button class="unfollow-btn" onclick="unfollowUser('${user.username}')">Deixar de seguir</button>
              <button class="chat-btn" onclick="startChat('${user.username}')">Conversar</button>
            ` : `
              ${hasRequested ? `
                <button class="follow-btn" disabled>Solicitao enviada</button>
              ` : `
                <button class="follow-btn" onclick="followUser('${user.username}')">Seguir</button>
              `}
            `}
            ${currentUser.isAdmin && !user.isAdmin ? `
              <button class="ban-btn ${user.banned ? 'unban' : 'ban'}" onclick="${user.banned ? `unbanUser('${user.username}')` : `showBanModal('${user.username}')`}">
                ${user.banned ? ' Desbanir' : ' Banir'}
              </button>
            ` : ''}
          ` : ''}
        </div>
        <div class="profile-tabs">
          <button class="profile-tab active" onclick="showProfileTab('posts', '${user.username}')"> Posts</button>
          <button class="profile-tab" onclick="showProfileTab('favorites', '${user.username}')"> Favoritos</button>
          <button class="profile-tab" onclick="showProfileTab('likes', '${user.username}')"> Curtidas</button>
        </div>
        <div class="profile-content">
          <div id="profile-posts-${user.username}" class="profile-tab-content active">
            ${(() => {
              const userPosts = posts.filter(p => p.author === user.username);
              // Filter private posts based on following status
              const visiblePosts = userPosts.filter(post => {
                if (!post.private) return true; // Public posts are always visible
                if (post.author === currentUser.username) return true; // Own posts are always visible
                return currentUser.following.includes(post.author); // Private posts only for followers
              });
              
              return visiblePosts.length === 0 ? 
                '<p>Nenhum post visvel.</p>' : 
                visiblePosts.map(post => generatePostHTML(post)).join('');
            })()}
          </div>
          <div id="profile-favorites-${user.username}" class="profile-tab-content" style="display: none;">
            <div class="empty-content"> Nada por aqui</div>
          </div>
          <div id="profile-likes-${user.username}" class="profile-tab-content" style="display: none;">
            <div class="empty-content"> Nada por aqui</div>
          </div>
        </div>
      `;
      
      // Load content for favorites and likes tabs
      setTimeout(() => {
        refreshFavoritesTab(user.username);
        refreshLikesTab(user.username);
      }, 100);
    }

    function showProfileTab(tabName, username) {
      // Hide all tab contents
      document.querySelectorAll(`[id^="profile-"][id$="-${username}"]`).forEach(tab => {
        tab.style.display = 'none';
      });
      
      // Remove active class from all tabs
      document.querySelectorAll('.profile-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected tab content
      const selectedTab = document.getElementById(`profile-${tabName}-${username}`);
      if (selectedTab) {
        selectedTab.style.display = 'block';
      }
      
      // Add active class to clicked tab
      event.target.classList.add('active');
      
      // Refresh content based on tab
      if (tabName === 'favorites') {
        refreshFavoritesTab(username);
      } else if (tabName === 'likes') {
        refreshLikesTab(username);
      }
    }

    function showFollowers(username) {
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      const followersList = user.followers.map(follower => {
        const followerUser = users.find(u => u.username === follower);
        return followerUser ? followerUser.displayName : follower;
      }).join(', ');
      
      alert(`Seguidores de ${user.displayName}:\n\n${followersList || 'Nenhum seguidor'}`);
    }

    function showFollowing(username) {
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      const followingList = user.following.map(followed => {
        const followedUser = users.find(u => u.username === followed);
        return followedUser ? followedUser.displayName : followed;
      }).join(', ');
      
      alert(`${user.displayName} est seguindo:\n\n${followingList || 'Ningum'}`);
    }

    function followUser(username) {
      if (!currentUser) return;
      
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      if (user.followRequests.includes(currentUser.username)) {
        alert('Voc j enviou uma solicitao para este usurio.');
        return;
      }
      
      user.followRequests.push(currentUser.username);
      saveDataToServer();
      
      // Notify the user
      const notification = {
        id: Date.now(),
        userId: username,
        author: currentUser.username,
        displayName: currentUser.displayName,
        text: 'quer seguir voc',
        time: 'agora',
        read: false,
        type: 'follow-request'
      };
      
      notifications.push(notification);
      saveDataToServer();
      
      alert(`Solicitao enviada para ${user.displayName}. Eles precisam aceitar para que voc possa segui-los.`);
      
      if (viewingUserProfile) {
        viewUserProfile(username);
      }
    }

    function unfollowUser(username) {
      if (!currentUser) return;
      
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      currentUser.following = currentUser.following.filter(u => u !== username);
      user.followers = user.followers.filter(u => u !== currentUser.username);
      saveDataToServer();
      
      if (viewingUserProfile) {
        viewUserProfile(username);
      } else {
        generatePosts();
      }
    }

    function loadFollowRequests() {
      if (!currentUser) return;
      
      const requests = notifications.filter(n => 
        n.userId === currentUser.username && 
        n.type === 'follow-request' && 
        !n.read
      );
      
      const container = document.getElementById('follow-requests-container');
      
      if (requests.length === 0) {
        container.innerHTML = '<p>Nenhuma solicitao pendente.</p>';
        return;
      }
      
      container.innerHTML = requests.map(request => {
        const requester = users.find(u => u.username === request.author);
        return `
          <div class="follow-request-item">
            <div class="request-user-info">
              <div class="request-avatar" style="${requester.avatar ? `background-image: url('${requester.avatar}')` : ''}">
                ${requester.avatar ? '' : requester.displayName.charAt(0).toUpperCase()}
              </div>
              <div>
                <div>${requester.displayName}</div>
                <div class="request-username">@${requester.username}</div>
              </div>
            </div>
            <div class="follow-request-buttons">
              <button class="request-btn accept-btn" onclick="acceptFollowRequest('${request.id}', '${requester.username}')">Aceitar</button>
              <button class="request-btn reject-btn" onclick="rejectFollowRequest('${request.id}', '${requester.username}')">Recusar</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function acceptFollowRequest(notificationId, requesterUsername) {
      if (!currentUser) return;
      
      // Mark notification as read
      const notification = notifications.find(n => n.id == notificationId);
      if (notification) {
        notification.read = true;
      }
      
      // Add to followers/following
      const requester = users.find(u => u.username === requesterUsername);
      if (requester) {
        currentUser.followers.push(requesterUsername);
        requester.following.push(currentUser.username);
        
        // Remove from follow requests
        currentUser.followRequests = currentUser.followRequests.filter(u => u !== requesterUsername);
        
        saveDataToServer();
        
        // Notify requester
        const acceptedNotification = {
          id: Date.now(),
          userId: requesterUsername,
          author: currentUser.username,
          displayName: currentUser.displayName,
          text: 'aceitou sua solicitao de seguir',
          time: 'agora',
          read: false
        };
        
        notifications.push(acceptedNotification);
        saveDataToServer();
        
        loadFollowRequests();
        updateNotificationsBadge();
      }
    }

    function rejectFollowRequest(notificationId, requesterUsername) {
      if (!currentUser) return;
      
      // Mark notification as read
      const notification = notifications.find(n => n.id == notificationId);
      if (notification) {
        notification.read = true;
      }
      
      // Remove from follow requests
      currentUser.followRequests = currentUser.followRequests.filter(u => u !== requesterUsername);
      saveDataToServer();
      
      loadFollowRequests();
      updateNotificationsBadge();
    }

    function updateProfile() {
      if (!currentUser) return;
      
      const profileContent = document.getElementById('profile-content');
      const userPosts = posts.filter(p => p.author === currentUser.username);
      
      const avatarStyle = currentUser.avatar ? `background-image: url('${currentUser.avatar}')` : '';
      
      profileContent.innerHTML = `
        <div class="user-profile-header">
          <div class="profile-avatar" style="${avatarStyle}">${currentUser.avatar ? '' : currentUser.displayName.charAt(0).toUpperCase()}</div>
          <div class="profile-info">
            <h2>${currentUser.displayName}</h2>
            <p>@${currentUser.username}</p>
            <div class="profile-stats">
              <div class="stat-item" onclick="showFollowers('${currentUser.username}')">
                <div class="stat-number">${currentUser.followers.length}</div>
                <div class="stat-label">Seguidores</div>
              </div>
              <div class="stat-item" onclick="showFollowing('${currentUser.username}')">
                <div class="stat-number">${currentUser.following.length}</div>
                <div class="stat-label">Seguindo</div>
              </div>
              <div class="stat-item">
                <div class="stat-number">${userPosts.length}</div>
                <div class="stat-label">Posts</div>
              </div>
            </div>
          </div>
        </div>
        <div class="user-posts">
          <h3>Meus Posts</h3>
          ${userPosts.length === 0 ? 
            '<p>Voc ainda no fez nenhum post.</p>' : 
            userPosts.map(post => generatePostHTML(post)).join('')}
        </div>
      `;
    }

    function loadProfileSettings() {
      if (!currentUser) return;
      
      document.getElementById('config-displayname').value = currentUser.displayName;
      
      const avatarPreview = document.getElementById('config-avatar-preview');
      if (currentUser.avatar) {
        avatarPreview.style.backgroundImage = `url('${currentUser.avatar}')`;
        avatarPreview.textContent = '';
      } else {
        avatarPreview.style.backgroundImage = '';
        avatarPreview.textContent = currentUser.displayName.charAt(0).toUpperCase();
      }
    }

    function saveProfileSettings() {
      if (!currentUser) return;
      
      const newDisplayName = document.getElementById('config-displayname').value.trim();
      const avatarFile = document.getElementById('config-avatar').files[0];
      
      if (!newDisplayName) {
        alert('O nome de exibio no pode estar vazio.');
        return;
      }
      
      currentUser.displayName = newDisplayName;
      
      if (avatarFile) {
        currentUser.avatar = URL.createObjectURL(avatarFile);
      }
      
      saveDataToServer();
      updateProfile();
      showLoggedInState(); // Refresh UI
      
      alert('Configuraes salvas com sucesso!');
    }

    function changePassword() {
      if (!currentUser) return;
      
      const currentPassword = document.getElementById('config-current-password').value;
      const newPassword = document.getElementById('config-new-password').value;
      const confirmPassword = document.getElementById('config-confirm-password').value;
      
      if (!currentPassword && (newPassword || confirmPassword)) {
        alert('Para alterar a senha, voc deve fornecer sua senha atual.');
        return;
      }
      
      if (currentPassword && currentPassword !== currentUser.password) {
        alert('Senha atual incorreta.');
        return;
      }
      
      if (newPassword.length < 5 || newPassword.length > 15) {
        alert('A nova senha deve ter entre 5 e 15 caracteres.');
        return;
      }
      
      if (newPassword !== confirmPassword) {
        alert('As novas senhas no coincidem.');
        return;
      }
      
      currentUser.password = newPassword;
      saveDataToServer();
      
      document.getElementById('config-current-password').value = '';
      document.getElementById('config-new-password').value = '';
      document.getElementById('config-confirm-password').value = '';
      
      alert('Senha alterada com sucesso!');
    }

    function togglePostMenu(postId) {
      const dropdown = document.getElementById(`dropdown-${postId}`);
      dropdown.classList.toggle('show');
    }

    function editPost(postId) {
      const post = posts.find(p => p.id == postId);
      if (!post) return;
      
      editingPostId = postId;
      document.getElementById('edit-text').value = post.text;
      document.getElementById('edit-modal').style.display = 'block';
      
      // Close dropdown
      document.getElementById(`dropdown-${postId}`).classList.remove('show');
    }

    function saveEdit() {
      if (!editingPostId) return;
      
      const newText = document.getElementById('edit-text').value.trim();
      const post = posts.find(p => p.id == editingPostId);
      
      if (post) {
        post.text = newText;
        saveDataToServer();
        generatePosts();
      }
      
      closeEditModal();
    }

    function closeEditModal() {
      document.getElementById('edit-modal').style.display = 'none';
      editingPostId = null;
    }

    function deletePost(postId) {
      if (!confirm('Tem certeza que deseja excluir este post?')) return;
      
      posts = posts.filter(p => p.id != postId);
      saveDataToServer();
      generatePosts();
    }

    function openModal(url, type) {
      const modalContent = document.getElementById('modal-content');
      
      if (type === 'image') {
        modalContent.innerHTML = `<img src="${url}" alt="Media">`;
      } else {
        modalContent.innerHTML = `<video src="${url}" controls autoplay></video>`;
      }
      
      document.getElementById('media-modal').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('media-modal').style.display = 'none';
      document.getElementById('modal-content').innerHTML = '';
    }

    function showChat() {
      showPage('chat');
      loadConversations();
    }

    function loadConversations() {
      if (!currentUser) return;
      
      const userConversations = conversations.filter(c => 
        c.user1 === currentUser.username || c.user2 === currentUser.username
      );
      
      const container = document.getElementById('conversations-list');
      
      if (userConversations.length === 0) {
        container.innerHTML = '<p>Nenhuma conversa ainda. Comece uma nova conversa com algum que voc segue!</p>';
        return;
      }
      
      container.innerHTML = userConversations.map(conv => {
        const otherUser = conv.user1 === currentUser.username ? conv.user2 : conv.user1;
        const user = users.find(u => u.username === otherUser);
        const displayName = user ? user.displayName : otherUser;
        const avatarStyle = user && user.avatar ? `background-image: url('${user.avatar}')` : '';
        const lastMessage = conv.messages.length > 0 ? 
          conv.messages[conv.messages.length - 1].text.substring(0, 30) + 
          (conv.messages[conv.messages.length - 1].text.length > 30 ? '...' : '') : 
          'Nenhuma mensagem';
        
        return `
          <div class="user-search-item" onclick="openChat('${otherUser}')">
            <div class="user-search-avatar" style="${avatarStyle}">${user && user.avatar ? '' : displayName.charAt(0).toUpperCase()}</div>
            <div class="user-search-info">
              <div class="user-search-name">${displayName}</div>
              <div class="user-search-username">@${otherUser}</div>
              <div class="last-message">${lastMessage}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function openChat(username) {
      if (!currentUser) return;
      
      const otherUser = users.find(u => u.username === username);
      if (!otherUser) return;
      
      // Find or create conversation
      let conversation = conversations.find(c => 
        (c.user1 === currentUser.username && c.user2 === username) || 
        (c.user1 === username && c.user2 === currentUser.username)
      );
      
      if (!conversation) {
        conversation = {
          id: Date.now(),
          user1: currentUser.username,
          user2: username,
          messages: []
        };
        conversations.push(conversation);
        saveDataToServer();
      }
      
      currentChat = conversation;
      
      // Update UI
      document.getElementById('chat-container').style.display = 'block';
      document.getElementById('chat-with-user').textContent = `Conversando com ${otherUser.displayName}`;
      
      // Load messages
      const messagesContainer = document.getElementById('chat-messages');
      messagesContainer.innerHTML = conversation.messages.map(msg => {
        const isCurrentUser = msg.sender === currentUser.username;
        const user = users.find(u => u.username === msg.sender);
        const displayName = user ? user.displayName : msg.sender;
        
        return `
          <div style="margin-bottom: 10px; text-align: ${isCurrentUser ? 'right' : 'left'}">
            <div style="font-size: 0.8rem; color: #888;">${displayName}</div>
            <div style="background: ${isCurrentUser ? '#6e48aa' : '#36393f'}; 
                display: inline-block; 
                padding: 8px 12px; 
                border-radius: 8px; 
                max-width: 70%; 
                word-wrap: break-word;">
              ${msg.text}
            </div>
            <div style="font-size: 0.7rem; color: #888;">${msg.time}</div>
          </div>
        `;
      }).join('');
      
      // Scroll to bottom
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function closeChat() {
      document.getElementById('chat-container').style.display = 'none';
      currentChat = null;
    }

    function sendMessage() {
      if (!currentUser || !currentChat) return;
      
      const input = document.getElementById('chat-message');
      const messageText = input.value.trim();
      
      if (!messageText) return;
      
      const newMessage = {
        id: Date.now(),
        sender: currentUser.username,
        text: messageText,
        time: 'agora'
      };
      
      currentChat.messages.push(newMessage);
      saveDataToServer();
      
      // Update UI
      const messagesContainer = document.getElementById('chat-messages');
      const otherUser = users.find(u => u.username === (currentChat.user1 === currentUser.username ? currentChat.user2 : currentChat.user1));
      const displayName = otherUser ? otherUser.displayName : currentChat.user2;
      
      messagesContainer.innerHTML += `
        <div style="margin-bottom: 10px; text-align: right">
          <div style="font-size: 0.8rem; color: #888;">${currentUser.displayName}</div>
          <div style="background: #6e48aa; 
              display: inline-block; 
              padding: 8px 12px; 
              border-radius: 8px; 
              max-width: 70%; 
              word-wrap: break-word;">
            ${messageText}
          </div>
          <div style="font-size: 0.7rem; color: #888;">agora</div>
        </div>
      `;
      
      input.value = '';
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // Notify other user
      const notification = {
        id: Date.now(),
        userId: otherUser.username,
        author: currentUser.username,
        displayName: currentUser.displayName,
        text: `enviou uma mensagem: ${messageText.substring(0, 50)}${messageText.length > 50 ? '...' : ''}`,
        time: 'agora',
        read: false,
        type: 'message'
      };
      
      notifications.push(notification);
      saveDataToServer();
      
      if (notification.userId === currentUser.username) {
        updateNotificationsBadge();
      }
    }

    function toggleFavorite(postId) {
      if (!currentUser) return;
      
      const allPosts = [...posts, ...samplePosts];
      const post = allPosts.find(p => p.id === postId);
      
      if (post) {
        if (post.favorited) {
          post.favorites = (post.favorites || 0) - 1;
          post.favorited = false;
        } else {
          post.favorites = (post.favorites || 0) + 1;
          post.favorited = true;
        }
        saveDataToServer();
        
        if (searchActive) {
          handleSearch();
        } else {
          generatePosts();
        }
      }
    }

    function generatePosts() {
      if (!currentUser) return;
      
      const container = document.getElementById('posts-container');
      if (!container) return;
      
      const allPosts = [...posts, ...samplePosts];
      
      // Filter posts based on privacy and following status
      const filteredPosts = allPosts.filter(post => {
        if (!post.private) {
          return true; // Public posts are visible to everyone
        }
        
        // Private posts are only visible to:
        // 1. The author
        // 2. People who follow the author
        if (post.author === currentUser.username) {
          return true; // Own posts are always visible
        }
        
        return currentUser.following.includes(post.author);
      });
      
      if (filteredPosts.length === 0) {
        container.innerHTML = '<div class="no-results">Nenhum post para mostrar.</div>';
        return;
      }
      
      container.innerHTML = filteredPosts
        .sort((a, b) => b.id - a.id)
        .map(post => generatePostHTML(post))
        .join('');
    }

    function loadFollowRequests() {
      if (!currentUser) return;
      
      const container = document.getElementById('follow-requests-list');
      if (!container) return;
      
      const requests = currentUser.followRequests || [];
      
      if (requests.length === 0) {
        container.innerHTML = '<p>Nenhuma solicitao pendente.</p>';
        return;
      }
      
      container.innerHTML = requests.map(username => {
        const user = users.find(u => u.username === username);
        if (!user) return '';
        
        const avatarStyle = user.avatar ? `background-image: url('${user.avatar}')` : '';
        
        return `
          <div class="request-item">
            <div class="request-user-info">
              <div class="request-avatar" style="${avatarStyle}">${user.avatar ? '' : user.displayName.charAt(0).toUpperCase()}</div>
              <div>
                <div class="user-search-name">${user.displayName}</div>
                <div class="user-search-username">@${user.username}</div>
              </div>
            </div>
            <div class="request-buttons">
              <button class="request-btn accept-btn" onclick="acceptFollowRequest('${username}')">Aceitar</button>
              <button class="request-btn reject-btn" onclick="rejectFollowRequest('${username}')">Recusar</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function acceptFollowRequest(username) {
      if (!currentUser) return;
      
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      // Add to followers/following
      currentUser.followers.push(username);
      user.following.push(currentUser.username);
      
      // Remove from follow requests
      currentUser.followRequests = currentUser.followRequests.filter(u => u !== username);
      
      saveDataToServer();
      
      // Notify the requester
      const notification = {
        id: Date.now(),
        userId: username,
        author: currentUser.username,
        displayName: currentUser.displayName,
        text: 'aceitou sua solicitao de seguir',
        time: 'agora',
        read: false
      };
      
      notifications.push(notification);
      saveDataToServer();
      
      loadFollowRequests();
      updateNotificationsBadge();
    }

    function rejectFollowRequest(username) {
      if (!currentUser) return;
      
      // Remove from follow requests
      currentUser.followRequests = currentUser.followRequests.filter(u => u !== username);
      saveDataToServer();
      
      loadFollowRequests();
    }

    // Password visibility toggle function
    function togglePasswordVisibility(inputId, button) {
      const input = document.getElementById(inputId);
      const isPassword = input.type === 'password';
      
      input.type = isPassword ? 'text' : 'password';
      button.textContent = isPassword ? '' : '';
    }

    // Show reset password form
    function showResetPasswordForm() {
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('reset-password-form').style.display = 'block';
      document.getElementById('register-form').style.display = 'none';
      
      // Reset auth tabs
      document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
    }

    // Show login form
    function showLoginForm() {
      document.getElementById('login-form').style.display = 'block';
      document.getElementById('reset-password-form').style.display = 'none';
      document.getElementById('register-form').style.display = 'none';
      
      // Activate login tab
      document.getElementById('login-tab').classList.add('active');
      document.getElementById('register-tab').classList.remove('active');
      
      // Clear reset form
      document.getElementById('reset-username').value = '';
      document.getElementById('reset-new-password').value = '';
      document.getElementById('reset-confirm-password').value = '';
      document.getElementById('reset-status').textContent = '';
      document.getElementById('reset-status').className = 'notice';
    }

    // Reset password function
    function resetPassword() {
      const username = document.getElementById('reset-username').value.trim();
      const newPassword = document.getElementById('reset-new-password').value;
      const confirmPassword = document.getElementById('reset-confirm-password').value;
      const statusElement = document.getElementById('reset-status');
      
      // Clear previous status
      statusElement.textContent = '';
      statusElement.className = 'notice';
      
      // Validation
      if (!username) {
        statusElement.textContent = ' Por favor, digite seu nome de usurio.';
        statusElement.className = 'notice error';
        return;
      }
      
      if (!newPassword || newPassword.length < 5 || newPassword.length > 15) {
        statusElement.textContent = ' A senha deve ter entre 5 e 15 caracteres.';
        statusElement.className = 'notice error';
        return;
      }
      
      if (newPassword !== confirmPassword) {
        statusElement.textContent = ' As senhas no coincidem.';
        statusElement.className = 'notice error';
        return;
      }
      
      // Find user
      const user = users.find(u => u.username === username);
      if (!user) {
        statusElement.textContent = ' Usurio no encontrado.';
        statusElement.className = 'notice error';
        return;
      }
      
      // Update password
      user.password = newPassword;
      saveDataToServer();
      
      statusElement.textContent = ' Senha redefinida com sucesso! Voc pode fazer login agora.';
      statusElement.className = 'notice success';
      
      // Clear form and return to login after 2 seconds
      setTimeout(() => {
        showLoginForm();
      }, 2000);
    }

    // Download post function
    function downloadPost(postId) {
      const allPosts = [...posts, ...samplePosts];
      const post = allPosts.find(p => p.id === postId);
      
      if (!post) return;
      
      if (post.media) {
        // Download media if available
        downloadMedia(post.media.url, post.media.type);
      } else {
        // Download text as file
        const content = `Post de ${post.displayName} (@${post.author})\n\n${post.text}\n\nPostado em: ${post.time}`;
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `post-${post.id}-${post.author}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
    }

    // Profile tabs function
    function showProfileTab(tabType, username) {
      // Remove active class from all tabs
      document.querySelectorAll('.profile-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Hide all tab contents
      document.querySelectorAll('.profile-tab-content').forEach(content => {
        content.classList.remove('active');
        content.style.display = 'none';
      });
      
      // Show selected tab
      const selectedTab = event.target;
      selectedTab.classList.add('active');
      
      const selectedContent = document.getElementById(`profile-${tabType}-${username}`);
      if (selectedContent) {
        selectedContent.classList.add('active');
        selectedContent.style.display = 'block';
      }
      
      // If showing favorites or likes, refresh the content
      if (tabType === 'favorites') {
        refreshFavoritesTab(username);
      } else if (tabType === 'likes') {
        refreshLikesTab(username);
      }
    }

    // Refresh favorites tab
    function refreshFavoritesTab(username) {
      const container = document.getElementById(`profile-favorites-${username}`);
      if (!container) return;
      
      const allPosts = [...posts, ...samplePosts];
      const favoritePosts = allPosts.filter(post => post.favorited && (
        !post.private || 
        post.author === currentUser.username || 
        currentUser.following.includes(post.author)
      ));
      
      container.innerHTML = favoritePosts.length === 0 ? 
        '<div class="empty-content"> Nada por aqui</div>' : 
        favoritePosts.map(post => generatePostHTML(post)).join('');
    }

    // Refresh likes tab
    function refreshLikesTab(username) {
      const container = document.getElementById(`profile-likes-${username}`);
      if (!container) return;
      
      const allPosts = [...posts, ...samplePosts];
      const likedPosts = allPosts.filter(post => (post.liked || post.disliked) && (
        !post.private || 
        post.author === currentUser.username || 
        currentUser.following.includes(post.author)
      ));
      
      container.innerHTML = likedPosts.length === 0 ? 
        '<div class="empty-content"> Nada por aqui</div>' : 
        likedPosts.map(post => generatePostHTML(post)).join('');
    }

    // Ban system functions
    let currentBanUsername = null;

    function showBanModal(username) {
      currentBanUsername = username;
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      document.getElementById('ban-username').textContent = user.displayName;
      document.getElementById('ban-modal').style.display = 'flex';
      
      // Reset form
      document.querySelectorAll('input[name="ban-duration"]').forEach(radio => {
        radio.checked = false;
      });
      document.getElementById('custom-ban-section').style.display = 'none';
      document.getElementById('custom-ban-days').value = '';
      document.getElementById('ban-reason').value = '';
    }

    function closeBanModal() {
      document.getElementById('ban-modal').style.display = 'none';
      currentBanUsername = null;
    }

    function confirmBan() {
      if (!currentBanUsername || !currentUser || !currentUser.isAdmin) return;
      
      const selectedDuration = document.querySelector('input[name="ban-duration"]:checked');
      if (!selectedDuration) {
        alert('Por favor, selecione uma durao para o banimento.');
        return;
      }
      
      const user = users.find(u => u.username === currentBanUsername);
      if (!user) return;
      
      let banExpiry = null;
      const now = new Date();
      
      switch (selectedDuration.value) {
        case '1day':
          banExpiry = new Date(now.getTime() + 24 * 60 * 60 * 1000);
          break;
        case '1week':
          banExpiry = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
          break;
        case 'forever':
          banExpiry = null; // Permanent ban
          break;
        case 'custom':
          const customDays = parseInt(document.getElementById('custom-ban-days').value);
          if (!customDays || customDays < 1) {
            alert('Por favor, digite um nmero vlido de dias.');
            return;
          }
          banExpiry = new Date(now.getTime() + customDays * 24 * 60 * 60 * 1000);
          break;
      }
      
      const reason = document.getElementById('ban-reason').value.trim();
      
      // Apply ban
      user.banned = true;
      user.banExpiry = banExpiry;
      user.banReason = reason || 'No especificado';
      
      saveDataToServer();
      
      // Notify user about ban
      const banDurationText = banExpiry ? 
        `at ${banExpiry.toLocaleDateString('pt-BR')}` : 
        'permanentemente';
      
      alert(`Usurio ${user.displayName} foi banido ${banDurationText}.`);
      
      closeBanModal();
      
      // Refresh profile if viewing banned user
      if (viewingUserProfile && viewingUserProfile.username === currentBanUsername) {
        viewUserProfile(currentBanUsername);
      }
      
      // Refresh posts to hide banned content
      generatePosts();
    }

    function unbanUser(username) {
      if (!currentUser || !currentUser.isAdmin) return;
      
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      if (confirm(`Tem certeza que deseja desbanir ${user.displayName}?`)) {
        user.banned = false;
        user.banExpiry = null;
        user.banReason = null;
        
        saveDataToServer();
        
        alert(`Usurio ${user.displayName} foi desbanido.`);
        
        // Refresh profile
        if (viewingUserProfile && viewingUserProfile.username === username) {
          viewUserProfile(username);
        }
        
        // Refresh posts to show unbanned content
        generatePosts();
      }
    }

    // Check ban status on login
    function checkUserBanStatus() {
      if (!currentUser) return;
      
      if (isUserBanned(currentUser)) {
        const banMessage = currentUser.banExpiry ? 
          `Voc est banido at ${new Date(currentUser.banExpiry).toLocaleDateString('pt-BR')}.` :
          'Voc est banido permanentemente.';
        
        const reason = currentUser.banReason ? 
          `\n\nMotivo: ${currentUser.banReason}` : '';
        
        alert(` ${banMessage}${reason}\n\nVoc no pode interagir com o contedo enquanto estiver banido.`);
      }
    }

    // Search functionality
    function handleSearch() {
      if (!currentUser) return;
      
      const query = document.getElementById('search-input').value.trim().toLowerCase();
      const searchResults = document.getElementById('search-results');
      const postsContainer = document.getElementById('search-posts-container');
      const usersContainer = document.getElementById('search-users-container');
      const searchTitle = document.getElementById('search-title');
      
      if (!query) {
        searchResults.style.display = 'none';
        searchActive = false;
        generatePosts();
        return;
      }
      
      searchActive = true;
      searchQuery = query;
      
      // Search posts
      const allPosts = [...posts, ...samplePosts];
      const matchingPosts = allPosts.filter(post => {
        const matchesText = post.text && post.text.toLowerCase().includes(query);
        const matchesAuthor = post.displayName && post.displayName.toLowerCase().includes(query);
        
        // Check privacy
        if (post.private && post.author !== currentUser.username && !currentUser.following.includes(post.author)) {
          return false;
        }
        
        return matchesText || matchesAuthor;
      });
      
      // Search users
      const matchingUsers = users.filter(user => {
        const matchesName = user.displayName && user.displayName.toLowerCase().includes(query);
        const matchesUsername = user.username && user.username.toLowerCase().includes(query);
        return (matchesName || matchesUsername) && user.username !== currentUser.username;
      });
      
      // Update UI
      searchTitle.textContent = ` Resultados para "${query}"`;
      
      if (matchingPosts.length === 0 && matchingUsers.length === 0) {
        postsContainer.innerHTML = '<div class="no-results">Nenhum resultado encontrado.</div>';
        usersContainer.innerHTML = '';
      } else {
        postsContainer.innerHTML = matchingPosts.length > 0 ? 
          matchingPosts.map(post => generatePostHTML(post)).join('') : 
          '<div class="no-results">Nenhum post encontrado.</div>';
        
        usersContainer.innerHTML = matchingUsers.length > 0 ? 
          matchingUsers.map(user => generateUserSearchHTML(user)).join('') : '';
      }
      
      searchResults.style.display = 'block';
    }

    function generateUserSearchHTML(user) {
      const avatarStyle = user.avatar ? `background-image: url('${user.avatar}')` : '';
      const isFollowing = currentUser.following.includes(user.username);
      const hasPendingRequest = user.followRequests && user.followRequests.includes(currentUser.username);
      const isBanned = isUserBanned(user);
      
      return `
        <div class="search-user-profile">
          <div class="search-user-avatar" onclick="viewUserProfile('${user.username}')" style="${avatarStyle}">
            ${user.avatar ? '' : user.displayName.charAt(0).toUpperCase()}
          </div>
          <div class="search-user-info">
            <div class="search-user-name" onclick="viewUserProfile('${user.username}')">${user.displayName}</div>
            <div class="search-user-username" onclick="viewUserProfile('${user.username}')">@${user.username}</div>
            ${isBanned ? '<div style="color: #ff6666; font-size: 0.8rem;"> Usurio banido</div>' : ''}
            <div class="search-user-actions">
              ${!isBanned ? `
                ${isFollowing ? 
                  `<button class="follow-btn following" onclick="unfollowUser('${user.username}')">Seguindo</button>` :
                  hasPendingRequest ? 
                    `<button class="follow-btn pending" disabled>Solicitao Enviada</button>` :
                    `<button class="follow-btn" onclick="followUser('${user.username}')">Seguir</button>`
                }
                <button class="send-message-btn" onclick="startConversation('${user.username}')">Mensagem</button>
              ` : ''}
              ${currentUser.isAdmin && !isBanned ? 
                `<button class="ban-btn" onclick="showBanModal('${user.username}')">Banir</button>` : ''}
              ${currentUser.isAdmin && isBanned ? 
                `<button class="ban-btn unban" onclick="unbanUser('${user.username}')">Desbanir</button>` : ''}
            </div>
          </div>
        </div>
      `;
    }

    function startConversation(username) {
      showPage('chat');
      setTimeout(() => openChat(username), 100);
    }

    // ==================== POST GENERATION FUNCTIONS ====================
    
    function generatePosts() {
      if (!currentUser) return;
      
      const container = document.getElementById('posts-container');
      if (!container) return;
      
      const allPosts = [...posts, ...samplePosts];
      
      // Filter posts based on privacy and following status
      const visiblePosts = allPosts.filter(post => {
        if (post.private && post.author !== currentUser.username && !currentUser.following.includes(post.author)) {
          return false;
        }
        
        // Hide posts from banned users
        const author = users.find(u => u.username === post.author);
        if (author && isUserBanned(author)) {
          return false;
        }
        
        return true;
      });
      
      if (visiblePosts.length === 0) {
        container.innerHTML = '<div class="no-posts">Nenhum post para mostrar. Siga alguns usurios ou crie o primeiro post!</div>';
        return;
      }
      
      container.innerHTML = visiblePosts.map(post => generatePostHTML(post)).join('');
    }

    function generatePostHTML(post) {
      const isOwner = currentUser && post.author === currentUser.username;
      const avatarStyle = post.avatar ? `background-image: url('${post.avatar}')` : '';
      const likedClass = post.liked ? 'liked' : '';
      const dislikedClass = post.disliked ? 'disliked' : '';
      const favoritedClass = post.favorited ? 'favorited' : '';
      
      let mediaHTML = '';
      if (post.media) {
        if (post.media.type === 'image') {
          mediaHTML = `
            <div class="post-media" onclick="openMediaModal('${post.media.url}', 'image')">
              <img src="${post.media.url}" alt="Post image" class="post-image">
            </div>
          `;
        } else if (post.media.type === 'video') {
          mediaHTML = `
            <div class="post-media">
              <video src="${post.media.url}" controls class="post-video"></video>
            </div>
          `;
        } else if (post.media.type === 'audio') {
          const musicTitle = post.media.name ? post.media.name.replace(/\.[^/.]+$/, "") : 'Msica';
          mediaHTML = createPostMusicPlayer(post.media.url, musicTitle);
        }
      }
      
      const communityTag = post.community ? 
        `<div class="post-community-tag"> ${communities.find(c => c.id === post.community)?.name || 'Comunidade'}</div>` : '';
      
      return `
        <div class="post" id="post-${post.id}">
          <div class="post-header">
            <div class="post-avatar" onclick="viewUserProfile('${post.author}')" style="${avatarStyle}">
              ${post.avatar ? '' : post.displayName.charAt(0).toUpperCase()}
            </div>
            <div class="post-author" onclick="viewUserProfile('${post.author}')">${post.displayName}</div>
            <div class="post-time">${post.time}</div>
            ${post.private ? '<div class="private-indicator"></div>' : ''}
            
            <div class="post-menu" onclick="togglePostDropdown(${post.id})">
              <div class="post-menu-dots"></div>
              <div class="post-dropdown" id="dropdown-${post.id}">
                ${isOwner ? `
                  <button class="dropdown-item edit" onclick="editPost(${post.id})"> Editar</button>
                  <button class="dropdown-item delete" onclick="deletePost(${post.id})"> Excluir</button>
                ` : ''}
                ${post.media ? `
                  <button class="dropdown-item download" onclick="downloadMedia('${post.media.url}', '${post.media.type}')"> Download</button>
                ` : ''}
                <button class="dropdown-item share" onclick="sharePost(${post.id})"> Compartilhar</button>
                ${currentUser.isAdmin && !isOwner ? `
                  <button class="dropdown-item delete" onclick="deletePost(${post.id})"> Excluir (Admin)</button>
                ` : ''}
              </div>
            </div>
          </div>
          
          <div class="post-content">
            ${communityTag}
            ${post.text ? `<div class="post-text">${post.text}</div>` : ''}
            ${mediaHTML}
          </div>
          
          <div class="post-actions">
            <button class="action-btn ${likedClass}" onclick="toggleLike(${post.id})">
               ${post.likes || 0}
            </button>
            <button class="action-btn ${dislikedClass}" onclick="toggleDislike(${post.id})">
               ${post.dislikes || 0}
            </button>
            <button class="action-btn ${favoritedClass}" onclick="toggleFavorite(${post.id})">
               ${post.favorites || 0}
            </button>
            <button class="action-btn" onclick="toggleComments(${post.id})">
               ${post.commentsCount || 0}
            </button>
          </div>
          
          <div class="post-comments" id="comments-${post.id}" style="display: none;">
            <div class="comment-input">
              <input type="text" id="comment-input-${post.id}" placeholder="Escreva um comentrio...">
              <button onclick="addComment(${post.id})">Enviar</button>
            </div>
            <div class="comments-list" id="comments-list-${post.id}">
              ${renderComments(post.id)}
            </div>
          </div>
        </div>
      `;
    }

    function renderComments(postId) {
      const postComments = comments.filter(c => c.postId == postId);
      
      if (postComments.length === 0) {
        return '<div class="no-comments">Nenhum comentrio ainda.</div>';
      }
      
      return postComments.map(comment => {
        const commenter = users.find(u => u.username === comment.author);
        const avatarStyle = commenter?.avatar ? `background-image: url('${commenter.avatar}')` : '';
        
        return `
          <div class="comment">
            <div class="comment-avatar" style="${avatarStyle}">
              ${commenter?.avatar ? '' : (commenter?.displayName || comment.author).charAt(0).toUpperCase()}
            </div>
            <div class="comment-content">
              <div class="comment-author">${commenter?.displayName || comment.author}</div>
              <div class="comment-text">${comment.text}</div>
              <div class="comment-time">${comment.time}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function togglePostDropdown(postId) {
      const dropdown = document.getElementById(`dropdown-${postId}`);
      
      // Close all other dropdowns
      document.querySelectorAll('.post-dropdown').forEach(d => {
        if (d.id !== `dropdown-${postId}`) {
          d.classList.remove('show');
        }
      });
      
      dropdown.classList.toggle('show');
    }

    function toggleComments(postId) {
      const commentsSection = document.getElementById(`comments-${postId}`);
      const isVisible = commentsSection.style.display !== 'none';
      
      if (isVisible) {
        commentsSection.style.display = 'none';
      } else {
        commentsSection.style.display = 'block';
        // Load comments if not already loaded
        const commentsList = document.getElementById(`comments-list-${postId}`);
        commentsList.innerHTML = renderComments(postId);
      }
    }

    function editPost(postId) {
      const post = [...posts, ...samplePosts].find(p => p.id === postId);
      if (!post || post.author !== currentUser.username) return;
      
      editingPostId = postId;
      document.getElementById('edit-text').value = post.text || '';
      document.getElementById('edit-modal').style.display = 'block';
      
      // Close dropdown
      document.getElementById(`dropdown-${postId}`).classList.remove('show');
    }

    function deletePost(postId) {
      const post = [...posts, ...samplePosts].find(p => p.id === postId);
      if (!post) return;
      
      const canDelete = post.author === currentUser.username || currentUser.isAdmin;
      if (!canDelete) return;
      
      if (confirm('Tem certeza que deseja excluir este post?')) {
        // Remove from posts array
        const postIndex = posts.findIndex(p => p.id === postId);
        if (postIndex !== -1) {
          posts.splice(postIndex, 1);
        }
        
        // Remove from community if it's a community post
        if (post.community) {
          const community = communities.find(c => c.id === post.community);
          if (community) {
            community.posts = community.posts.filter(p => p.id !== postId);
          }
        }
        
        // Remove related comments
        comments = comments.filter(c => c.postId !== postId);
        
        saveDataToServer();
        generatePosts();
        
        showNotification(' Post excludo!', 'success');
      }
      
      // Close dropdown
      document.getElementById(`dropdown-${postId}`).classList.remove('show');
    }

    function openMediaModal(url, type) {
      const modal = document.getElementById('media-modal');
      const content = document.getElementById('modal-content');
      
      if (type === 'image') {
        content.innerHTML = `<img src="${url}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
      } else if (type === 'video') {
        content.innerHTML = `<video src="${url}" controls style="max-width: 100%; max-height: 100%;">`;
      }
      
      modal.style.display = 'flex';
    }

    // Close modals when clicking outside
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('modal')) {
        e.target.style.display = 'none';
      }
      
      if (e.target.classList.contains('community-modal')) {
        closeCommunityModal();
      }
      
      // Close post dropdowns when clicking outside
      if (!e.target.closest('.post-menu')) {
        document.querySelectorAll('.post-dropdown').forEach(d => d.classList.remove('show'));
      }
    });

    // ==================== UTILITY FUNCTIONS ====================
    
    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? 'linear-gradient(45deg, #00ff88, #00cc6a)' : 
                     type === 'error' ? 'linear-gradient(45deg, #ff6666, #ff4444)' : 
                     'linear-gradient(45deg, #7c3aed, #9f7aea)'};
        color: ${type === 'success' ? '#000' : '#fff'};
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        z-index: 3000;
        font-weight: bold;
        max-width: 300px;
        word-wrap: break-word;
        animation: slideIn 0.3s ease;
      `;
      
      notification.textContent = message;
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Add CSS animations for notifications
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);

    // ==================== MODAL FUNCTIONS ====================
    
    function saveEditedPost() {
      if (!editingPostId) return;
      
      const newText = document.getElementById('edit-text').value.trim();
      const post = posts.find(p => p.id === editingPostId);
      
      if (post) {
        post.text = newText;
        saveDataToServer();
        generatePosts();
        showNotification(' Post editado!', 'success');
      }
      
      cancelEdit();
    }

    function cancelEdit() {
      document.getElementById('edit-modal').style.display = 'none';
      document.getElementById('edit-text').value = '';
      editingPostId = null;
    }

    function copyShareLink() {
      const shareLink = document.getElementById('share-link').textContent;
      navigator.clipboard.writeText(shareLink).then(() => {
        const btn = document.getElementById('copy-link-btn');
        const originalText = btn.textContent;
        btn.textContent = ' Copiado!';
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      });
    }

    function closeShareModal() {
      document.getElementById('share-modal').style.display = 'none';
    }

    // Add event listeners for modals
    document.addEventListener('DOMContentLoaded', function() {
      // Edit Modal
      const saveEditBtn = document.getElementById('save-edit-btn');
      const cancelEditBtn = document.getElementById('cancel-edit-btn');
      if (saveEditBtn) saveEditBtn.addEventListener('click', saveEditedPost);
      if (cancelEditBtn) cancelEditBtn.addEventListener('click', cancelEdit);
      
      // Share Modal
      const copyLinkBtn = document.getElementById('copy-link-btn');
      const closeShareBtn = document.getElementById('close-share-btn');
      if (copyLinkBtn) copyLinkBtn.addEventListener('click', copyShareLink);
      if (closeShareBtn) closeShareBtn.addEventListener('click', closeShareModal);
      
      // Media Modal
      const closeModalBtn = document.querySelector('.close-modal');
      if (closeModalBtn) {
        closeModalBtn.addEventListener('click', function() {
          document.getElementById('media-modal').style.display = 'none';
        });
      }
    });

    // ==================== MUSIC PLAYER FUNCTIONS ====================
    
    function initializeMusicPlayer() {
      audioPlayer = document.getElementById('audio-player');
      
      audioPlayer.addEventListener('loadedmetadata', updateMusicInfo);
      audioPlayer.addEventListener('timeupdate', updateProgress);
      audioPlayer.addEventListener('ended', nextTrack);
      audioPlayer.addEventListener('error', handleAudioError);
      
      // Load saved playlist from localStorage
      const savedPlaylist = localStorage.getItem('salomusic_playlist');
      if (savedPlaylist) {
        currentPlaylist = JSON.parse(savedPlaylist);
        updatePlaylistDisplay();
      }
    }

    function handleMusicUpload(event) {
      const files = Array.from(event.target.files);
      
      files.forEach(file => {
        if (file.type.startsWith('audio/')) {
          const url = URL.createObjectURL(file);
          const track = {
            id: Date.now() + Math.random(),
            name: file.name.replace(/\.[^/.]+$/, ""),
            artist: 'Artista Desconhecido',
            url: url,
            duration: 0
          };
          
          currentPlaylist.push(track);
        }
      });
      
      updatePlaylistDisplay();
      savePlaylist();
      
      if (currentPlaylist.length === 1) {
        loadTrack(0);
      }
      
      showNotification(` ${files.length} msica(s) adicionada(s)  playlist!`, 'success');
    }

    function updatePlaylistDisplay() {
      const container = document.getElementById('playlist-items');
      
      if (currentPlaylist.length === 0) {
        container.innerHTML = '<p style="color: #888; text-align: center; padding: 1rem;">Nenhuma msica na playlist. Adicione algumas msicas!</p>';
        return;
      }
      
      container.innerHTML = currentPlaylist.map((track, index) => `
        <div class="playlist-item ${index === currentTrackIndex ? 'active' : ''}" onclick="loadTrack(${index})">
          <div class="playlist-item-info">
            <div class="playlist-item-title">${track.name}</div>
            <div class="playlist-item-duration">${formatTime(track.duration)}</div>
          </div>
          <button class="playlist-item-remove" onclick="removeTrack(${index}); event.stopPropagation();"></button>
        </div>
      `).join('');
    }

    function loadTrack(index) {
      if (index < 0 || index >= currentPlaylist.length) return;
      
      currentTrackIndex = index;
      const track = currentPlaylist[index];
      
      audioPlayer.src = track.url;
      audioPlayer.load();
      
      document.getElementById('music-title').textContent = track.name;
      document.getElementById('music-artist').textContent = track.artist;
      
      updatePlaylistDisplay();
    }

    function togglePlay() {
      if (currentPlaylist.length === 0) {
        showNotification(' Adicione msicas  playlist primeiro!', 'error');
        return;
      }
      
      if (isPlaying) {
        audioPlayer.pause();
        document.getElementById('play-btn').textContent = '';
        isPlaying = false;
      } else {
        audioPlayer.play();
        document.getElementById('play-btn').textContent = '';
        isPlaying = true;
      }
    }

    function previousTrack() {
      if (currentPlaylist.length === 0) return;
      
      const newIndex = currentTrackIndex > 0 ? currentTrackIndex - 1 : currentPlaylist.length - 1;
      loadTrack(newIndex);
      
      if (isPlaying) {
        setTimeout(() => audioPlayer.play(), 100);
      }
    }

    function nextTrack() {
      if (currentPlaylist.length === 0) return;
      
      const newIndex = currentTrackIndex < currentPlaylist.length - 1 ? currentTrackIndex + 1 : 0;
      loadTrack(newIndex);
      
      if (isPlaying) {
        setTimeout(() => audioPlayer.play(), 100);
      }
    }

    function seekTo(event) {
      if (!audioPlayer.duration) return;
      
      const progressBar = event.currentTarget;
      const rect = progressBar.getBoundingClientRect();
      const percent = (event.clientX - rect.left) / rect.width;
      const newTime = percent * audioPlayer.duration;
      
      audioPlayer.currentTime = newTime;
    }

    function changeVolume(event) {
      const volume = event.target.value / 100;
      audioPlayer.volume = volume;
      document.getElementById('volume-display').textContent = `${event.target.value}%`;
    }

    function updateProgress() {
      if (!audioPlayer.duration) return;
      
      const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
      document.getElementById('progress-fill').style.width = `${percent}%`;
      
      document.getElementById('current-time').textContent = formatTime(audioPlayer.currentTime);
      document.getElementById('total-time').textContent = formatTime(audioPlayer.duration);
    }

    function updateMusicInfo() {
      const track = currentPlaylist[currentTrackIndex];
      if (track) {
        track.duration = audioPlayer.duration;
        updatePlaylistDisplay();
      }
    }

    function removeTrack(index) {
      currentPlaylist.splice(index, 1);
      
      if (index === currentTrackIndex) {
        if (currentPlaylist.length === 0) {
          audioPlayer.pause();
          audioPlayer.src = '';
          document.getElementById('music-title').textContent = 'Nenhuma msica selecionada';
          document.getElementById('music-artist').textContent = 'Selecione uma msica para comear';
          document.getElementById('play-btn').textContent = '';
          isPlaying = false;
          currentTrackIndex = 0;
        } else {
          const newIndex = index >= currentPlaylist.length ? 0 : index;
          loadTrack(newIndex);
        }
      } else if (index < currentTrackIndex) {
        currentTrackIndex--;
      }
      
      updatePlaylistDisplay();
      savePlaylist();
    }

    function savePlaylist() {
      localStorage.setItem('salomusic_playlist', JSON.stringify(currentPlaylist));
    }

    function formatTime(seconds) {
      if (isNaN(seconds)) return '0:00';
      
      const minutes = Math.floor(seconds / 60);
      const remainingSeconds = Math.floor(seconds % 60);
      return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
    }

    function handleAudioError() {
      showNotification(' Erro ao carregar a msica!', 'error');
      nextTrack();
    }

    // Post Music Functions
    function createPostMusicPlayer(mediaUrl, title = 'Msica') {
      const playerId = `post-player-${Date.now()}`;
      
      return `
        <div class="post-music-player" id="${playerId}">
          <div class="post-music-controls">
            <button class="post-play-btn" onclick="togglePostMusic('${playerId}', '${mediaUrl}')"></button>
            <div class="post-music-info">
              <div class="post-music-title">${title}</div>
              <div class="post-progress-bar" onclick="seekPostMusic('${playerId}', event)">
                <div class="post-progress-fill"></div>
              </div>
              <div class="post-time-display">
                <span class="current-time">0:00</span>
                <span class="total-time">0:00</span>
              </div>
            </div>
          </div>
          <audio preload="metadata" onloadedmetadata="updatePostMusicInfo('${playerId}')" ontimeupdate="updatePostProgress('${playerId}')" onended="stopPostMusic('${playerId}')">
            <source src="${mediaUrl}" type="audio/mpeg">
          </audio>
        </div>
      `;
    }

    function togglePostMusic(playerId, mediaUrl) {
      const player = document.getElementById(playerId);
      const audio = player.querySelector('audio');
      const playBtn = player.querySelector('.post-play-btn');
      
      // Pause all other post music players
      document.querySelectorAll('.post-music-player audio').forEach(otherAudio => {
        if (otherAudio !== audio && !otherAudio.paused) {
          otherAudio.pause();
          otherAudio.parentElement.querySelector('.post-play-btn').textContent = '';
        }
      });
      
      if (audio.paused) {
        audio.play();
        playBtn.textContent = '';
      } else {
        audio.pause();
        playBtn.textContent = '';
      }
    }

    function seekPostMusic(playerId, event) {
      const player = document.getElementById(playerId);
      const audio = player.querySelector('audio');
      const progressBar = event.currentTarget;
      
      if (!audio.duration) return;
      
      const rect = progressBar.getBoundingClientRect();
      const percent = (event.clientX - rect.left) / rect.width;
      const newTime = percent * audio.duration;
      
      audio.currentTime = newTime;
    }

    function updatePostProgress(playerId) {
      const player = document.getElementById(playerId);
      const audio = player.querySelector('audio');
      const progressFill = player.querySelector('.post-progress-fill');
      const currentTimeSpan = player.querySelector('.current-time');
      
      if (!audio.duration) return;
      
      const percent = (audio.currentTime / audio.duration) * 100;
      progressFill.style.width = `${percent}%`;
      currentTimeSpan.textContent = formatTime(audio.currentTime);
    }

    function updatePostMusicInfo(playerId) {
      const player = document.getElementById(playerId);
      const audio = player.querySelector('audio');
      const totalTimeSpan = player.querySelector('.total-time');
      
      totalTimeSpan.textContent = formatTime(audio.duration);
    }

    function stopPostMusic(playerId) {
      const player = document.getElementById(playerId);
      const playBtn = player.querySelector('.post-play-btn');
      playBtn.textContent = '';
    }

    // ==================== YOUTUBE MUSIC PLAYER FUNCTIONS ====================
    
    let youtubePlaylist = [];
    let currentYouTubeIndex = 0;

    function addYouTubeVideo() {
      const url = document.getElementById('youtube-url-input').value.trim();
      if (!url) {
        showNotification(' Cole um link do YouTube!', 'error');
        return;
      }

      const videoId = extractYouTubeVideoId(url);
      if (!videoId) {
        showNotification(' Link do YouTube invlido!', 'error');
        return;
      }

      const videoData = {
        id: videoId,
        title: 'Msica do YouTube',
        channel: 'YouTube',
        thumbnail: `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`
      };

      youtubePlaylist.push(videoData);
      updateYouTubePlaylist();
      
      if (youtubePlaylist.length === 1) {
        loadYouTubeVideo(0);
      }

      document.getElementById('youtube-url-input').value = '';
      showNotification(' Vdeo adicionado  playlist!', 'success');
    }

    function extractYouTubeVideoId(url) {
      const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
      const match = url.match(regex);
      return match ? match[1] : null;
    }

    function loadYouTubeVideo(index) {
      if (index < 0 || index >= youtubePlaylist.length) return;

      currentYouTubeIndex = index;
      const video = youtubePlaylist[index];
      
      const iframe = document.getElementById('youtube-iframe');
      iframe.src = `https://www.youtube.com/embed/${video.id}?enablejsapi=1&autoplay=0`;
      
      document.getElementById('youtube-player-container').style.display = 'block';
      document.getElementById('youtube-controls').style.display = 'flex';
      document.getElementById('youtube-playlist').style.display = 'block';
      
      updateYouTubePlaylist();
    }

    function updateYouTubePlaylist() {
      const container = document.getElementById('youtube-playlist-items');
      
      if (youtubePlaylist.length === 0) {
        container.innerHTML = '<p style="color: #888; text-align: center; padding: 1rem;">Nenhuma msica na playlist. Adicione algumas!</p>';
        return;
      }

      container.innerHTML = youtubePlaylist.map((video, index) => `
        <div class="youtube-playlist-item ${index === currentYouTubeIndex ? 'active' : ''}" onclick="loadYouTubeVideo(${index})">
          <img src="${video.thumbnail}" alt="${video.title}" class="youtube-thumbnail">
          <div class="youtube-item-info">
            <div class="youtube-item-title">${video.title}</div>
            <div class="youtube-item-channel">${video.channel}</div>
          </div>
          <button class="youtube-item-remove" onclick="removeYouTubeVideo(${index}); event.stopPropagation();"></button>
        </div>
      `).join('');
    }

    function removeYouTubeVideo(index) {
      youtubePlaylist.splice(index, 1);
      
      if (currentYouTubeIndex >= index && currentYouTubeIndex > 0) {
        currentYouTubeIndex--;
      }
      
      if (youtubePlaylist.length === 0) {
        document.getElementById('youtube-player-container').style.display = 'none';
        document.getElementById('youtube-controls').style.display = 'none';
        document.getElementById('youtube-playlist').style.display = 'none';
      } else if (index === currentYouTubeIndex) {
        loadYouTubeVideo(currentYouTubeIndex);
      }
      
      updateYouTubePlaylist();
    }

    function previousYouTubeVideo() {
      if (currentYouTubeIndex > 0) {
        loadYouTubeVideo(currentYouTubeIndex - 1);
      }
    }

    function nextYouTubeVideo() {
      if (currentYouTubeIndex < youtubePlaylist.length - 1) {
        loadYouTubeVideo(currentYouTubeIndex + 1);
      }
    }

    function toggleYouTubePlayback() {
      const playBtn = document.getElementById('youtube-play-btn');
      if (playBtn.textContent === '') {
        playBtn.textContent = '';
      } else {
        playBtn.textContent = '';
      }
    }

    // ==================== ENHANCED SEARCH FUNCTIONS ====================
    
    function enhanceSearchInput() {
      const searchInput = document.getElementById('search-input');
      const searchTypeIndicator = document.getElementById('search-type-indicator');
      const searchSuggestions = document.getElementById('search-suggestions');

      if (!searchInput) return;

      searchInput.addEventListener('input', function() {
        const value = this.value;
        
        if (value.startsWith('u/')) {
          searchTypeIndicator.textContent = 'u/';
          searchTypeIndicator.style.display = 'block';
          searchTypeIndicator.style.color = '#00ffcc';
          showUserSuggestions(value.substring(2));
        }
        else if (value.startsWith('c/')) {
          searchTypeIndicator.textContent = 'c/';
          searchTypeIndicator.style.display = 'block';
          searchTypeIndicator.style.color = '#7c3aed';
          showCommunitySuggestions(value.substring(2));
        }
        else {
          searchTypeIndicator.style.display = 'none';
          hideSuggestions();
          if (value.trim()) {
            performRegularSearch(value);
          }
        }
      });
    }

    function showUserSuggestions(query) {
      const suggestions = document.getElementById('search-suggestions');
      
      if (!query.trim()) {
        hideSuggestions();
        return;
      }

      const matchingUsers = users.filter(user => 
        user.username.toLowerCase().includes(query.toLowerCase()) ||
        user.displayName.toLowerCase().includes(query.toLowerCase())
      ).slice(0, 5);

      if (matchingUsers.length === 0) {
        hideSuggestions();
        return;
      }

      suggestions.innerHTML = matchingUsers.map(user => `
        <div class="search-suggestion" onclick="selectUserSuggestion('${user.username}')">
          <div class="suggestion-type">Usurio</div>
          <div class="suggestion-name">${user.displayName} (@${user.username})</div>
        </div>
      `).join('');

      suggestions.style.display = 'block';
    }

    function showCommunitySuggestions(query) {
      const suggestions = document.getElementById('search-suggestions');
      
      if (!query.trim()) {
        hideSuggestions();
        return;
      }

      const matchingCommunities = communities.filter(community => 
        community.name.toLowerCase().includes(query.toLowerCase()) ||
        community.description.toLowerCase().includes(query.toLowerCase())
      ).slice(0, 5);

      if (matchingCommunities.length === 0) {
        hideSuggestions();
        return;
      }

      suggestions.innerHTML = matchingCommunities.map(community => `
        <div class="search-suggestion" onclick="selectCommunitySuggestion(${community.id})">
          <div class="suggestion-type">Comunidade</div>
          <div class="suggestion-name">${community.icon} ${community.name}</div>
        </div>
      `).join('');

      suggestions.style.display = 'block';
    }

    function hideSuggestions() {
      const suggestions = document.getElementById('search-suggestions');
      if (suggestions) suggestions.style.display = 'none';
    }

    function selectUserSuggestion(username) {
      hideSuggestions();
      document.getElementById('search-input').value = '';
      document.getElementById('search-type-indicator').style.display = 'none';
      showUserProfile(username);
    }

    function selectCommunitySuggestion(communityId) {
      hideSuggestions();
      document.getElementById('search-input').value = '';
      document.getElementById('search-type-indicator').style.display = 'none';
      openCommunity(communityId);
    }

    function performRegularSearch(query) {
      searchPosts(query);
    }

    // ==================== COMMUNITY ENHANCEMENTS ====================
    
    let currentEditingCommunity = null;

    function toggleCommunityMenu(communityId) {
      const dropdown = document.getElementById(`community-dropdown-${communityId}`);
      
      document.querySelectorAll('.community-dropdown').forEach(d => {
        if (d.id !== `community-dropdown-${communityId}`) {
          d.classList.remove('show');
        }
      });
      
      dropdown.classList.toggle('show');
    }

    function editCommunity(communityId) {
      const community = communities.find(c => c.id === communityId);
      if (!community) return;

      currentEditingCommunity = community;
      
      document.getElementById('edit-community-name').value = community.name;
      document.getElementById('edit-community-description').value = community.description;
      
      const preview = document.getElementById('edit-community-icon-preview');
      if (community.iconUrl) {
        preview.style.backgroundImage = `url('${community.iconUrl}')`;
        preview.style.backgroundSize = 'cover';
        preview.style.backgroundPosition = 'center';
        preview.textContent = '';
      } else {
        preview.style.backgroundImage = '';
        preview.textContent = community.icon;
      }
      
      document.getElementById('edit-community-modal').style.display = 'flex';
    }

    function closeEditCommunityModal() {
      document.getElementById('edit-community-modal').style.display = 'none';
      currentEditingCommunity = null;
    }

    function saveEditCommunity() {
      if (!currentEditingCommunity) return;

      const name = document.getElementById('edit-community-name').value.trim();
      const description = document.getElementById('edit-community-description').value.trim();
      const iconFile = document.getElementById('edit-community-icon').files[0];

      if (!name || !description) {
        showNotification(' Preencha todos os campos!', 'error');
        return;
      }

      currentEditingCommunity.name = name;
      currentEditingCommunity.description = description;

      if (iconFile) {
        currentEditingCommunity.iconUrl = URL.createObjectURL(iconFile);
      }

      saveDataToServer();
      displayCommunities(communities);
      closeEditCommunityModal();
      showNotification(' Comunidade atualizada!', 'success');
    }

    function manageCommunityRules(communityId) {
      const community = communities.find(c => c.id === communityId);
      if (!community) return;

      currentEditingCommunity = community;
      document.getElementById('rules-input').value = community.rules || '';
      document.getElementById('rules-modal').style.display = 'flex';
    }

    function closeRulesModal() {
      document.getElementById('rules-modal').style.display = 'none';
      currentEditingCommunity = null;
    }

    function saveRules() {
      if (!currentEditingCommunity) return;

      const rules = document.getElementById('rules-input').value.trim();
      currentEditingCommunity.rules = rules;

      saveDataToServer();
      displayCommunities(communities);
      closeRulesModal();
      showNotification(' Regras salvas!', 'success');
    }

    function shareCommunity(communityId) {
      const community = communities.find(c => c.id === communityId);
      if (!community) return;

      const shareText = `Confira a comunidade "${community.name}" no SALOMUSIC!`;
      
      if (navigator.share) {
        navigator.share({
          title: community.name,
          text: shareText,
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(shareText).then(() => {
          showNotification(' Link copiado para a rea de transferncia!', 'success');
        });
      }
    }

    function deleteCommunity(communityId) {
      if (!confirm('Tem certeza que deseja excluir esta comunidade? Esta ao no pode ser desfeita.')) {
        return;
      }

      const index = communities.findIndex(c => c.id === communityId);
      if (index !== -1) {
        communities.splice(index, 1);
        saveDataToServer();
        displayCommunities(communities);
        showNotification(' Comunidade excluda!', 'success');
      }
    }

    // ==================== COMMUNITIES FUNCTIONS ====================
    
  </script>
</body>
</html>