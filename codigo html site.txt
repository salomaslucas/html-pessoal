<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>SALOMUSIC</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1b1c1f 0%, #25262a 100%);
      color: #ffffff;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    .sidebar {
      background: linear-gradient(180deg, #1f1e1e 0%, #2b2b2b 100%);
      width: 220px;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      box-shadow: 2px 0 15px rgba(0, 0, 0, 0.3);
      border-right: 1px solid #444;
    }

    .sidebar h2 {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
      color: #ffffff;
      text-align: center;
      padding: 0.5rem;
      border-bottom: none;
      background: linear-gradient(135deg, #ff6b35, #f7931e, #ffd700, #00ff88, #00bfff, #7c3aed, #ff1a1a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 300% 300%;
      animation: gradientShift 3s ease-in-out infinite;
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
      font-weight: bold;
      letter-spacing: 1px;
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .sidebar .menu-label {
      font-size: 0.9rem;
      color: #888;
      text-align: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #444;
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: 500;
    }

    .sidebar a {
      color: #bbb;
      text-decoration: none;
      margin: 0.5rem 0;
      display: block;
      padding: 0.8rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .sidebar a:hover {
      background: linear-gradient(45deg, #2b2b2b, #3a3a3a);
      color: #7c3aed;
      transform: translateX(5px);
    }

    .sidebar a.active {
      background: linear-gradient(45deg, #960e0e, #ff1a1a);
      color: white;
      font-weight: bold;
    }

    .search-bar {
      margin: 1rem 0;
      padding: 0.8rem;
      width: 100%;
      background: linear-gradient(135deg, #2b2d31 0%, #3a3c41 100%);
      border: 2px solid #555;
      color: white;
      border-radius: 8px;
      font-size: 0.9rem;
      font-family: inherit;
    }

    .search-bar:focus {
      border-color: #ffffff;
      outline: none;
      box-shadow: 0 0 15px rgba(124, 58, 237, 0.3);
    }

    .user-info {
      margin-top: auto;
      padding: 1rem;
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 12px;
      border: 1px solid #555;
      text-align: center;
      display: none;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 0.5rem;
      font-size: 1.5rem;
      background-size: cover;
      background-position: center;
    }

    .logout-btn {
      background: linear-gradient(45deg, #666, #888);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 0.5rem;
      font-size: 0.8rem;
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .topbar {
      background: linear-gradient(90deg, #202225 0%, #36393f 100%);
      padding: 1rem 1.5rem;
      font-size: 1.6rem;
      color: #ffffff;
      font-weight: bold;
      border-bottom: 2px solid #444;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    .topbar-left {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      flex: 1;
    }

    .topbar-search {
      flex: 1;
      max-width: 500px;
      display: flex;
      justify-content: center;
    }

    .notification-bell {
      position: relative;
      cursor: pointer;
      font-size: 1.5rem;
      padding: 0.5rem;
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ff1a1a;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
    }

    .notification-dropdown {
      position: absolute;
      top: 100%;
      right: 20px;
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border: 1px solid #555;
      border-radius: 8px;
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      display: none;
    }

    .notification-dropdown.show {
      display: block;
    }

    .notification-item {
      padding: 1rem;
      border-bottom: 1px solid #555;
      cursor: pointer;
      transition: background 0.3s;
    }

    .notification-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .notification-item:last-child {
      border-bottom: none;
    }

    .notification-text {
      font-size: 0.9rem;
    }

    .notification-time {
      font-size: 0.8rem;
      color: #888;
      margin-top: 0.3rem;
    }

    .content {
      padding: 2rem;
      flex: 1;
      overflow-y: auto;
      background: linear-gradient(135deg, #25262a 0%, #2f3136 100%);
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .card {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      padding: 2rem;
      border-radius: 16px;
      margin-bottom: 2rem;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      border: 1px solid #555;
      position: relative;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #960e0e, #7c3aed, #960e0e);
    }

    .card h3 {
      margin-bottom: 1.5rem;
      color: #7c3aed;
      font-size: 1.4rem;
    }

    .auth-tabs {
      display: flex;
      margin-bottom: 2rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 0.5rem;
    }

    .auth-tab {
      flex: 1;
      padding: 1rem;
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .auth-tab.active {
      background: linear-gradient(45deg, #960e0e, #ff1a1a);
      color: white;
    }

    input[type="file"],
    input[type="text"],
    input[type="password"],
    textarea {
      margin: 1rem 0;
      padding: 0.8rem;
      width: 100%;
      background: linear-gradient(135deg, #2b2d31 0%, #3a3c41 100%);
      border: 2px solid #555;
      color: white;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
    }

    input:focus,
    textarea:focus {
      border-color: #7c3aed;
      outline: none;
      box-shadow: 0 0 15px rgba(124, 58, 237, 0.3);
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    button {
      background: linear-gradient(45deg, #960e0e, #ff1a1a);
      color: #ffffff;
      padding: 0.8rem 1.8rem;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      width: 100%;
      transition: all 0.3s ease;
    }

    button:hover {
      background: linear-gradient(45deg, #ff1a1a, #ff4d4d);
      transform: translateY(-2px);
    }

    .notice {
      margin-top: 1rem;
      padding: 0.5rem;
      border-radius: 4px;
      font-size: 0.95rem;
    }

    .notice.success {
      background: rgba(0, 255, 0, 0.1);
      color: #00ff88;
      border-left: 3px solid #00ff88;
    }

    .notice.error {
      background: rgba(255, 0, 0, 0.1);
      color: #ff6666;
      border-left: 3px solid #ff6666;
    }

    .feed-container {
      max-width: 600px;
      margin: 0 auto;
    }

    .post {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 16px;
      margin-bottom: 1.5rem;
      border: 1px solid #555;
      position: relative;
    }

    .post::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, #960e0e, #7c3aed, #960e0e);
    }

    .post-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid #555;
      display: flex;
      align-items: center;
      gap: 1rem;
      position: relative;
    }

    .post-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      cursor: pointer;
      background-size: cover;
      background-position: center;
    }

    .post-author {
      font-weight: bold;
      color: #7c3aed;
      cursor: pointer;
    }

    .post-time {
      color: #888;
      font-size: 0.9rem;
      margin-left: auto;
    }

    .post-menu {
      position: absolute;
      top: 1rem;
      right: 1rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: background 0.3s ease;
    }

    .post-menu:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .post-menu-dots {
      font-size: 1.4rem;
      color: #888;
      line-height: 1;
    }

    .post-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border: 1px solid #555;
      border-radius: 8px;
      min-width: 180px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      z-index: 100;
      display: none;
    }

    .post-dropdown.show {
      display: block;
    }

    .dropdown-item {
      padding: 0.8rem 1rem;
      cursor: pointer;
      transition: background 0.3s ease;
      border: none;
      background: none;
      color: white;
      width: 100%;
      text-align: left;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-transform: none;
      letter-spacing: normal;
      font-weight: normal;
    }

    .dropdown-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: none;
    }

    .dropdown-item.edit {
      color: #00ffcc;
    }

    .dropdown-item.delete {
      color: #ff6666;
    }

    .dropdown-item.download {
      color: #ffaa00;
    }

    .dropdown-item.share {
      color: #00ff88;
    }

    .post-content {
      padding: 1.5rem;
    }

    .post-text {
      margin-bottom: 1rem;
      line-height: 1.5;
    }

    .post-media {
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 1rem;
      cursor: pointer;
    }

    .post-image,
    .post-video {
      width: 100%;
      height: auto;
      max-height: 400px;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .post-image:hover {
      transform: scale(1.02);
    }

    .post-actions {
      padding: 1rem 1.5rem;
      border-top: 1px solid #555;
      display: flex;
      gap: 2rem;
    }

    .action-btn {
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      border-radius: 6px;
      transition: color 0.3s ease;
      width: auto;
      text-transform: none;
      letter-spacing: normal;
      font-weight: normal;
    }

    .action-btn:hover {
      color: #7c3aed;
      transform: none;
      background: rgba(124, 58, 237, 0.1);
    }

    .action-btn.liked {
      color: #34a853;
    }

    .action-btn.disliked {
      color: #ea4335;
    }

    .action-btn.favorited {
      color: #fbbf24;
    }

    .action-btn.liked:hover {
      color: #34a853 !important;
      background: rgba(52, 168, 83, 0.1) !important;
    }

    .action-btn.disliked:hover {
      color: #ea4335 !important;
      background: rgba(234, 67, 53, 0.1) !important;
    }

    .action-btn.favorited:hover {
      color: #fbbf24 !important;
      background: rgba(251, 191, 36, 0.1) !important;
    }

    .follow-btn {
      background: linear-gradient(45deg, #6366f1, #7c3aed) !important;
      padding: 0.3rem 0.8rem !important;
      font-size: 0.8rem !important;
      width: auto !important;
      margin-left: 1rem;
    }

    .unfollow-btn {
      background: linear-gradient(45deg, #960e0e, #ff1a1a) !important;
      padding: 0.3rem 0.8rem !important;
      font-size: 0.8rem !important;
      width: auto !important;
      margin-left: 1rem;
    }

    .chat-btn {
      background: linear-gradient(45deg, #6e48aa, #9d50bb) !important;
      padding: 0.3rem 0.8rem !important;
      font-size: 0.8rem !important;
      width: auto !important;
      margin-left: 1rem;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 90%;
      max-height: 90%;
    }

    .modal img,
    .modal video {
      max-width: 100%;
      max-height: 100%;
      border-radius: 12px;
    }

    .close-modal {
      position: absolute;
      top: 20px;
      right: 30px;
      color: white;
      font-size: 40px;
      cursor: pointer;
    }

    .preview-area img,
    .preview-area video {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 8px;
      margin-top: 1rem;
    }

    .edit-modal, .share-modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
    }

    .edit-modal-content, .share-modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      padding: 2rem;
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      border: 1px solid #555;
    }

    .share-modal-content {
      max-width: 400px;
      text-align: center;
    }

    .edit-modal h3, .share-modal h3 {
      color: #00ffcc;
      margin-bottom: 1rem;
    }

    .edit-modal textarea {
      width: 100%;
      min-height: 120px;
      margin-bottom: 1rem;
    }

    .modal-buttons {
      display: flex;
      gap: 1rem;
    }

    .modal-buttons button {
      width: 50%;
      padding: 0.8rem 1.5rem;
    }

    .cancel-btn {
      background: linear-gradient(45deg, #666, #888) !important;
    }

    .share-link {
      background: #2b2d31;
      border: 1px solid #555;
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      color: #00ffcc;
      word-break: break-all;
      font-family: monospace;
    }

    .copy-btn {
      background: linear-gradient(45deg, #6366f1, #7c3aed) !important;
      margin-bottom: 1rem;
    }

    .user-profile-header {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      background-size: cover;
      background-position: center;
    }

    .profile-info h2 {
      color: #00ffcc;
      margin-bottom: 0.5rem;
    }

    .profile-stats {
      display: flex;
      gap: 1.5rem;
      margin-top: 1rem;
    }

    .stat-item {
      text-align: center;
    }

    .stat-number {
      font-size: 1.2rem;
      font-weight: bold;
      color: #00ffcc;
    }

    .stat-label {
      font-size: 0.8rem;
      color: #888;
    }

    .user-posts {
      margin-top: 2rem;
    }

    .user-posts h3 {
      border-bottom: 1px solid #555;
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
    }

    .comments-section {
      margin-top: 1rem;
      border-top: 1px solid #555;
      padding-top: 1rem;
    }

    .comment-form {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .comment-input {
      flex: 1;
      padding: 0.5rem;
      border-radius: 4px;
      border: 1px solid #555;
      background: #2b2d31;
      color: white;
    }

    .comment-btn {
      padding: 0.5rem 1rem !important;
      font-size: 0.9rem !important;
      width: auto !important;
      text-transform: none !important;
      letter-spacing: normal !important;
    }

    .comments-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .comment {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.8rem;
      padding-bottom: 0.8rem;
      border-bottom: 1px solid #444;
    }

    .comment-avatar {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      background-size: cover;
      background-position: center;
    }

    .comment-content {
      flex: 1;
    }

    .comment-author {
      font-weight: bold;
      font-size: 0.9rem;
      color: #00ffcc;
    }

    .comment-text {
      font-size: 0.9rem;
      margin-top: 0.2rem;
    }

    .comment-time {
      font-size: 0.7rem;
      color: #888;
      margin-top: 0.2rem;
    }

    .highlight-post {
      animation: highlight 2s;
    }

    @keyframes highlight {
      0% { background-color: rgba(0, 255, 204, 0.1); }
      100% { background-color: transparent; }
    }

    .search-results {
      margin-bottom: 2rem;
    }

    .search-results h3 {
      color: #00ffcc;
      margin-bottom: 1rem;
    }

    .no-results {
      text-align: center;
      color: #888;
      padding: 2rem;
      font-style: italic;
    }

    .clear-search {
      background: linear-gradient(45deg, #666, #888) !important;
      padding: 0.5rem 1rem !important;
      font-size: 0.8rem !important;
      width: auto !important;
      margin-left: 0.5rem;
      text-transform: none !important;
      letter-spacing: normal !important;
    }

    .search-users-results {
      margin-top: 1rem;
    }

    .user-search-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      background: rgba(255, 255, 255, 0.05);
      cursor: pointer;
      transition: background 0.3s;
    }

    .user-search-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .user-search-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      background-size: cover;
      background-position: center;
    }

    .user-search-info {
      flex: 1;
    }

    .user-search-name {
      font-weight: bold;
      color: #00ffcc;
    }

    .user-search-username {
      font-size: 0.8rem;
      color: #888;
    }

    /* Adicione no final do seu CSS */
    #chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    #chat-messages::-webkit-scrollbar-track {
      background: #2b2d31;
    }

    #chat-messages::-webkit-scrollbar-thumb {
      background: #555;
      border-radius: 3px;
    }

    #conversations-list::-webkit-scrollbar {
      width: 6px;
    }

    #conversations-list::-webkit-scrollbar-track {
      background: #2b2d31;
    }

    #conversations-list::-webkit-scrollbar-thumb {
      background: #555;
      border-radius: 3px;
    }

    .user-search-item {
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 5px;
      background: rgba(255,255,255,0.05);
      cursor: pointer;
      transition: background 0.3s;
    }

    .user-search-item:hover {
      background: rgba(255,255,255,0.1);
    }

    .follow-request-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      margin-bottom: 10px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
    }

    .follow-request-buttons {
      display: flex;
      gap: 10px;
    }

    .settings-section {
      margin-bottom: 20px;
    }

    .settings-section h4 {
      margin-bottom: 10px;
      color: #00ffcc;
      border-bottom: 1px solid #555;
      padding-bottom: 5px;
    }

    .settings-option {
      margin-bottom: 15px;
    }

    .settings-option label {
      display: block;
      margin-bottom: 5px;
    }

    .settings-option input {
      width: 100%;
    }

    .settings-save-btn {
      margin-top: 20px;
    }

    .requests-section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #555;
    }

    .requests-section h3 {
      color: #00ffcc;
      margin-bottom: 15px;
    }

    .request-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      margin-bottom: 10px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
    }

    .request-user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .request-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      background-size: cover;
      background-position: center;
    }

    .request-buttons {
      display: flex;
      gap: 10px;
    }

    .request-btn {
      padding: 5px 10px !important;
      font-size: 0.8rem !important;
      width: auto !important;
    }

    .accept-btn {
      background: linear-gradient(45deg, #6366f1, #7c3aed) !important;
    }

    .reject-btn {
      background: linear-gradient(45deg, #960e0e, #ff1a1a) !important;
    }

    .search-user-profile {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .search-user-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      background-size: cover;
      background-position: center;
    }

    .search-user-info {
      flex: 1;
    }

    .search-user-name {
      font-size: 1.5rem;
      color: #00ffcc;
      margin-bottom: 5px;
    }

    .search-user-username {
      color: #888;
      margin-bottom: 10px;
    }

    .search-user-actions {
      display: flex;
      gap: 10px;
    }

    .send-message-btn {
      width: auto !important;
      padding: 0.6rem 1.2rem !important;
      font-size: 0.9rem !important;
      text-transform: none !important;
      letter-spacing: normal !important;
      font-weight: normal !important;
    }

    .private-post-option {
      margin: 1rem 0;
      padding: 0.8rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      border: 1px solid #555;
    }

    .private-post-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      color: #bbb;
      font-size: 0.9rem;
    }

    .private-post-label input[type="checkbox"] {
      width: auto;
      margin: 0;
    }

    .private-post-label:hover {
      color: #7c3aed;
    }

    .post-privacy-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      font-size: 0.8rem;
      color: #ffaa00;
      background: rgba(255, 170, 0, 0.1);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      margin-bottom: 0.5rem;
    }

    .request-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      margin-bottom: 1rem;
      border: 1px solid #555;
    }

    .request-user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .request-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      background-size: cover;
      background-position: center;
    }

    .request-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .request-btn {
      padding: 0.4rem 0.8rem !important;
      font-size: 0.8rem !important;
      width: auto !important;
      text-transform: none !important;
      letter-spacing: normal !important;
      font-weight: normal !important;
    }

    .no-results {
      text-align: center;
      padding: 2rem;
      color: #888;
      font-style: italic;
    }

    /* Chat Styles */
    #chat-container {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 16px;
      border: 1px solid #555;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    #chat-header {
      background: linear-gradient(90deg, #202225 0%, #36393f 100%);
      padding: 1rem 1.5rem;
      border-radius: 16px 16px 0 0;
      border-bottom: 2px solid #444;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #chat-header h4 {
      color: #7c3aed;
      font-size: 1.2rem;
      margin: 0;
    }

    .chat-close-btn {
      background: none !important;
      border: none !important;
      color: #888 !important;
      cursor: pointer;
      font-size: 1.2rem !important;
      padding: 0.3rem !important;
      width: auto !important;
      height: auto !important;
      border-radius: 4px !important;
      transition: all 0.3s ease;
      text-transform: none !important;
      letter-spacing: normal !important;
      font-weight: normal !important;
    }

    .chat-close-btn:hover {
      background: rgba(255, 255, 255, 0.1) !important;
      color: #ff6666 !important;
      transform: none !important;
    }

    #chat-messages {
      background: linear-gradient(135deg, #25262a 0%, #2f3136 100%);
      border: 1px solid #555;
      border-radius: 8px;
      margin: 1rem;
    }

    #conversations-list {
      background: linear-gradient(135deg, #25262a 0%, #2f3136 100%);
      border: 1px solid #555;
      border-radius: 8px;
      padding: 1rem;
      max-height: 300px !important;
    }

    .conversation-item {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border: 1px solid #555;
      border-radius: 8px;
      padding: 0.8rem;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .conversation-item:hover {
      background: linear-gradient(45deg, #2b2b2b, #3a3a3a);
      transform: translateX(5px);
    }

    /* Password Input with Eye Icon */
    .password-input-container {
      position: relative;
      display: flex;
      align-items: center;
    }

    .password-input-container input {
      padding-right: 3rem !important;
    }

    .password-toggle {
      position: absolute;
      right: 0.8rem;
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      font-size: 1.1rem;
      padding: 0.2rem;
      width: auto !important;
      height: auto !important;
      text-transform: none !important;
      letter-spacing: normal !important;
      font-weight: normal !important;
      transition: color 0.3s ease;
    }

    .password-toggle:hover {
      color: #7c3aed;
      background: none !important;
      transform: none !important;
    }

    /* Forgot Password Link */
    .forgot-password-link {
      display: block;
      text-align: center;
      color: #7c3aed;
      text-decoration: none;
      font-size: 0.9rem;
      margin-top: 1rem;
      transition: color 0.3s ease;
    }

    .forgot-password-link:hover {
      color: #ff1a1a;
      text-decoration: underline;
    }

    /* Reset Password Form */
    #reset-password-form {
      display: none;
    }

    .back-to-login {
      background: linear-gradient(45deg, #666, #888) !important;
      margin-top: 1rem;
    }

    .back-to-login:hover {
      background: linear-gradient(45deg, #888, #aaa) !important;
    }

    /* Profile Tabs */
    .profile-tabs {
      display: flex;
      margin: 2rem 0 1rem 0;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 0.5rem;
      gap: 0.5rem;
    }

    .profile-tab {
      flex: 1;
      padding: 0.8rem 1rem !important;
      background: none !important;
      border: none !important;
      color: #888 !important;
      cursor: pointer;
      border-radius: 8px !important;
      transition: all 0.3s ease;
      font-size: 0.9rem !important;
      text-transform: none !important;
      letter-spacing: normal !important;
      font-weight: normal !important;
      width: auto !important;
    }

    .profile-tab:hover {
      background: rgba(255, 255, 255, 0.1) !important;
      color: #7c3aed !important;
      transform: none !important;
    }

    .profile-tab.active {
      background: linear-gradient(45deg, #960e0e, #ff1a1a) !important;
      color: white !important;
    }

    .profile-content {
      margin-top: 1rem;
    }

    .profile-tab-content {
      display: none;
    }

    .profile-tab-content.active {
      display: block;
    }

    /* Download and Share buttons styling */
    .action-btn[title="Download do post"],
    .action-btn[title="Compartilhar post"] {
      color: #00ffcc;
    }

    .action-btn[title="Download do post"]:hover {
      color: #00ffcc !important;
      background: rgba(0, 255, 204, 0.1) !important;
    }

    .action-btn[title="Compartilhar post"]:hover {
      color: #ffaa00 !important;
      background: rgba(255, 170, 0, 0.1) !important;
    }

    /* Ban System Styles */
    .ban-btn {
      background: linear-gradient(45deg, #ff4444, #cc0000) !important;
      color: white !important;
      padding: 0.6rem 1.2rem !important;
      font-size: 0.9rem !important;
      text-transform: none !important;
      letter-spacing: normal !important;
      font-weight: normal !important;
      width: auto !important;
      margin-left: 0.5rem;
    }

    .ban-btn.unban {
      background: linear-gradient(45deg, #00aa00, #00ff00) !important;
    }

    .ban-btn:hover {
      background: linear-gradient(45deg, #ff6666, #ff0000) !important;
      transform: translateY(-2px) !important;
    }

    .ban-btn.unban:hover {
      background: linear-gradient(45deg, #00cc00, #00ff44) !important;
    }

    /* Ban Modal */
    .ban-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .ban-modal-content {
      background: linear-gradient(135deg, #36393f 0%, #40444b 100%);
      border-radius: 16px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      border: 1px solid #555;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    .ban-modal-content h3 {
      color: #ff6666;
      margin-bottom: 1rem;
      text-align: center;
    }

    .ban-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .ban-option {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.8rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .ban-option:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: #7c3aed;
    }

    .ban-option input[type="radio"] {
      width: auto !important;
      margin: 0 !important;
    }

    .ban-option input[type="radio"]:checked + span {
      color: #ff6666;
      font-weight: bold;
    }

    #custom-ban-section {
      margin: 1rem 0;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
    }

    #custom-ban-section label {
      display: block;
      margin-bottom: 0.5rem;
      color: #bbb;
    }

    .ban-reason-section {
      margin: 1.5rem 0;
    }

    .ban-reason-section label {
      display: block;
      margin-bottom: 0.5rem;
      color: #bbb;
    }

    .ban-modal-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 2rem;
    }

    .ban-confirm-btn {
      background: linear-gradient(45deg, #ff4444, #cc0000) !important;
      color: white !important;
      padding: 0.8rem 1.5rem !important;
      width: auto !important;
    }

    .ban-confirm-btn:hover {
      background: linear-gradient(45deg, #ff6666, #ff0000) !important;
    }

    /* Banned User Indicator */
    .banned-indicator {
      background: rgba(255, 68, 68, 0.2);
      color: #ff6666;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      text-align: center;
      border: 1px solid #ff6666;
    }

    /* Hide banned user content */
    .banned-content {
      opacity: 0.3;
      pointer-events: none;
      filter: blur(2px);
    }

    /* Search user results */
    .search-user-profile {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    .search-user-profile:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .search-user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(45deg, #960e0e, #7c3aed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      cursor: pointer;
      background-size: cover;
      background-position: center;
      transition: transform 0.3s ease;
    }

    .search-user-avatar:hover {
      transform: scale(1.1);
    }

    .search-user-info {
      flex: 1;
    }

    .search-user-name {
      font-weight: bold;
      color: #7c3aed;
      cursor: pointer;
      transition: color 0.3s ease;
      font-size: 1.1rem;
    }

    .search-user-name:hover {
      color: #ff1a1a;
      text-decoration: underline;
    }

    .search-user-username {
      color: #888;
      font-size: 0.9rem;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .search-user-username:hover {
      color: #7c3aed;
    }

    .search-user-actions {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
    }

    .search-user-actions button {
      padding: 0.4rem 0.8rem !important;
      font-size: 0.8rem !important;
      width: auto !important;
    }

    /* Empty content message */
    .empty-content {
      text-align: center;
      padding: 3rem 2rem;
      color: #888;
      font-size: 1.2rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      border: 2px dashed #555;
      margin: 1rem 0;
    }

    /* Profile tabs */
    .profile-tabs {
      display: flex;
      margin: 2rem 0 1rem 0;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 0.5rem;
      gap: 0.5rem;
    }

    .profile-tab {
      flex: 1;
      padding: 1rem;
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      text-transform: none;
      letter-spacing: normal;
      font-weight: normal;
      width: auto;
    }

    .profile-tab.active {
      background: linear-gradient(45deg, #960e0e, #ff1a1a);
      color: white;
      font-weight: bold;
    }

    .profile-tab:hover:not(.active) {
      background: rgba(255, 255, 255, 0.1);
      color: #7c3aed;
      transform: none;
    }

    .profile-tab-content {
      min-height: 200px;
    }

    .profile-tab-content.active {
      display: block !important;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>SALOMUSIC SERVER! üî•</h2>
    <div class="menu-label">Menu</div>
    <a id="feed-link" class="nav-link active">üè† Feed</a>
    <a id="perfil-link" class="nav-link" style="display: none;">üë§ Perfil</a>
    <a id="chat-link" class="nav-link" style="display: none;">üí¨ Conversas</a>
    <a id="requests-link" class="nav-link" style="display: none;">üìã Solicita√ß√µes</a>
    <a id="config-link" class="nav-link" style="display: none;">‚öôÔ∏è Configura√ß√µes</a>
    <a id="sobre-link" class="nav-link">‚ÑπÔ∏è Sobre</a>
    
    <div class="user-info" id="user-info">
      <div class="user-avatar" id="user-avatar">üë§</div>
      <div id="user-display-name">Usu√°rio</div>
      <button class="logout-btn" id="logout-btn">Sair</button>
    </div>
  </div>

  <div class="main">
    <div class="topbar">
      <div class="topbar-left">
        <div class="topbar-search">
          <input type="text" class="search-bar" id="search-input" placeholder="üîç Pesquisar posts ou usu√°rios..." style="display: none;">
        </div>
      </div>
      <div class="notification-bell" id="notification-bell">
        üîî
        <div class="notification-badge" id="notification-badge" style="display: none;">0</div>
        <div class="notification-dropdown" id="notification-dropdown"></div>
      </div>
    </div>
    
    <div class="content">
      <!-- Feed Page -->
      <div id="feed" class="page active">
        <!-- Auth Section -->
        <div id="auth-section" style="max-width: 400px; margin: 0 auto;">
          <div class="card">
            <div class="auth-tabs">
              <button class="auth-tab active" id="login-tab">Login</button>
              <button class="auth-tab" id="register-tab">Cadastrar</button>
            </div>

            <!-- Login Form -->
            <div id="login-form">
              <h3>üîê Entrar na Conta</h3>
              <input type="text" id="login-username" placeholder="üë§ Nome de Usu√°rio">
              <div class="password-input-container">
                <input type="password" id="login-password" placeholder="üîí Senha">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('login-password', this)">üëÅÔ∏è</button>
              </div>
              <button id="login-btn">Entrar</button>
              <a href="#" class="forgot-password-link" onclick="showResetPasswordForm()">Esqueci minha senha</a>
              <p id="login-status" class="notice"></p>
            </div>

            <!-- Reset Password Form -->
            <div id="reset-password-form">
              <h3>üîë Redefinir Senha</h3>
              <input type="text" id="reset-username" placeholder="üë§ Nome de Usu√°rio">
              <div class="password-input-container">
                <input type="password" id="reset-new-password" placeholder="üîí Nova Senha (5-15 caracteres)" minlength="5" maxlength="15">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('reset-new-password', this)">üëÅÔ∏è</button>
              </div>
              <div class="password-input-container">
                <input type="password" id="reset-confirm-password" placeholder="üîí Confirmar Nova Senha" minlength="5" maxlength="15">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('reset-confirm-password', this)">üëÅÔ∏è</button>
              </div>
              <button id="reset-password-btn">Redefinir Senha</button>
              <button type="button" class="back-to-login" onclick="showLoginForm()">Voltar ao Login</button>
              <p id="reset-status" class="notice"></p>
            </div>

            <!-- Register Form -->
            <div id="register-form" style="display: none;">
              <h3>üìù Criar Conta Nova</h3>
              <input type="text" id="reg-username" placeholder="üë§ Nome de Usu√°rio">
              <input type="text" id="reg-displayname" placeholder="‚ú® Nome para Exibi√ß√£o">
              <div class="password-input-container">
                <input type="password" id="reg-password" placeholder="üîí Senha (5-15 caracteres)" minlength="5" maxlength="15">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('reg-password', this)">üëÅÔ∏è</button>
              </div>
              <div class="password-input-container">
                <input type="password" id="reg-confirm-password" placeholder="üîí Confirmar Senha" minlength="5" maxlength="15">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('reg-confirm-password', this)">üëÅÔ∏è</button>
              </div>
              <input type="file" id="reg-avatar" accept="image/*" style="display: none;">
              <button type="button" onclick="document.getElementById('reg-avatar').click()">Escolher Avatar</button>
              <div id="avatar-preview" style="width: 100px; height: 100px; border-radius: 50%; background: #333; margin: 10px auto;"></div>
              <button id="register-btn">Criar Conta</button>
              <p id="register-status" class="notice"></p>
            </div>
          </div>
        </div>

        <!-- Feed Section -->
        <div id="feed-section" class="feed-container" style="display: none;">
          <!-- Post Composer -->
          <div class="card" id="post-composer">
            <h3>üì§ Compartilhar Conte√∫do</h3>
            <textarea id="post-text" placeholder="No que voc√™ est√° pensando? Compartilhe com a tropa! üî•"></textarea>
            <input type="file" id="post-media" accept=".jpeg,.jpg,.png,.mp4,.mov">
            <div class="file-size-info" style="font-size: 0.8rem; color: #888; margin: 0.5rem 0; text-align: center;">
              üìÅ Limite m√°ximo: 100 MB por arquivo
            </div>
            <div id="media-preview" class="preview-area"></div>
            <div class="private-post-option">
              <label class="private-post-label">
                <input type="checkbox" id="private-post-checkbox">
                üîí Post privado (apenas seguidores)
              </label>
            </div>
            <button id="create-post-btn">Postar</button>
            <p id="post-status" class="notice"></p>
          </div>

          <!-- Search Results -->
          <div id="search-results" class="search-results" style="display: none;">
            <div class="card">
              <h3 id="search-title">üîç Resultados da Pesquisa</h3>
              <div id="search-posts-container"></div>
              <div id="search-users-container" class="search-users-results"></div>
            </div>
          </div>

          <!-- Posts Feed -->
          <div id="posts-container"></div>
        </div>
      </div>

      <!-- Profile Page -->
      <div id="perfil" class="page">
        <div class="card">
          <h3>üë§ Meu Perfil</h3>
          <div id="profile-content">
            <p>Suas informa√ß√µes de perfil aparecer√£o aqui ap√≥s o login.</p>
          </div>
        </div>
      </div>

      <!-- User Profile Page -->
      <div id="user-profile" class="page">
        <div class="card">
          <div id="user-profile-content"></div>
        </div>
      </div>

      <!-- Chat Page -->
      <div id="chat" class="page">
        <div class="card">
          <h3>üí¨ Conversas</h3>
          <div id="conversations-list">
            <!-- Lista de conversas ser√° gerada aqui -->
          </div>
          <div id="chat-container" style="display: none; margin-top: 20px;">
            <div id="chat-header">
              <h4 id="chat-with-user"></h4>
              <button class="chat-close-btn" onclick="closeChat()">‚úñ</button>
            </div>
            <div id="chat-messages" style="height: 300px; overflow-y: auto; padding: 10px;"></div>
            <div style="display: flex; gap: 10px; padding: 1rem;">
              <input type="text" id="chat-message" placeholder="Digite sua mensagem..." style="flex: 1;">
              <button onclick="sendMessage()" class="send-message-btn">Enviar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Requests Page -->
      <div id="requests" class="page">
        <div class="card">
          <h3>üìã Solicita√ß√µes de Seguidores</h3>
          <div id="follow-requests-list">
            <p>Nenhuma solicita√ß√£o pendente.</p>
          </div>
        </div>
      </div>

      <!-- Config Page -->
      <div id="config" class="page">
        <div class="card">
          <h3>‚öôÔ∏è Configura√ß√µes</h3>
          <div id="config-content">
            <div class="settings-section">
              <h4>Perfil</h4>
              <div class="settings-option">
                <label for="config-displayname">Nome de Exibi√ß√£o</label>
                <input type="text" id="config-displayname">
              </div>
              <div class="settings-option">
                <label for="config-avatar">Avatar</label>
                <input type="file" id="config-avatar" accept="image/*">
                <div id="config-avatar-preview" style="width: 80px; height: 80px; border-radius: 50%; background: #333; margin: 10px 0; background-size: cover; background-position: center;"></div>
              </div>
              <button id="save-profile-btn" class="settings-save-btn">Salvar Altera√ß√µes</button>
            </div>

            <div class="settings-section">
              <h4>Seguran√ßa</h4>
              <div class="settings-option">
                <label for="config-current-password">Senha Atual</label>
                <div class="password-input-container">
                  <input type="password" id="config-current-password" placeholder="Para alterar sua senha">
                  <button type="button" class="password-toggle" onclick="togglePasswordVisibility('config-current-password', this)">üëÅÔ∏è</button>
                </div>
              </div>
              <div class="settings-option">
                <label for="config-new-password">Nova Senha (5-15 caracteres)</label>
                <div class="password-input-container">
                  <input type="password" id="config-new-password" minlength="5" maxlength="15">
                  <button type="button" class="password-toggle" onclick="togglePasswordVisibility('config-new-password', this)">üëÅÔ∏è</button>
                </div>
              </div>
              <div class="settings-option">
                <label for="config-confirm-password">Confirmar Nova Senha</label>
                <div class="password-input-container">
                  <input type="password" id="config-confirm-password" minlength="5" maxlength="15">
                  <button type="button" class="password-toggle" onclick="togglePasswordVisibility('config-confirm-password', this)">üëÅÔ∏è</button>
                </div>
              </div>
              <button id="save-password-btn" class="settings-save-btn">Alterar Senha</button>
            </div>
          </div>
        </div>
      </div>

      <!-- About Page -->
      <div id="sobre" class="page">
        <div class="card">
          <h3>üî• Sobre o Servidor</h3>
          <p><strong>üìñ O que √© este servidor?</strong></p>
          <p>O SALOMUSIC √© uma rede social exclusiva, criada para oferecer uma experi√™ncia √∫nica de compartilhamento de conte√∫do e intera√ß√£o entre membros. e foi criada pelo SaloLay!</p>
          <br>
          <p><strong>üéØ Nossa Miss√£o</strong></p>
          <p>Criar uma comunidade vibrante onde os membros podem compartilhar momentos, ideias e conte√∫do visual de forma segura e divertida.</p>
          <br>
          <p><strong>‚ö° Recursos Principais</strong></p>
          <p>üî• Feed em tempo real estilo Twitter/Reddit<br>
          üì∏ Upload e visualiza√ß√£o de imagens e v√≠deos<br>
          üë• Sistema completo de usu√°rios e perfis<br>
          üîí Autentica√ß√£o segura e prote√ß√£o de dados<br>
          üì± Interface responsiva e moderna<br>
          üîç Sistema de busca por posts<br>
          üëçüëé Sistema de likes e dislikes</p>
          <p>Um beijo para Laysla, a ajudante emocional</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Media Modal -->
  <div id="media-modal" class="modal">
    <span class="close-modal">&times;</span>
    <div class="modal-content" id="modal-content"></div>
  </div>

  <!-- Edit Modal -->
  <div id="edit-modal" class="edit-modal">
    <div class="edit-modal-content">
      <h3>‚úèÔ∏è Editar Post</h3>
      <textarea id="edit-text" placeholder="Edite seu post..."></textarea>
      <div class="modal-buttons">
        <button id="save-edit-btn">Salvar</button>
        <button id="cancel-edit-btn" class="cancel-btn">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  <div id="share-modal" class="share-modal">
    <div class="share-modal-content">
      <h3>üîó Compartilhar Post</h3>
      <p>Copie o link abaixo para compartilhar este post:</p>
      <div class="share-link" id="share-link"></div>
      <button id="copy-link-btn" class="copy-btn">Copiar Link</button>
      <button id="close-share-btn" class="cancel-btn">Fechar</button>
    </div>
  </div>

  <!-- Ban Modal -->
  <div id="ban-modal" class="ban-modal" style="display: none;">
    <div class="ban-modal-content">
      <h3>üîí Banir Usu√°rio</h3>
      <p>Selecione o tempo de banimento para <span id="ban-username"></span>:</p>
      
      <div class="ban-options">
        <label class="ban-option">
          <input type="radio" name="ban-duration" value="1day">
          <span>1 Dia</span>
        </label>
        <label class="ban-option">
          <input type="radio" name="ban-duration" value="1week">
          <span>1 Semana</span>
        </label>
        <label class="ban-option">
          <input type="radio" name="ban-duration" value="forever">
          <span>Para Sempre</span>
        </label>
        <label class="ban-option">
          <input type="radio" name="ban-duration" value="custom">
          <span>Personalizado</span>
        </label>
      </div>
      
      <div id="custom-ban-section" style="display: none;">
        <label for="custom-ban-days">N√∫mero de dias:</label>
        <input type="number" id="custom-ban-days" min="1" max="365" placeholder="Ex: 30">
      </div>
      
      <div class="ban-reason-section">
        <label for="ban-reason">Motivo do banimento (opcional):</label>
        <textarea id="ban-reason" placeholder="Descreva o motivo do banimento..."></textarea>
      </div>
      
      <div class="ban-modal-buttons">
        <button id="confirm-ban-btn" class="ban-confirm-btn">Confirmar Banimento</button>
        <button id="cancel-ban-btn" class="cancel-btn">Cancelar</button>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentUser = null;
    let posts = [];
    let users = [
      { 
        username: 'admin',
        password: '1234', 
        displayName: 'Administrador',
        avatar: '',
        followers: [],
        following: [],
        followRequests: [],
        isAdmin: true,
        banned: false,
        banExpiry: null
      }
    ];
    let conversations = [];
    let currentChat = null;
    let comments = [];
    let notifications = [];
    let viewingUserProfile = null;
    let editingPostId = null;
    let searchActive = false;
    let searchQuery = '';

    // Sample posts
    const samplePosts = [
      {
        id: 1,
        author: 'TropaLeader',
        displayName: 'L√≠der',
        text: 'Bem-vindos ao nosso novo feed! üî• Agora podemos compartilhar conte√∫do como nas melhores redes sociais!',
        time: '96h',
        likes: 0,
        dislikes: 0,
        liked: false,
        disliked: false,
        favorites: 0,
        favorited: false,
        comments: 0
      },
      {
        id: 2,
        author: 'PhotoPro',
        displayName: 'Pro das Fotos',
        text: 'Nova funcionalidade de imagens est√° incr√≠vel! üì∏',
        time: '48h',
        likes: 0,
        dislikes: 0,
        liked: false,
        disliked: false,
        favorites: 0,
        favorited: false,
        comments: 0,
        media: {
          type: 'image',
          url: 'https://picsum.photos/600/400?random=1'
        }
      }
    ];

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      loadDataFromServer();
      setupEventListeners();
      checkLoginStatus();
    });

    function setupEventListeners() {
      // Navigation
      document.getElementById('feed-link').onclick = () => {
        viewingUserProfile = null;
        showPage('feed');
      };
      document.getElementById('perfil-link').onclick = () => {
        viewingUserProfile = null;
        showPage('perfil');
      };
      document.getElementById('chat-link').onclick = showChat;
      document.getElementById('requests-link').onclick = () => {
        viewingUserProfile = null;
        showPage('requests');
        loadFollowRequests();
      };
      document.getElementById('config-link').onclick = () => {
        viewingUserProfile = null;
        showPage('config');
      };
      document.getElementById('sobre-link').onclick = () => {
        viewingUserProfile = null;
        showPage('sobre');
      };

      // Search
      document.getElementById('search-input').addEventListener('input', handleSearch);
      document.getElementById('search-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          handleSearch();
        }
      });

      // Auth
      document.getElementById('login-tab').onclick = () => switchAuthTab('login');
      document.getElementById('register-tab').onclick = () => switchAuthTab('register');
      document.getElementById('login-btn').onclick = login;
      document.getElementById('register-btn').onclick = register;
      document.getElementById('logout-btn').onclick = logout;
      document.getElementById('reset-password-btn').onclick = resetPassword;

      // Posts
      document.getElementById('post-media').onchange = previewMedia;
      document.getElementById('create-post-btn').onclick = createPost;

      // Modals
      document.getElementById('media-modal').onclick = (e) => {
        if (e.target === document.getElementById('media-modal')) closeModal();
      };
      document.querySelector('.close-modal').onclick = closeModal;
      document.getElementById('save-edit-btn').onclick = saveEdit;
      document.getElementById('cancel-edit-btn').onclick = closeEditModal;
      document.getElementById('copy-link-btn').onclick = copyShareLink;
      document.getElementById('close-share-btn').onclick = closeShareModal;

      // Ban modal
      document.getElementById('confirm-ban-btn').onclick = confirmBan;
      document.getElementById('cancel-ban-btn').onclick = closeBanModal;
      
      // Custom ban duration toggle
      document.querySelectorAll('input[name="ban-duration"]').forEach(radio => {
        radio.addEventListener('change', function() {
          const customSection = document.getElementById('custom-ban-section');
          if (this.value === 'custom') {
            customSection.style.display = 'block';
          } else {
            customSection.style.display = 'none';
          }
        });
      });

      // Notifications
      document.getElementById('notification-bell').onclick = toggleNotifications;

      // Settings
      document.getElementById('config-avatar').onchange = previewConfigAvatar;
      document.getElementById('save-profile-btn').onclick = saveProfileSettings;
      document.getElementById('save-password-btn').onclick = changePassword;

      // Close dropdowns when clicking outside
      document.onclick = (e) => {
        if (!e.target.closest('.post-menu') && !e.target.closest('.notification-bell')) {
          document.querySelectorAll('.post-dropdown.show').forEach(dropdown => {
            dropdown.classList.remove('show');
          });
          document.getElementById('notification-dropdown').classList.remove('show');
        }
      };
    }

    function handleSearch() {
      const query = document.getElementById('search-input').value.trim().toLowerCase();
      
      if (query === '') {
        clearSearch();
        return;
      }
      
      searchQuery = query;
      searchActive = true;
      
      // Search posts
      const allPosts = [...posts, ...samplePosts];
      const filteredPosts = allPosts.filter(post => 
        post.text && post.text.toLowerCase().includes(query) ||
        post.displayName.toLowerCase().includes(query) ||
        post.author.toLowerCase().includes(query)
      );
      
      // Search users
      const filteredUsers = users.filter(user => 
        user.username.toLowerCase().includes(query) ||
        user.displayName.toLowerCase().includes(query)
      );
      
      displaySearchResults(filteredPosts, filteredUsers, query);
    }

    function displaySearchResults(filteredPosts, filteredUsers, query) {
      const searchResults = document.getElementById('search-results');
      const searchTitle = document.getElementById('search-title');
      const searchPostsContainer = document.getElementById('search-posts-container');
      const searchUsersContainer = document.getElementById('search-users-container');
      const regularPosts = document.getElementById('posts-container');
      const postComposer = document.getElementById('post-composer');
      
      searchResults.style.display = 'block';
      regularPosts.style.display = 'none';
      postComposer.style.display = 'none';
      
      searchTitle.innerHTML = `üîç Resultados para "${query}" <button class="clear-search" onclick="clearSearch()">Limpar</button>`;
      
      // Display posts results
      if (filteredPosts.length === 0) {
        searchPostsContainer.innerHTML = '<div class="no-results">Nenhum post encontrado para esta pesquisa.</div>';
      } else {
        searchPostsContainer.innerHTML = filteredPosts.map(post => generatePostHTML(post)).join('');
      }
      
      // Display users results
      if (filteredUsers.length > 0) {
        searchUsersContainer.innerHTML = `
          <h3>Usu√°rios encontrados</h3>
          ${filteredUsers.map(user => {
            const isFollowing = currentUser && currentUser.following.includes(user.username);
            const isCurrentUser = currentUser && currentUser.username === user.username;
            const avatarStyle = user.avatar ? `background-image: url('${user.avatar}')` : '';
            
            return `
              <div class="search-user-profile">
                <div class="search-user-avatar" onclick="viewUserProfile('${user.username}')" style="${avatarStyle}">${user.avatar ? '' : user.displayName.charAt(0).toUpperCase()}</div>
                <div class="search-user-info">
                  <div class="search-user-name" onclick="viewUserProfile('${user.username}')">${user.displayName}</div>
                  <div class="search-user-username" onclick="viewUserProfile('${user.username}')">@${user.username}</div>
                  <div class="search-user-actions">
                    ${!isCurrentUser ? `
                      ${isFollowing ? `
                        <button class="unfollow-btn" onclick="unfollowUser('${user.username}')">Deixar de seguir</button>
                        <button class="chat-btn" onclick="startChat('${user.username}')">Conversar</button>
                      ` : `
                        <button class="follow-btn" onclick="followUser('${user.username}')">Seguir</button>
                      `}
                    ` : ''}
                  </div>
                </div>
              </div>
            `;
          }).join('')}
        `;
      } else {
        searchUsersContainer.innerHTML = '';
      }
    }

    function clearSearch() {
      document.getElementById('search-input').value = '';
      document.getElementById('search-results').style.display = 'none';
      document.getElementById('posts-container').style.display = 'block';
      document.getElementById('post-composer').style.display = 'block';
      searchActive = false;
      searchQuery = '';
    }

    function startChat(username) {
      showPage('chat');
      openChat(username);
    }

    // Data functions
    function saveDataToServer() {
      try {
        const data = { users, posts, comments, notifications, timestamp: Date.now() };
        console.log('‚úÖ Dados salvos no servidor!');
      } catch (error) {
        console.error('‚ùå Erro ao salvar:', error);
      }
    }

    function loadDataFromServer() {
      try {
        console.log('üì° Conectando ao servidor...');
      } catch (error) {
        console.error('‚ùå Erro ao carregar:', error);
      }
    }

    function checkLoginStatus() {
      // Simulate checking login status
      showLoggedOutState();
    }

    function showLoggedInState() {
      document.getElementById('auth-section').style.display = 'none';
      document.getElementById('feed-section').style.display = 'block';
      document.getElementById('user-info').style.display = 'block';
      document.getElementById('perfil-link').style.display = 'block';
      document.getElementById('requests-link').style.display = 'block';
      document.getElementById('config-link').style.display = 'block';
      document.getElementById('search-input').style.display = 'block';
      document.getElementById('chat-link').style.display = 'block';
      
      document.getElementById('user-display-name').textContent = currentUser.displayName;
      const avatarElement = document.getElementById('user-avatar');
      if (currentUser.avatar) {
        avatarElement.style.backgroundImage = `url('${currentUser.avatar}')`;
        avatarElement.textContent = '';
      } else {
        avatarElement.style.backgroundImage = '';
        avatarElement.textContent = currentUser.displayName.charAt(0).toUpperCase();
      }
      
      updateNotificationsBadge();
      generatePosts();
      updateProfile();
    }

    function showLoggedOutState() {
      document.getElementById('auth-section').style.display = 'block';
      document.getElementById('feed-section').style.display = 'none';
      document.getElementById('user-info').style.display = 'none';
      document.getElementById('perfil-link').style.display = 'none';
      document.getElementById('requests-link').style.display = 'none';
      document.getElementById('config-link').style.display = 'none';
      document.getElementById('search-input').style.display = 'none';
      document.getElementById('notification-badge').style.display = 'none';
      document.getElementById('chat-link').style.display = 'none';
    }

    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      
      document.getElementById(pageId).classList.add('active');
      document.getElementById(pageId + '-link').classList.add('active');
      
      if (pageId === 'feed') {
        generatePosts();
      } else if (pageId === 'perfil') {
        updateProfile();
      } else if (pageId === 'chat') {
        loadConversations();
      } else if (pageId === 'requests') {
        loadFollowRequests();
      } else if (pageId === 'config') {
        loadProfileSettings();
      }
    }

    function switchAuthTab(tab) {
      document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
      
      if (tab === 'login') {
        document.getElementById('login-tab').classList.add('active');
        document.getElementById('login-form').style.display = 'block';
        document.getElementById('register-form').style.display = 'none';
      } else {
        document.getElementById('register-tab').classList.add('active');
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('register-form').style.display = 'block';
      }
    }

    function login() {
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;
      const status = document.getElementById('login-status');

      if (!username || !password) {
        status.textContent = '‚ö†Ô∏è Preencha todos os campos.';
        status.className = 'notice error';
        return;
      }

      const user = users.find(u => 
        u.username === username && u.password === password
      );

      if (user) {
        currentUser = user;
        status.textContent = '‚úÖ Login realizado!';
        status.className = 'notice success';
        setTimeout(() => {
          showLoggedInState();
          // Check if user is banned after login
          setTimeout(() => {
            checkUserBanStatus();
          }, 500);
        }, 1000);
      } else {
        status.textContent = '‚ùå Dados inv√°lidos.';
        status.className = 'notice error';
      }
    }

    function register() {
      const username = document.getElementById('reg-username').value;
      const displayName = document.getElementById('reg-displayname').value;
      const password = document.getElementById('reg-password').value;
      const confirm = document.getElementById('reg-confirm-password').value;
      const status = document.getElementById('register-status');

      if (!username || !displayName || !password || !confirm) {
        status.textContent = '‚ö†Ô∏è Preencha todos os campos.';
        status.className = 'notice error';
        return;
      }

      if (password.length < 5 || password.length > 15) {
        status.textContent = '‚ùå A senha deve ter entre 5 e 15 caracteres.';
        status.className = 'notice error';
        return;
      }

      if (password !== confirm) {
        status.textContent = '‚ùå Senhas n√£o coincidem.';
        status.className = 'notice error';
        return;
      }

      if (users.find(u => u.username === username)) {
        status.textContent = '‚ùå Usu√°rio j√° existe.';
        status.className = 'notice error';
        return;
      }

      const avatarFile = document.getElementById('reg-avatar').files[0];
      let avatarUrl = '';
      
      if (avatarFile) {
        avatarUrl = URL.createObjectURL(avatarFile);
      }

      const newUser = { 
        username, 
        displayName, 
        password,
        avatar: avatarUrl,
        followers: [],
        following: [],
        followRequests: [],
        isAdmin: false,
        banned: false,
        banExpiry: null,
        banReason: null
      };
      users.push(newUser);
      saveDataToServer();
      
      status.textContent = '‚úÖ Conta criada! Fa√ßa login.';
      status.className = 'notice success';
      
      setTimeout(() => {
        switchAuthTab('login');
        document.getElementById('login-username').value = username;
      }, 1500);
    }

    function logout() {
      currentUser = null;
      showLoggedOutState();
      showPage('feed');
    }

    function previewMedia() {
      const file = document.getElementById('post-media').files[0];
      const preview = document.getElementById('media-preview');
      const status = document.getElementById('post-status');
      
      if (file) {
        // Check file size (100 MB = 100 * 1024 * 1024 bytes)
        const maxSize = 100 * 1024 * 1024;
        if (file.size > maxSize) {
          status.textContent = '‚ùå Arquivo muito grande! Limite m√°ximo: 100 MB';
          status.className = 'notice error';
          document.getElementById('post-media').value = '';
          preview.innerHTML = '';
          return;
        }
        
        const url = URL.createObjectURL(file);
        const isImage = file.type.startsWith('image/');
        const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
        
        if (isImage) {
          preview.innerHTML = `
            <img src="${url}" alt="Preview">
            <div style="text-align: center; margin-top: 0.5rem; font-size: 0.8rem; color: #888;">
              üìÅ ${file.name} (${fileSizeMB} MB)
            </div>
          `;
        } else {
          preview.innerHTML = `
            <video src="${url}" controls></video>
            <div style="text-align: center; margin-top: 0.5rem; font-size: 0.8rem; color: #888;">
              üìÅ ${file.name} (${fileSizeMB} MB)
            </div>
          `;
        }
        
        // Clear any previous error messages
        if (status.className === 'notice error') {
          status.textContent = '';
          status.className = 'notice';
        }
      } else {
        preview.innerHTML = '';
      }
    }

    function previewConfigAvatar() {
      const file = document.getElementById('config-avatar').files[0];
      const preview = document.getElementById('config-avatar-preview');
      
      if (file) {
        const url = URL.createObjectURL(file);
        preview.style.backgroundImage = `url('${url}')`;
        preview.textContent = '';
      } else {
        preview.style.backgroundImage = '';
        preview.textContent = currentUser.displayName.charAt(0).toUpperCase();
      }
    }

    function createPost() {
      const text = document.getElementById('post-text').value;
      const mediaFile = document.getElementById('post-media').files[0];
      const isPrivate = document.getElementById('private-post-checkbox').checked;
      const status = document.getElementById('post-status');

      if (!text && !mediaFile) {
        status.textContent = '‚ö†Ô∏è Escreva algo ou adicione m√≠dia.';
        status.className = 'notice error';
        return;
      }

      // Double-check file size limit
      if (mediaFile) {
        const maxSize = 100 * 1024 * 1024; // 100 MB
        if (mediaFile.size > maxSize) {
          status.textContent = '‚ùå Arquivo muito grande! Limite m√°ximo: 100 MB';
          status.className = 'notice error';
          return;
        }
      }

      const newPost = {
        id: Date.now(),
        author: currentUser.username,
        displayName: currentUser.displayName,
        text: text,
        time: 'agora',
        likes: 0,
        dislikes: 0,
        liked: false,
        disliked: false,
        favorites: 0,
        favorited: false,
        commentsCount: 0,
        private: isPrivate
      };

      if (mediaFile) {
        newPost.media = {
          type: mediaFile.type.startsWith('image/') ? 'image' : 'video',
          url: URL.createObjectURL(mediaFile)
        };
      }

      posts.unshift(newPost);
      saveDataToServer();
      
      // Notify followers
      notifyFollowers(newPost);
      
      document.getElementById('post-text').value = '';
      document.getElementById('post-media').value = '';
      document.getElementById('media-preview').innerHTML = '';
      document.getElementById('private-post-checkbox').checked = false;
      
      status.textContent = '‚úÖ Post criado!';
      status.className = 'notice success';
      
      setTimeout(() => {
        status.textContent = '';
        status.className = 'notice';
      }, 3000);

      generatePosts();
    }

    function toggleFavorite(postId) {
      if (!currentUser) return;
      if (isUserBanned(currentUser)) {
        showBannedMessage();
        return;
      }
      
      const allPosts = [...posts, ...samplePosts];
      const post = allPosts.find(p => p.id === postId);
      
      if (post) {
        if (post.favorited) {
          post.favorites = (post.favorites || 0) - 1;
          post.favorited = false;
        } else {
          post.favorites = (post.favorites || 0) + 1;
          post.favorited = true;
        }
        saveDataToServer();
        
        if (searchActive) {
          handleSearch();
        } else {
          generatePosts();
        }
      }
    }

    function generatePostHTML(post) {
      const user = users.find(u => u.username === post.author);
      const avatarStyle = user && user.avatar ? `background-image: url('${user.avatar}')` : '';
      
      // Check if post author is banned
      const isAuthorBanned = user && isUserBanned(user);
      
      if (isAuthorBanned) {
        return `
          <div class="post banned-content" data-post-id="${post.id}">
            <div class="banned-indicator">
              üîí Conte√∫do temporariamente indispon√≠vel - Usu√°rio banido
            </div>
          </div>
        `;
      }
      
      return `
        <div class="post" data-post-id="${post.id}">
          <div class="post-header">
            <div class="post-avatar" onclick="viewUserProfile('${post.author}')" style="${avatarStyle}">${user && user.avatar ? '' : post.displayName.charAt(0).toUpperCase()}</div>
            <div>
              <div class="post-author" onclick="viewUserProfile('${post.author}')">${post.displayName}</div>
              <div class="post-time">${post.time}</div>
            </div>
            ${currentUser && post.author === currentUser.username ? `
              <div class="post-menu" onclick="togglePostMenu(${post.id})">
                <div class="post-menu-dots">‚ãØ</div>
                <div class="post-dropdown" id="dropdown-${post.id}">
                  <button class="dropdown-item edit" onclick="editPost(${post.id})">‚úèÔ∏è Editar</button>
                  <button class="dropdown-item delete" onclick="deletePost(${post.id})">üóëÔ∏è Excluir</button>
                </div>
              </div>
            ` : ''}
          </div>
          <div class="post-content">
            ${post.private ? `<div class="post-privacy-indicator">üîí Post privado</div>` : ''}
            ${post.text ? `<div class="post-text">${post.text}</div>` : ''}
            ${post.media ? `
              <div class="post-media" onclick="openModal('${post.media.url}', '${post.media.type}')">
                ${post.media.type === 'image' ? 
                  `<img src="${post.media.url}" class="post-image" alt="Post image">` :
                  `<video src="${post.media.url}" class="post-video" controls></video>`}
              </div>
            ` : ''}
          </div>
          <div class="post-actions">
            <button class="action-btn ${post.liked ? 'liked' : ''}" onclick="toggleLike(${post.id})">
              üëç ${post.likes || 0}
            </button>
            <button class="action-btn ${post.disliked ? 'disliked' : ''}" onclick="toggleDislike(${post.id})">
              üëé ${post.dislikes || 0}
            </button>
            <button class="action-btn ${post.favorited ? 'favorited' : ''}" onclick="toggleFavorite(${post.id})">
              ‚≠ê ${post.favorites || 0}
            </button>
            <button class="action-btn" onclick="downloadPost(${post.id})" title="Download do post">
              ‚¨áÔ∏è Download
            </button>
            <button class="action-btn" onclick="sharePost(${post.id})" title="Compartilhar post">
              üîó Compartilhar
            </button>
            <button class="action-btn" onclick="toggleComments(${post.id})">
              üí¨ ${comments.filter(c => c.postId === post.id).length}
            </button>
          </div>
          <div class="comments-section" id="comments-${post.id}" style="display: none;">
            <div class="comment-form">
              <input type="text" class="comment-input" id="comment-input-${post.id}" placeholder="Escreva um coment√°rio...">
              <button class="comment-btn" onclick="addComment(${post.id})">Comentar</button>
            </div>
            <div class="comments-list" id="comments-list-${post.id}">
              ${renderComments(post.id)}
            </div>
          </div>
        </div>
      `;
    }

    function generatePosts() {
      const container = document.getElementById('posts-container');
      const allPosts = [...posts, ...samplePosts];
      
      container.innerHTML = allPosts.map(post => generatePostHTML(post)).join('');
    }

    // Check if user is banned
    function isUserBanned(user) {
      if (!user || !user.banned) return false;
      
      if (user.banExpiry === null) return true; // Permanent ban
      
      const now = new Date();
      const banExpiry = new Date(user.banExpiry);
      
      if (now > banExpiry) {
        // Ban expired, unban user
        user.banned = false;
        user.banExpiry = null;
        user.banReason = null;
        saveDataToServer();
        return false;
      }
      
      return true;
    }

    function showBannedMessage() {
      alert('üîí Voc√™ est√° banido e n√£o pode realizar esta a√ß√£o.');
    }

    function toggleLike(postId) {
      if (!currentUser) return;
      if (isUserBanned(currentUser)) {
        showBannedMessage();
        return;
      }
      
      const allPosts = [...posts, ...samplePosts];
      const post = allPosts.find(p => p.id === postId);
      
      if (post) {
        if (post.liked) {
          post.likes = (post.likes || 0) - 1;
          post.liked = false;
        } else {
          if (post.disliked) {
            post.dislikes = (post.dislikes || 0) - 1;
            post.disliked = false;
          }
          post.likes = (post.likes || 0) + 1;
          post.liked = true;
        }
        saveDataToServer();
        
        if (searchActive) {
          handleSearch();
        } else {
          generatePosts();
        }
      }
    }

    function toggleDislike(postId) {
      if (!currentUser) return;
      if (isUserBanned(currentUser)) {
        showBannedMessage();
        return;
      }
      
      const allPosts = [...posts, ...samplePosts];
      const post = allPosts.find(p => p.id === postId);
      
      if (post) {
        if (post.disliked) {
          post.dislikes = (post.dislikes || 0) - 1;
          post.disliked = false;
        } else {
          if (post.liked) {
            post.likes = (post.likes || 0) - 1;
            post.liked = false;
          }
          post.dislikes = (post.dislikes || 0) + 1;
          post.disliked = true;
        }
        saveDataToServer();
        
        if (searchActive) {
          handleSearch();
        } else {
          generatePosts();
        }
      }
    }

    function sharePost(postId) {
      const shareUrl = `${window.location.origin}${window.location.pathname}?post=${postId}`;
      document.getElementById('share-link').textContent = shareUrl;
      document.getElementById('share-modal').style.display = 'block';
      
      // Close dropdown
      document.getElementById(`dropdown-${postId}`).classList.remove('show');
    }

    function copyShareLink() {
      const shareLink = document.getElementById('share-link').textContent;
      navigator.clipboard.writeText(shareLink).then(() => {
        const btn = document.getElementById('copy-link-btn');
        const originalText = btn.textContent;
        btn.textContent = '‚úÖ Copiado!';
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      });
    }

    function closeShareModal() {
      document.getElementById('share-modal').style.display = 'none';
    }

    function notifyFollowers(post) {
      const user = users.find(u => u.username === post.author);
      if (!user) return;
      
      user.followers.forEach(follower => {
        const notification = {
          id: Date.now(),
          userId: follower,
          postId: post.id,
          author: post.author,
          displayName: post.displayName,
          text: post.text,
          time: 'agora',
          read: false
        };
        
        notifications.push(notification);
      });
      
      saveDataToServer();
      updateNotificationsBadge();
    }

    function toggleNotifications() {
      const dropdown = document.getElementById('notification-dropdown');
      dropdown.classList.toggle('show');
      
      if (dropdown.classList.contains('show')) {
        loadNotifications();
      }
    }

    function loadNotifications() {
      if (!currentUser) return;
      
      const userNotifications = notifications
        .filter(n => n.userId === currentUser.username && !n.read)
        .sort((a, b) => b.id - a.id);
      
      const dropdown = document.getElementById('notification-dropdown');
      
      if (userNotifications.length === 0) {
        dropdown.innerHTML = `<div class="notification-item">Nenhuma notifica√ß√£o nova</div>`;
        return;
      }
      
      dropdown.innerHTML = userNotifications.map(notification => `
        <div class="notification-item" onclick="viewNotification('${notification.id}', '${notification.postId}')">
          <div class="notification-text">
            <strong>${notification.displayName}</strong> postou algo novo: 
            ${notification.text ? notification.text.substring(0, 50) + (notification.text.length > 50 ? '...' : '') : ''}
          </div>
          <div class="notification-time">${notification.time}</div>
        </div>
      `).join('');
    }

    function viewNotification(notificationId, postId) {
      // Mark as read
      const notification = notifications.find(n => n.id == notificationId);
      if (notification) {
        notification.read = true;
        saveDataToServer();
      }
      
      // Find the post
      const post = posts.find(p => p.id == postId);
      if (post) {
        // Show the post in feed
        clearSearch();
        showPage('feed');
        // Scroll to the post
        setTimeout(() => {
          const postElement = document.querySelector(`[data-post-id="${postId}"]`);
          if (postElement) {
            postElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            postElement.classList.add('highlight-post');
            setTimeout(() => postElement.classList.remove('highlight-post'), 2000);
          }
        }, 100);
      }
      
      // Close dropdown
      document.getElementById('notification-dropdown').classList.remove('show');
      updateNotificationsBadge();
    }

    function updateNotificationsBadge() {
      if (!currentUser) return;
      
      const unreadCount = notifications.filter(n => 
        n.userId === currentUser.username && !n.read
      ).length;
      
      const badge = document.getElementById('notification-badge');
      
      if (unreadCount > 0) {
        badge.textContent = unreadCount;
        badge.style.display = 'flex';
      } else {
        badge.style.display = 'none';
      }
    }

    function renderComments(postId) {
      const postComments = comments.filter(c => c.postId == postId).sort((a, b) => b.id - a.id);
      
      if (postComments.length === 0) {
        return '<p>Nenhum coment√°rio ainda.</p>';
      }
      
      return postComments.map(comment => {
        const user = users.find(u => u.username === comment.author);
        const displayName = user ? user.displayName : comment.author;
        const avatarStyle = user && user.avatar ? `background-image: url('${user.avatar}')` : '';
        
        // Check if comment author is banned
        const isAuthorBanned = user && isUserBanned(user);
        
        if (isAuthorBanned) {
          return `
            <div class="comment banned-content">
              <div class="banned-indicator">
                üîí Coment√°rio indispon√≠vel - Usu√°rio banido
              </div>
            </div>
          `;
        }
        
        return `
          <div class="comment">
            <div class="comment-avatar" style="${avatarStyle}">${user && user.avatar ? '' : displayName.charAt(0).toUpperCase()}</div>
            <div class="comment-content">
              <div class="comment-author">${displayName}</div>
              <div class="comment-text">${comment.text}</div>
              <div class="comment-time">${comment.time}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function toggleComments(postId) {
      const commentsSection = document.getElementById(`comments-${postId}`);
      commentsSection.style.display = commentsSection.style.display === 'none' ? 'block' : 'none';
    }

    function addComment(postId) {
      if (!currentUser) return;
      if (isUserBanned(currentUser)) {
        showBannedMessage();
        return;
      }
      
      const commentInput = document.getElementById(`comment-input-${postId}`);
      const commentText = commentInput.value.trim();
      
      if (!commentText) return;
      
      const newComment = {
        id: Date.now(),
        postId: postId,
        author: currentUser.username,
        text: commentText,
        time: 'agora'
      };
      
      comments.unshift(newComment);
      saveDataToServer();
      
      // Update comments count in post
      const post = posts.find(p => p.id == postId);
      if (post) {
        post.commentsCount = comments.filter(c => c.postId == postId).length;
        saveDataToServer();
      }
      
      // Update comments display
      document.getElementById(`comments-list-${postId}`).innerHTML = renderComments(postId);
      commentInput.value = '';
      
      // Notify post author
      if (post && post.author !== currentUser.username) {
        const notification = {
          id: Date.now(),
          userId: post.author,
          postId: post.id,
          author: currentUser.username,
          displayName: currentUser.displayName,
          text: `comentou no seu post: ${commentText.substring(0, 50)}${commentText.length > 50 ? '...' : ''}`,
          time: 'agora',
          read: false
        };
        
        notifications.push(notification);
        saveDataToServer();
        
        if (notification.userId === currentUser.username) {
          updateNotificationsBadge();
        }
      }
    }

    function downloadMedia(url, type) {
      const a = document.createElement('a');
      a.href = url;
      a.download = `tropa-media-${Date.now()}.${type === 'image' ? 'jpg' : 'mp4'}`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    function viewUserProfile(username) {
      if (!currentUser) return;
      
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      viewingUserProfile = user;
      
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      
      document.getElementById('user-profile').classList.add('active');
      
      const profileContent = document.getElementById('user-profile-content');
      
      const isFollowing = currentUser.following.includes(username);
      const isCurrentUser = currentUser.username === username;
      const hasRequested = user.followRequests.includes(currentUser.username);
      
      const avatarStyle = user.avatar ? `background-image: url('${user.avatar}')` : '';
      
      profileContent.innerHTML = `
        <div class="user-profile-header">
          <div class="profile-avatar" style="${avatarStyle}">${user.avatar ? '' : user.displayName.charAt(0).toUpperCase()}</div>
          <div class="profile-info">
            <h2>${user.displayName}</h2>
            <p>@${user.username}</p>
            ${user.banned ? `
              <div class="banned-indicator">
                üîí Usu√°rio Banido ${user.banExpiry ? `at√© ${new Date(user.banExpiry).toLocaleDateString('pt-BR')}` : 'Permanentemente'}
                ${user.banReason ? `<br><small>Motivo: ${user.banReason}</small>` : ''}
              </div>
            ` : ''}
            <div class="profile-stats">
              <div class="stat-item" onclick="showFollowers('${user.username}')">
                <div class="stat-number">${user.followers.length}</div>
                <div class="stat-label">Seguidores</div>
              </div>
              <div class="stat-item" onclick="showFollowing('${user.username}')">
                <div class="stat-number">${user.following.length}</div>
                <div class="stat-label">Seguindo</div>
              </div>
              <div class="stat-item">
                                <div class="stat-number">${posts.filter(p => p.author === user.username).length}</div>
                <div class="stat-label">Posts</div>
              </div>
            </div>
          </div>
        </div>
        <div class="user-actions">
          ${!isCurrentUser ? `
            ${isFollowing ? `
              <button class="unfollow-btn" onclick="unfollowUser('${user.username}')">Deixar de seguir</button>
              <button class="chat-btn" onclick="startChat('${user.username}')">Conversar</button>
            ` : `
              ${hasRequested ? `
                <button class="follow-btn" disabled>Solicita√ß√£o enviada</button>
              ` : `
                <button class="follow-btn" onclick="followUser('${user.username}')">Seguir</button>
              `}
            `}
            ${currentUser.isAdmin && !user.isAdmin ? `
              <button class="ban-btn ${user.banned ? 'unban' : 'ban'}" onclick="${user.banned ? `unbanUser('${user.username}')` : `showBanModal('${user.username}')`}">
                ${user.banned ? 'üîì Desbanir' : 'üîí Banir'}
              </button>
            ` : ''}
          ` : ''}
        </div>
        <div class="profile-tabs">
          <button class="profile-tab active" onclick="showProfileTab('posts', '${user.username}')">üìù Posts</button>
          <button class="profile-tab" onclick="showProfileTab('favorites', '${user.username}')">‚≠ê Favoritos</button>
          <button class="profile-tab" onclick="showProfileTab('likes', '${user.username}')">üëç Curtidas</button>
        </div>
        <div class="profile-content">
          <div id="profile-posts-${user.username}" class="profile-tab-content active">
            ${(() => {
              const userPosts = posts.filter(p => p.author === user.username);
              // Filter private posts based on following status
              const visiblePosts = userPosts.filter(post => {
                if (!post.private) return true; // Public posts are always visible
                if (post.author === currentUser.username) return true; // Own posts are always visible
                return currentUser.following.includes(post.author); // Private posts only for followers
              });
              
              return visiblePosts.length === 0 ? 
                '<p>Nenhum post vis√≠vel.</p>' : 
                visiblePosts.map(post => generatePostHTML(post)).join('');
            })()}
          </div>
          <div id="profile-favorites-${user.username}" class="profile-tab-content" style="display: none;">
            <div class="empty-content">üåü Nada por aqui</div>
          </div>
          <div id="profile-likes-${user.username}" class="profile-tab-content" style="display: none;">
            <div class="empty-content">üëç Nada por aqui</div>
          </div>
        </div>
      `;
      
      // Load content for favorites and likes tabs
      setTimeout(() => {
        refreshFavoritesTab(user.username);
        refreshLikesTab(user.username);
      }, 100);
    }

    function showProfileTab(tabName, username) {
      // Hide all tab contents
      document.querySelectorAll(`[id^="profile-"][id$="-${username}"]`).forEach(tab => {
        tab.style.display = 'none';
      });
      
      // Remove active class from all tabs
      document.querySelectorAll('.profile-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected tab content
      const selectedTab = document.getElementById(`profile-${tabName}-${username}`);
      if (selectedTab) {
        selectedTab.style.display = 'block';
      }
      
      // Add active class to clicked tab
      event.target.classList.add('active');
      
      // Refresh content based on tab
      if (tabName === 'favorites') {
        refreshFavoritesTab(username);
      } else if (tabName === 'likes') {
        refreshLikesTab(username);
      }
    }

    function showFollowers(username) {
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      const followersList = user.followers.map(follower => {
        const followerUser = users.find(u => u.username === follower);
        return followerUser ? followerUser.displayName : follower;
      }).join(', ');
      
      alert(`Seguidores de ${user.displayName}:\n\n${followersList || 'Nenhum seguidor'}`);
    }

    function showFollowing(username) {
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      const followingList = user.following.map(followed => {
        const followedUser = users.find(u => u.username === followed);
        return followedUser ? followedUser.displayName : followed;
      }).join(', ');
      
      alert(`${user.displayName} est√° seguindo:\n\n${followingList || 'Ningu√©m'}`);
    }

    function followUser(username) {
      if (!currentUser) return;
      
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      if (user.followRequests.includes(currentUser.username)) {
        alert('Voc√™ j√° enviou uma solicita√ß√£o para este usu√°rio.');
        return;
      }
      
      user.followRequests.push(currentUser.username);
      saveDataToServer();
      
      // Notify the user
      const notification = {
        id: Date.now(),
        userId: username,
        author: currentUser.username,
        displayName: currentUser.displayName,
        text: 'quer seguir voc√™',
        time: 'agora',
        read: false,
        type: 'follow-request'
      };
      
      notifications.push(notification);
      saveDataToServer();
      
      alert(`Solicita√ß√£o enviada para ${user.displayName}. Eles precisam aceitar para que voc√™ possa segui-los.`);
      
      if (viewingUserProfile) {
        viewUserProfile(username);
      }
    }

    function unfollowUser(username) {
      if (!currentUser) return;
      
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      currentUser.following = currentUser.following.filter(u => u !== username);
      user.followers = user.followers.filter(u => u !== currentUser.username);
      saveDataToServer();
      
      if (viewingUserProfile) {
        viewUserProfile(username);
      } else {
        generatePosts();
      }
    }

    function loadFollowRequests() {
      if (!currentUser) return;
      
      const requests = notifications.filter(n => 
        n.userId === currentUser.username && 
        n.type === 'follow-request' && 
        !n.read
      );
      
      const container = document.getElementById('follow-requests-container');
      
      if (requests.length === 0) {
        container.innerHTML = '<p>Nenhuma solicita√ß√£o pendente.</p>';
        return;
      }
      
      container.innerHTML = requests.map(request => {
        const requester = users.find(u => u.username === request.author);
        return `
          <div class="follow-request-item">
            <div class="request-user-info">
              <div class="request-avatar" style="${requester.avatar ? `background-image: url('${requester.avatar}')` : ''}">
                ${requester.avatar ? '' : requester.displayName.charAt(0).toUpperCase()}
              </div>
              <div>
                <div>${requester.displayName}</div>
                <div class="request-username">@${requester.username}</div>
              </div>
            </div>
            <div class="follow-request-buttons">
              <button class="request-btn accept-btn" onclick="acceptFollowRequest('${request.id}', '${requester.username}')">Aceitar</button>
              <button class="request-btn reject-btn" onclick="rejectFollowRequest('${request.id}', '${requester.username}')">Recusar</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function acceptFollowRequest(notificationId, requesterUsername) {
      if (!currentUser) return;
      
      // Mark notification as read
      const notification = notifications.find(n => n.id == notificationId);
      if (notification) {
        notification.read = true;
      }
      
      // Add to followers/following
      const requester = users.find(u => u.username === requesterUsername);
      if (requester) {
        currentUser.followers.push(requesterUsername);
        requester.following.push(currentUser.username);
        
        // Remove from follow requests
        currentUser.followRequests = currentUser.followRequests.filter(u => u !== requesterUsername);
        
        saveDataToServer();
        
        // Notify requester
        const acceptedNotification = {
          id: Date.now(),
          userId: requesterUsername,
          author: currentUser.username,
          displayName: currentUser.displayName,
          text: 'aceitou sua solicita√ß√£o de seguir',
          time: 'agora',
          read: false
        };
        
        notifications.push(acceptedNotification);
        saveDataToServer();
        
        loadFollowRequests();
        updateNotificationsBadge();
      }
    }

    function rejectFollowRequest(notificationId, requesterUsername) {
      if (!currentUser) return;
      
      // Mark notification as read
      const notification = notifications.find(n => n.id == notificationId);
      if (notification) {
        notification.read = true;
      }
      
      // Remove from follow requests
      currentUser.followRequests = currentUser.followRequests.filter(u => u !== requesterUsername);
      saveDataToServer();
      
      loadFollowRequests();
      updateNotificationsBadge();
    }

    function updateProfile() {
      if (!currentUser) return;
      
      const profileContent = document.getElementById('profile-content');
      const userPosts = posts.filter(p => p.author === currentUser.username);
      
      const avatarStyle = currentUser.avatar ? `background-image: url('${currentUser.avatar}')` : '';
      
      profileContent.innerHTML = `
        <div class="user-profile-header">
          <div class="profile-avatar" style="${avatarStyle}">${currentUser.avatar ? '' : currentUser.displayName.charAt(0).toUpperCase()}</div>
          <div class="profile-info">
            <h2>${currentUser.displayName}</h2>
            <p>@${currentUser.username}</p>
            <div class="profile-stats">
              <div class="stat-item" onclick="showFollowers('${currentUser.username}')">
                <div class="stat-number">${currentUser.followers.length}</div>
                <div class="stat-label">Seguidores</div>
              </div>
              <div class="stat-item" onclick="showFollowing('${currentUser.username}')">
                <div class="stat-number">${currentUser.following.length}</div>
                <div class="stat-label">Seguindo</div>
              </div>
              <div class="stat-item">
                <div class="stat-number">${userPosts.length}</div>
                <div class="stat-label">Posts</div>
              </div>
            </div>
          </div>
        </div>
        <div class="user-posts">
          <h3>Meus Posts</h3>
          ${userPosts.length === 0 ? 
            '<p>Voc√™ ainda n√£o fez nenhum post.</p>' : 
            userPosts.map(post => generatePostHTML(post)).join('')}
        </div>
      `;
    }

    function loadProfileSettings() {
      if (!currentUser) return;
      
      document.getElementById('config-displayname').value = currentUser.displayName;
      
      const avatarPreview = document.getElementById('config-avatar-preview');
      if (currentUser.avatar) {
        avatarPreview.style.backgroundImage = `url('${currentUser.avatar}')`;
        avatarPreview.textContent = '';
      } else {
        avatarPreview.style.backgroundImage = '';
        avatarPreview.textContent = currentUser.displayName.charAt(0).toUpperCase();
      }
    }

    function saveProfileSettings() {
      if (!currentUser) return;
      
      const newDisplayName = document.getElementById('config-displayname').value.trim();
      const avatarFile = document.getElementById('config-avatar').files[0];
      
      if (!newDisplayName) {
        alert('O nome de exibi√ß√£o n√£o pode estar vazio.');
        return;
      }
      
      currentUser.displayName = newDisplayName;
      
      if (avatarFile) {
        currentUser.avatar = URL.createObjectURL(avatarFile);
      }
      
      saveDataToServer();
      updateProfile();
      showLoggedInState(); // Refresh UI
      
      alert('Configura√ß√µes salvas com sucesso!');
    }

    function changePassword() {
      if (!currentUser) return;
      
      const currentPassword = document.getElementById('config-current-password').value;
      const newPassword = document.getElementById('config-new-password').value;
      const confirmPassword = document.getElementById('config-confirm-password').value;
      
      if (!currentPassword && (newPassword || confirmPassword)) {
        alert('Para alterar a senha, voc√™ deve fornecer sua senha atual.');
        return;
      }
      
      if (currentPassword && currentPassword !== currentUser.password) {
        alert('Senha atual incorreta.');
        return;
      }
      
      if (newPassword.length < 5 || newPassword.length > 15) {
        alert('A nova senha deve ter entre 5 e 15 caracteres.');
        return;
      }
      
      if (newPassword !== confirmPassword) {
        alert('As novas senhas n√£o coincidem.');
        return;
      }
      
      currentUser.password = newPassword;
      saveDataToServer();
      
      document.getElementById('config-current-password').value = '';
      document.getElementById('config-new-password').value = '';
      document.getElementById('config-confirm-password').value = '';
      
      alert('Senha alterada com sucesso!');
    }

    function togglePostMenu(postId) {
      const dropdown = document.getElementById(`dropdown-${postId}`);
      dropdown.classList.toggle('show');
    }

    function editPost(postId) {
      const post = posts.find(p => p.id == postId);
      if (!post) return;
      
      editingPostId = postId;
      document.getElementById('edit-text').value = post.text;
      document.getElementById('edit-modal').style.display = 'block';
      
      // Close dropdown
      document.getElementById(`dropdown-${postId}`).classList.remove('show');
    }

    function saveEdit() {
      if (!editingPostId) return;
      
      const newText = document.getElementById('edit-text').value.trim();
      const post = posts.find(p => p.id == editingPostId);
      
      if (post) {
        post.text = newText;
        saveDataToServer();
        generatePosts();
      }
      
      closeEditModal();
    }

    function closeEditModal() {
      document.getElementById('edit-modal').style.display = 'none';
      editingPostId = null;
    }

    function deletePost(postId) {
      if (!confirm('Tem certeza que deseja excluir este post?')) return;
      
      posts = posts.filter(p => p.id != postId);
      saveDataToServer();
      generatePosts();
    }

    function openModal(url, type) {
      const modalContent = document.getElementById('modal-content');
      
      if (type === 'image') {
        modalContent.innerHTML = `<img src="${url}" alt="Media">`;
      } else {
        modalContent.innerHTML = `<video src="${url}" controls autoplay></video>`;
      }
      
      document.getElementById('media-modal').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('media-modal').style.display = 'none';
      document.getElementById('modal-content').innerHTML = '';
    }

    function showChat() {
      showPage('chat');
      loadConversations();
    }

    function loadConversations() {
      if (!currentUser) return;
      
      const userConversations = conversations.filter(c => 
        c.user1 === currentUser.username || c.user2 === currentUser.username
      );
      
      const container = document.getElementById('conversations-list');
      
      if (userConversations.length === 0) {
        container.innerHTML = '<p>Nenhuma conversa ainda. Comece uma nova conversa com algu√©m que voc√™ segue!</p>';
        return;
      }
      
      container.innerHTML = userConversations.map(conv => {
        const otherUser = conv.user1 === currentUser.username ? conv.user2 : conv.user1;
        const user = users.find(u => u.username === otherUser);
        const displayName = user ? user.displayName : otherUser;
        const avatarStyle = user && user.avatar ? `background-image: url('${user.avatar}')` : '';
        const lastMessage = conv.messages.length > 0 ? 
          conv.messages[conv.messages.length - 1].text.substring(0, 30) + 
          (conv.messages[conv.messages.length - 1].text.length > 30 ? '...' : '') : 
          'Nenhuma mensagem';
        
        return `
          <div class="user-search-item" onclick="openChat('${otherUser}')">
            <div class="user-search-avatar" style="${avatarStyle}">${user && user.avatar ? '' : displayName.charAt(0).toUpperCase()}</div>
            <div class="user-search-info">
              <div class="user-search-name">${displayName}</div>
              <div class="user-search-username">@${otherUser}</div>
              <div class="last-message">${lastMessage}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function openChat(username) {
      if (!currentUser) return;
      
      const otherUser = users.find(u => u.username === username);
      if (!otherUser) return;
      
      // Find or create conversation
      let conversation = conversations.find(c => 
        (c.user1 === currentUser.username && c.user2 === username) || 
        (c.user1 === username && c.user2 === currentUser.username)
      );
      
      if (!conversation) {
        conversation = {
          id: Date.now(),
          user1: currentUser.username,
          user2: username,
          messages: []
        };
        conversations.push(conversation);
        saveDataToServer();
      }
      
      currentChat = conversation;
      
      // Update UI
      document.getElementById('chat-container').style.display = 'block';
      document.getElementById('chat-with-user').textContent = `Conversando com ${otherUser.displayName}`;
      
      // Load messages
      const messagesContainer = document.getElementById('chat-messages');
      messagesContainer.innerHTML = conversation.messages.map(msg => {
        const isCurrentUser = msg.sender === currentUser.username;
        const user = users.find(u => u.username === msg.sender);
        const displayName = user ? user.displayName : msg.sender;
        
        return `
          <div style="margin-bottom: 10px; text-align: ${isCurrentUser ? 'right' : 'left'}">
            <div style="font-size: 0.8rem; color: #888;">${displayName}</div>
            <div style="background: ${isCurrentUser ? '#6e48aa' : '#36393f'}; 
                display: inline-block; 
                padding: 8px 12px; 
                border-radius: 8px; 
                max-width: 70%; 
                word-wrap: break-word;">
              ${msg.text}
            </div>
            <div style="font-size: 0.7rem; color: #888;">${msg.time}</div>
          </div>
        `;
      }).join('');
      
      // Scroll to bottom
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function closeChat() {
      document.getElementById('chat-container').style.display = 'none';
      currentChat = null;
    }

    function sendMessage() {
      if (!currentUser || !currentChat) return;
      
      const input = document.getElementById('chat-message');
      const messageText = input.value.trim();
      
      if (!messageText) return;
      
      const newMessage = {
        id: Date.now(),
        sender: currentUser.username,
        text: messageText,
        time: 'agora'
      };
      
      currentChat.messages.push(newMessage);
      saveDataToServer();
      
      // Update UI
      const messagesContainer = document.getElementById('chat-messages');
      const otherUser = users.find(u => u.username === (currentChat.user1 === currentUser.username ? currentChat.user2 : currentChat.user1));
      const displayName = otherUser ? otherUser.displayName : currentChat.user2;
      
      messagesContainer.innerHTML += `
        <div style="margin-bottom: 10px; text-align: right">
          <div style="font-size: 0.8rem; color: #888;">${currentUser.displayName}</div>
          <div style="background: #6e48aa; 
              display: inline-block; 
              padding: 8px 12px; 
              border-radius: 8px; 
              max-width: 70%; 
              word-wrap: break-word;">
            ${messageText}
          </div>
          <div style="font-size: 0.7rem; color: #888;">agora</div>
        </div>
      `;
      
      input.value = '';
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // Notify other user
      const notification = {
        id: Date.now(),
        userId: otherUser.username,
        author: currentUser.username,
        displayName: currentUser.displayName,
        text: `enviou uma mensagem: ${messageText.substring(0, 50)}${messageText.length > 50 ? '...' : ''}`,
        time: 'agora',
        read: false,
        type: 'message'
      };
      
      notifications.push(notification);
      saveDataToServer();
      
      if (notification.userId === currentUser.username) {
        updateNotificationsBadge();
      }
    }

    function toggleFavorite(postId) {
      if (!currentUser) return;
      
      const allPosts = [...posts, ...samplePosts];
      const post = allPosts.find(p => p.id === postId);
      
      if (post) {
        if (post.favorited) {
          post.favorites = (post.favorites || 0) - 1;
          post.favorited = false;
        } else {
          post.favorites = (post.favorites || 0) + 1;
          post.favorited = true;
        }
        saveDataToServer();
        
        if (searchActive) {
          handleSearch();
        } else {
          generatePosts();
        }
      }
    }

    function generatePosts() {
      if (!currentUser) return;
      
      const container = document.getElementById('posts-container');
      if (!container) return;
      
      const allPosts = [...posts, ...samplePosts];
      
      // Filter posts based on privacy and following status
      const filteredPosts = allPosts.filter(post => {
        if (!post.private) {
          return true; // Public posts are visible to everyone
        }
        
        // Private posts are only visible to:
        // 1. The author
        // 2. People who follow the author
        if (post.author === currentUser.username) {
          return true; // Own posts are always visible
        }
        
        return currentUser.following.includes(post.author);
      });
      
      if (filteredPosts.length === 0) {
        container.innerHTML = '<div class="no-results">Nenhum post para mostrar.</div>';
        return;
      }
      
      container.innerHTML = filteredPosts
        .sort((a, b) => b.id - a.id)
        .map(post => generatePostHTML(post))
        .join('');
    }

    function loadFollowRequests() {
      if (!currentUser) return;
      
      const container = document.getElementById('follow-requests-list');
      if (!container) return;
      
      const requests = currentUser.followRequests || [];
      
      if (requests.length === 0) {
        container.innerHTML = '<p>Nenhuma solicita√ß√£o pendente.</p>';
        return;
      }
      
      container.innerHTML = requests.map(username => {
        const user = users.find(u => u.username === username);
        if (!user) return '';
        
        const avatarStyle = user.avatar ? `background-image: url('${user.avatar}')` : '';
        
        return `
          <div class="request-item">
            <div class="request-user-info">
              <div class="request-avatar" style="${avatarStyle}">${user.avatar ? '' : user.displayName.charAt(0).toUpperCase()}</div>
              <div>
                <div class="user-search-name">${user.displayName}</div>
                <div class="user-search-username">@${user.username}</div>
              </div>
            </div>
            <div class="request-buttons">
              <button class="request-btn accept-btn" onclick="acceptFollowRequest('${username}')">Aceitar</button>
              <button class="request-btn reject-btn" onclick="rejectFollowRequest('${username}')">Recusar</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function acceptFollowRequest(username) {
      if (!currentUser) return;
      
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      // Add to followers/following
      currentUser.followers.push(username);
      user.following.push(currentUser.username);
      
      // Remove from follow requests
      currentUser.followRequests = currentUser.followRequests.filter(u => u !== username);
      
      saveDataToServer();
      
      // Notify the requester
      const notification = {
        id: Date.now(),
        userId: username,
        author: currentUser.username,
        displayName: currentUser.displayName,
        text: 'aceitou sua solicita√ß√£o de seguir',
        time: 'agora',
        read: false
      };
      
      notifications.push(notification);
      saveDataToServer();
      
      loadFollowRequests();
      updateNotificationsBadge();
    }

    function rejectFollowRequest(username) {
      if (!currentUser) return;
      
      // Remove from follow requests
      currentUser.followRequests = currentUser.followRequests.filter(u => u !== username);
      saveDataToServer();
      
      loadFollowRequests();
    }

    // Password visibility toggle function
    function togglePasswordVisibility(inputId, button) {
      const input = document.getElementById(inputId);
      const isPassword = input.type === 'password';
      
      input.type = isPassword ? 'text' : 'password';
      button.textContent = isPassword ? 'üôà' : 'üëÅÔ∏è';
    }

    // Show reset password form
    function showResetPasswordForm() {
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('reset-password-form').style.display = 'block';
      document.getElementById('register-form').style.display = 'none';
      
      // Reset auth tabs
      document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
    }

    // Show login form
    function showLoginForm() {
      document.getElementById('login-form').style.display = 'block';
      document.getElementById('reset-password-form').style.display = 'none';
      document.getElementById('register-form').style.display = 'none';
      
      // Activate login tab
      document.getElementById('login-tab').classList.add('active');
      document.getElementById('register-tab').classList.remove('active');
      
      // Clear reset form
      document.getElementById('reset-username').value = '';
      document.getElementById('reset-new-password').value = '';
      document.getElementById('reset-confirm-password').value = '';
      document.getElementById('reset-status').textContent = '';
      document.getElementById('reset-status').className = 'notice';
    }

    // Reset password function
    function resetPassword() {
      const username = document.getElementById('reset-username').value.trim();
      const newPassword = document.getElementById('reset-new-password').value;
      const confirmPassword = document.getElementById('reset-confirm-password').value;
      const statusElement = document.getElementById('reset-status');
      
      // Clear previous status
      statusElement.textContent = '';
      statusElement.className = 'notice';
      
      // Validation
      if (!username) {
        statusElement.textContent = '‚ùå Por favor, digite seu nome de usu√°rio.';
        statusElement.className = 'notice error';
        return;
      }
      
      if (!newPassword || newPassword.length < 5 || newPassword.length > 15) {
        statusElement.textContent = '‚ùå A senha deve ter entre 5 e 15 caracteres.';
        statusElement.className = 'notice error';
        return;
      }
      
      if (newPassword !== confirmPassword) {
        statusElement.textContent = '‚ùå As senhas n√£o coincidem.';
        statusElement.className = 'notice error';
        return;
      }
      
      // Find user
      const user = users.find(u => u.username === username);
      if (!user) {
        statusElement.textContent = '‚ùå Usu√°rio n√£o encontrado.';
        statusElement.className = 'notice error';
        return;
      }
      
      // Update password
      user.password = newPassword;
      saveDataToServer();
      
      statusElement.textContent = '‚úÖ Senha redefinida com sucesso! Voc√™ pode fazer login agora.';
      statusElement.className = 'notice success';
      
      // Clear form and return to login after 2 seconds
      setTimeout(() => {
        showLoginForm();
      }, 2000);
    }

    // Download post function
    function downloadPost(postId) {
      const allPosts = [...posts, ...samplePosts];
      const post = allPosts.find(p => p.id === postId);
      
      if (!post) return;
      
      if (post.media) {
        // Download media if available
        downloadMedia(post.media.url, post.media.type);
      } else {
        // Download text as file
        const content = `Post de ${post.displayName} (@${post.author})\n\n${post.text}\n\nPostado em: ${post.time}`;
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `post-${post.id}-${post.author}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
    }

    // Profile tabs function
    function showProfileTab(tabType, username) {
      // Remove active class from all tabs
      document.querySelectorAll('.profile-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Hide all tab contents
      document.querySelectorAll('.profile-tab-content').forEach(content => {
        content.classList.remove('active');
        content.style.display = 'none';
      });
      
      // Show selected tab
      const selectedTab = event.target;
      selectedTab.classList.add('active');
      
      const selectedContent = document.getElementById(`profile-${tabType}-${username}`);
      if (selectedContent) {
        selectedContent.classList.add('active');
        selectedContent.style.display = 'block';
      }
      
      // If showing favorites or likes, refresh the content
      if (tabType === 'favorites') {
        refreshFavoritesTab(username);
      } else if (tabType === 'likes') {
        refreshLikesTab(username);
      }
    }

    // Refresh favorites tab
    function refreshFavoritesTab(username) {
      const container = document.getElementById(`profile-favorites-${username}`);
      if (!container) return;
      
      const allPosts = [...posts, ...samplePosts];
      const favoritePosts = allPosts.filter(post => post.favorited && (
        !post.private || 
        post.author === currentUser.username || 
        currentUser.following.includes(post.author)
      ));
      
      container.innerHTML = favoritePosts.length === 0 ? 
        '<div class="empty-content">üåü Nada por aqui</div>' : 
        favoritePosts.map(post => generatePostHTML(post)).join('');
    }

    // Refresh likes tab
    function refreshLikesTab(username) {
      const container = document.getElementById(`profile-likes-${username}`);
      if (!container) return;
      
      const allPosts = [...posts, ...samplePosts];
      const likedPosts = allPosts.filter(post => (post.liked || post.disliked) && (
        !post.private || 
        post.author === currentUser.username || 
        currentUser.following.includes(post.author)
      ));
      
      container.innerHTML = likedPosts.length === 0 ? 
        '<div class="empty-content">üëç Nada por aqui</div>' : 
        likedPosts.map(post => generatePostHTML(post)).join('');
    }

    // Ban system functions
    let currentBanUsername = null;

    function showBanModal(username) {
      currentBanUsername = username;
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      document.getElementById('ban-username').textContent = user.displayName;
      document.getElementById('ban-modal').style.display = 'flex';
      
      // Reset form
      document.querySelectorAll('input[name="ban-duration"]').forEach(radio => {
        radio.checked = false;
      });
      document.getElementById('custom-ban-section').style.display = 'none';
      document.getElementById('custom-ban-days').value = '';
      document.getElementById('ban-reason').value = '';
    }

    function closeBanModal() {
      document.getElementById('ban-modal').style.display = 'none';
      currentBanUsername = null;
    }

    function confirmBan() {
      if (!currentBanUsername || !currentUser || !currentUser.isAdmin) return;
      
      const selectedDuration = document.querySelector('input[name="ban-duration"]:checked');
      if (!selectedDuration) {
        alert('Por favor, selecione uma dura√ß√£o para o banimento.');
        return;
      }
      
      const user = users.find(u => u.username === currentBanUsername);
      if (!user) return;
      
      let banExpiry = null;
      const now = new Date();
      
      switch (selectedDuration.value) {
        case '1day':
          banExpiry = new Date(now.getTime() + 24 * 60 * 60 * 1000);
          break;
        case '1week':
          banExpiry = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
          break;
        case 'forever':
          banExpiry = null; // Permanent ban
          break;
        case 'custom':
          const customDays = parseInt(document.getElementById('custom-ban-days').value);
          if (!customDays || customDays < 1) {
            alert('Por favor, digite um n√∫mero v√°lido de dias.');
            return;
          }
          banExpiry = new Date(now.getTime() + customDays * 24 * 60 * 60 * 1000);
          break;
      }
      
      const reason = document.getElementById('ban-reason').value.trim();
      
      // Apply ban
      user.banned = true;
      user.banExpiry = banExpiry;
      user.banReason = reason || 'N√£o especificado';
      
      saveDataToServer();
      
      // Notify user about ban
      const banDurationText = banExpiry ? 
        `at√© ${banExpiry.toLocaleDateString('pt-BR')}` : 
        'permanentemente';
      
      alert(`Usu√°rio ${user.displayName} foi banido ${banDurationText}.`);
      
      closeBanModal();
      
      // Refresh profile if viewing banned user
      if (viewingUserProfile && viewingUserProfile.username === currentBanUsername) {
        viewUserProfile(currentBanUsername);
      }
      
      // Refresh posts to hide banned content
      generatePosts();
    }

    function unbanUser(username) {
      if (!currentUser || !currentUser.isAdmin) return;
      
      const user = users.find(u => u.username === username);
      if (!user) return;
      
      if (confirm(`Tem certeza que deseja desbanir ${user.displayName}?`)) {
        user.banned = false;
        user.banExpiry = null;
        user.banReason = null;
        
        saveDataToServer();
        
        alert(`Usu√°rio ${user.displayName} foi desbanido.`);
        
        // Refresh profile
        if (viewingUserProfile && viewingUserProfile.username === username) {
          viewUserProfile(username);
        }
        
        // Refresh posts to show unbanned content
        generatePosts();
      }
    }

    // Check ban status on login
    function checkUserBanStatus() {
      if (!currentUser) return;
      
      if (isUserBanned(currentUser)) {
        const banMessage = currentUser.banExpiry ? 
          `Voc√™ est√° banido at√© ${new Date(currentUser.banExpiry).toLocaleDateString('pt-BR')}.` :
          'Voc√™ est√° banido permanentemente.';
        
        const reason = currentUser.banReason ? 
          `\n\nMotivo: ${currentUser.banReason}` : '';
        
        alert(`üîí ${banMessage}${reason}\n\nVoc√™ n√£o pode interagir com o conte√∫do enquanto estiver banido.`);
      }
    }

    // Search functionality
    function handleSearch() {
      if (!currentUser) return;
      
      const query = document.getElementById('search-input').value.trim().toLowerCase();
      const searchResults = document.getElementById('search-results');
      const postsContainer = document.getElementById('search-posts-container');
      const usersContainer = document.getElementById('search-users-container');
      const searchTitle = document.getElementById('search-title');
      
      if (!query) {
        searchResults.style.display = 'none';
        searchActive = false;
        generatePosts();
        return;
      }
      
      searchActive = true;
      searchQuery = query;
      
      // Search posts
      const allPosts = [...posts, ...samplePosts];
      const matchingPosts = allPosts.filter(post => {
        const matchesText = post.text && post.text.toLowerCase().includes(query);
        const matchesAuthor = post.displayName && post.displayName.toLowerCase().includes(query);
        
        // Check privacy
        if (post.private && post.author !== currentUser.username && !currentUser.following.includes(post.author)) {
          return false;
        }
        
        return matchesText || matchesAuthor;
      });
      
      // Search users
      const matchingUsers = users.filter(user => {
        const matchesName = user.displayName && user.displayName.toLowerCase().includes(query);
        const matchesUsername = user.username && user.username.toLowerCase().includes(query);
        return (matchesName || matchesUsername) && user.username !== currentUser.username;
      });
      
      // Update UI
      searchTitle.textContent = `üîç Resultados para "${query}"`;
      
      if (matchingPosts.length === 0 && matchingUsers.length === 0) {
        postsContainer.innerHTML = '<div class="no-results">Nenhum resultado encontrado.</div>';
        usersContainer.innerHTML = '';
      } else {
        postsContainer.innerHTML = matchingPosts.length > 0 ? 
          matchingPosts.map(post => generatePostHTML(post)).join('') : 
          '<div class="no-results">Nenhum post encontrado.</div>';
        
        usersContainer.innerHTML = matchingUsers.length > 0 ? 
          matchingUsers.map(user => generateUserSearchHTML(user)).join('') : '';
      }
      
      searchResults.style.display = 'block';
    }

    function generateUserSearchHTML(user) {
      const avatarStyle = user.avatar ? `background-image: url('${user.avatar}')` : '';
      const isFollowing = currentUser.following.includes(user.username);
      const hasPendingRequest = user.followRequests && user.followRequests.includes(currentUser.username);
      const isBanned = isUserBanned(user);
      
      return `
        <div class="search-user-profile">
          <div class="search-user-avatar" onclick="viewUserProfile('${user.username}')" style="${avatarStyle}">
            ${user.avatar ? '' : user.displayName.charAt(0).toUpperCase()}
          </div>
          <div class="search-user-info">
            <div class="search-user-name" onclick="viewUserProfile('${user.username}')">${user.displayName}</div>
            <div class="search-user-username" onclick="viewUserProfile('${user.username}')">@${user.username}</div>
            ${isBanned ? '<div style="color: #ff6666; font-size: 0.8rem;">üîí Usu√°rio banido</div>' : ''}
            <div class="search-user-actions">
              ${!isBanned ? `
                ${isFollowing ? 
                  `<button class="follow-btn following" onclick="unfollowUser('${user.username}')">Seguindo</button>` :
                  hasPendingRequest ? 
                    `<button class="follow-btn pending" disabled>Solicita√ß√£o Enviada</button>` :
                    `<button class="follow-btn" onclick="followUser('${user.username}')">Seguir</button>`
                }
                <button class="send-message-btn" onclick="startConversation('${user.username}')">Mensagem</button>
              ` : ''}
              ${currentUser.isAdmin && !isBanned ? 
                `<button class="ban-btn" onclick="showBanModal('${user.username}')">Banir</button>` : ''}
              ${currentUser.isAdmin && isBanned ? 
                `<button class="ban-btn unban" onclick="unbanUser('${user.username}')">Desbanir</button>` : ''}
            </div>
          </div>
        </div>
      `;
    }

    function startConversation(username) {
      showPage('chat');
      setTimeout(() => openChat(username), 100);
    }
  </script>
</body>
</html>